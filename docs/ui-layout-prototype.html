<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>TraceDiary 单页日记页原型</title>
    <style>
      :root {
        --bg: #f3f5f8;
        --surface: #ffffff;
        --surface-soft: #f8fafc;
        --line: #dbe1ea;
        --text: #111827;
        --muted: #667085;
        --accent: #2563eb;
        --accent-soft: #eaf1ff;
        --success: #15803d;
        --warning: #b45309;
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        min-height: 100vh;
        background: radial-gradient(circle at 12% 10%, #eef4ff 0%, transparent 28%), var(--bg);
        color: var(--text);
        font-family: "Noto Sans SC", "PingFang SC", "Microsoft YaHei", sans-serif;
      }

      .shell {
        margin: 0 auto;
        max-width: 1200px;
        padding: 0 22px 28px;
      }

      .topbar {
        position: sticky;
        top: 0;
        z-index: 5;
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 12px;
        min-height: 68px;
        border-bottom: 1px solid var(--line);
        background: rgba(243, 245, 248, 0.92);
        backdrop-filter: blur(8px);
      }

      .brand {
        font-family: "Noto Serif SC", "Songti SC", serif;
        font-size: 22px;
        letter-spacing: 0.02em;
      }

      .top-meta {
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .chip {
        display: inline-flex;
        align-items: center;
        border: 1px solid var(--line);
        border-radius: 999px;
        background: var(--surface);
        color: var(--muted);
        font-size: 12px;
        padding: 6px 10px;
      }

      .btn {
        border: 1px solid var(--line);
        border-radius: 10px;
        background: var(--surface);
        color: var(--text);
        padding: 9px 12px;
        font-size: 13px;
        cursor: pointer;
        transition: all 0.12s ease;
      }

      .btn:hover {
        border-color: #c4cfdd;
        box-shadow: 0 4px 10px rgba(15, 23, 42, 0.08);
      }

      .btn.primary {
        border-color: var(--accent);
        background: var(--accent);
        color: #fff;
      }

      .hero {
        margin: 18px 0 14px;
      }

      .hero h1 {
        margin: 0;
        font-family: "Noto Serif SC", "Songti SC", serif;
        font-size: 34px;
      }

      .hero p {
        margin: 8px 0 0;
        color: var(--muted);
        max-width: 760px;
      }

      .layout {
        display: grid;
        grid-template-columns: minmax(300px, 1.05fr) minmax(0, 1.95fr);
        gap: 16px;
      }

      .card {
        border: 1px solid var(--line);
        border-radius: 16px;
        background: var(--surface);
        box-shadow: 0 8px 24px rgba(15, 23, 42, 0.06);
      }

      .panel {
        padding: 16px;
      }

      .calendar-head {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 8px;
        margin-bottom: 10px;
      }

      .month-title {
        font-weight: 600;
      }

      .calendar-grid {
        display: grid;
        grid-template-columns: repeat(7, minmax(0, 1fr));
        gap: 7px;
      }

      .weekday {
        text-align: center;
        color: var(--muted);
        font-size: 12px;
        padding: 4px 0;
      }

      .day {
        border: 1px solid var(--line);
        border-radius: 10px;
        min-height: 40px;
        background: var(--surface);
        color: #374151;
        font-size: 13px;
        cursor: pointer;
      }

      .day:hover {
        border-color: #c4cfdd;
      }

      .day.today {
        box-shadow: inset 0 0 0 1px #93c5fd;
      }

      .day.active {
        border-color: var(--accent);
        background: var(--accent-soft);
        color: #1e3a8a;
      }

      .side-block {
        margin-top: 12px;
        border: 1px solid var(--line);
        border-radius: 12px;
        background: var(--surface-soft);
        padding: 10px;
      }

      .side-block h3 {
        margin: 0 0 8px;
        font-size: 14px;
      }

      .history-list {
        max-height: 180px;
        overflow: auto;
        display: grid;
        gap: 8px;
      }

      .history-item {
        border: 1px solid var(--line);
        border-radius: 10px;
        background: var(--surface);
        padding: 8px;
      }

      .history-item small {
        color: var(--muted);
      }

      .editor-shell {
        display: flex;
        flex-direction: column;
        gap: 12px;
      }

      .toolbar {
        display: flex;
        flex-wrap: wrap;
        align-items: center;
        gap: 8px;
        border: 1px solid var(--line);
        border-radius: 12px;
        background: var(--surface-soft);
        padding: 10px;
      }

      .toolbar .label {
        color: var(--muted);
        font-size: 12px;
      }

      .status {
        font-size: 13px;
      }

      .status.saved {
        color: var(--success);
      }

      .status.saving {
        color: var(--warning);
      }

      .mode-switch {
        display: inline-flex;
        border: 1px solid var(--line);
        border-radius: 10px;
        overflow: hidden;
      }

      .mode-btn {
        border: 0;
        background: transparent;
        padding: 8px 12px;
        font-size: 13px;
        color: var(--muted);
        cursor: pointer;
      }

      .mode-btn.active {
        background: var(--accent);
        color: #fff;
      }

      .editor {
        min-height: 420px;
        width: 100%;
        resize: vertical;
        border: 1px solid var(--line);
        border-radius: 14px;
        background: var(--surface);
        color: var(--text);
        padding: 14px;
        line-height: 1.75;
      }

      .modal-mask {
        position: fixed;
        inset: 0;
        z-index: 20;
        display: flex;
        align-items: center;
        justify-content: center;
        background: rgba(15, 23, 42, 0.42);
        padding: 16px;
      }

      .modal {
        width: min(560px, 100%);
        border: 1px solid #cdd8ea;
        border-radius: 16px;
        background: #fff;
        box-shadow: 0 22px 40px rgba(15, 23, 42, 0.26);
      }

      .modal-head {
        padding: 14px 16px;
        border-bottom: 1px solid var(--line);
      }

      .modal-head h2 {
        margin: 0;
        font-size: 18px;
      }

      .modal-head p {
        margin: 6px 0 0;
        color: var(--muted);
        font-size: 13px;
      }

      .modal-body {
        padding: 14px 16px 16px;
      }

      .field {
        display: flex;
        flex-direction: column;
        gap: 6px;
        margin-bottom: 10px;
      }

      .field label {
        color: var(--muted);
        font-size: 12px;
      }

      .field input,
      .field select {
        border: 1px solid var(--line);
        border-radius: 10px;
        padding: 9px 10px;
      }

      .modal-actions {
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 8px;
        margin-top: 6px;
      }

      .ghost {
        color: var(--muted);
        font-size: 12px;
      }

      .hidden {
        display: none !important;
      }

      @media (max-width: 960px) {
        .shell {
          padding: 0 14px 20px;
        }

        .layout {
          grid-template-columns: 1fr;
        }

        .hero h1 {
          font-size: 30px;
        }
      }
    </style>
  </head>
  <body>
    <div class="shell">
      <header class="topbar">
        <div class="brand">TraceDiary</div>
        <div class="top-meta">
          <span class="chip" id="sessionState">会话：未解锁</span>
          <button class="btn" id="openAuth">解锁 / 配置</button>
        </div>
      </header>

      <section class="hero">
        <h1>日记页</h1>
        <p>单页布局：左侧日历与往年今日，右侧同屏切换“日记 / 年度总结”。欢迎流程改为启动弹层，不再占用独立页面。</p>
      </section>

      <section class="layout" aria-label="diary-layout">
        <aside class="card panel">
          <div class="calendar-head">
            <button class="btn" id="prevMonth">上个月</button>
            <strong class="month-title" id="monthTitle">2026年02月</strong>
            <button class="btn" id="nextMonth">下个月</button>
          </div>

          <div class="calendar-grid" id="weekdayRow"></div>
          <div class="calendar-grid" id="calendarGrid"></div>

          <div class="side-block">
            <h3>往年今日</h3>
            <div class="history-list" id="historyList"></div>
          </div>
        </aside>

        <main class="editor-shell">
          <div class="toolbar">
            <span class="label">当前日期</span>
            <input type="date" id="activeDate" value="2026-02-08" />

            <div class="mode-switch" role="tablist" aria-label="编辑模式切换">
              <button class="mode-btn active" id="dailyMode" data-mode="daily" type="button">日记</button>
              <button class="mode-btn" id="yearlyMode" data-mode="yearly" type="button">年度总结</button>
            </div>

            <span class="status saved" id="saveState">已保存到本地</span>
            <button class="btn" id="syncNow">立即上传</button>
            <span class="status" id="syncState">同步状态：idle</span>
          </div>

          <article class="card panel">
            <h2 id="editorTitle" style="margin: 0 0 10px; font-size: 18px">2026-02-08 日记</h2>
            <textarea class="editor" id="editorArea"># 今天的记录

这里演示“单页日记页”布局与状态流，不展示业务细节。</textarea>
          </article>
        </main>
      </section>
    </div>

    <div class="modal-mask" id="authModal" role="dialog" aria-modal="true" aria-label="认证弹层">
      <div class="modal">
        <div class="modal-head">
          <h2>欢迎使用 TraceDiary</h2>
          <p id="authDesc">首次使用请配置仓库与密钥；后续打开只需输入主密码。</p>
        </div>
        <div class="modal-body">
          <div class="field">
            <label>认证模式</label>
            <select id="authMode">
              <option value="first">首次使用（配置 Gitee）</option>
              <option value="unlock">日常解锁（输入主密码）</option>
            </select>
          </div>

          <div id="setupFields">
            <div class="field">
              <label>Gitee 仓库</label>
              <input placeholder="owner/repo" />
            </div>
            <div class="field">
              <label>Token</label>
              <input type="password" placeholder="输入 Token" />
            </div>
          </div>

          <div class="field">
            <label>主密码</label>
            <input id="masterPassword" type="password" placeholder="输入主密码" />
          </div>

          <div class="modal-actions">
            <span class="ghost">弹层提交后关闭，进入单页日记页。</span>
            <button class="btn primary" id="submitAuth">提交并进入</button>
          </div>
        </div>
      </div>
    </div>

    <script>
      const weekdayRow = document.getElementById('weekdayRow')
      const calendarGrid = document.getElementById('calendarGrid')
      const monthTitle = document.getElementById('monthTitle')
      const historyList = document.getElementById('historyList')
      const activeDateInput = document.getElementById('activeDate')
      const editorTitle = document.getElementById('editorTitle')
      const editorArea = document.getElementById('editorArea')
      const saveState = document.getElementById('saveState')
      const syncState = document.getElementById('syncState')
      const dailyModeBtn = document.getElementById('dailyMode')
      const yearlyModeBtn = document.getElementById('yearlyMode')

      const authModal = document.getElementById('authModal')
      const openAuthBtn = document.getElementById('openAuth')
      const submitAuthBtn = document.getElementById('submitAuth')
      const authModeSelect = document.getElementById('authMode')
      const setupFields = document.getElementById('setupFields')
      const authDesc = document.getElementById('authDesc')
      const sessionState = document.getElementById('sessionState')

      let currentMonth = new Date(2026, 1, 1)
      let activeDate = '2026-02-08'
      let editorMode = 'daily'
      let saveTimer = null
      const weekdays = ['日', '一', '二', '三', '四', '五', '六']

      function formatMonth(date) {
        return `${date.getFullYear()}年${String(date.getMonth() + 1).padStart(2, '0')}月`
      }

      function pad(value) {
        return String(value).padStart(2, '0')
      }

      function dateKey(date) {
        return `${date.getFullYear()}-${pad(date.getMonth() + 1)}-${pad(date.getDate())}`
      }

      function updateEditorTitle() {
        if (editorMode === 'daily') {
          editorTitle.textContent = `${activeDate} 日记`
          return
        }

        const year = activeDate.slice(0, 4)
        editorTitle.textContent = `${year} 年度总结`
      }

      function renderWeekday() {
        weekdayRow.innerHTML = ''
        weekdays.forEach((label) => {
          const node = document.createElement('div')
          node.className = 'weekday'
          node.textContent = label
          weekdayRow.appendChild(node)
        })
      }

      function renderCalendar() {
        monthTitle.textContent = formatMonth(currentMonth)
        calendarGrid.innerHTML = ''

        const year = currentMonth.getFullYear()
        const month = currentMonth.getMonth()
        const firstDay = new Date(year, month, 1)
        const start = new Date(year, month, 1 - firstDay.getDay())
        const today = '2026-02-08'

        for (let i = 0; i < 42; i += 1) {
          const date = new Date(start.getFullYear(), start.getMonth(), start.getDate() + i)
          const key = dateKey(date)

          const button = document.createElement('button')
          button.type = 'button'
          button.className = 'day'
          button.textContent = String(date.getDate())

          if (key === today) button.classList.add('today')
          if (key === activeDate) button.classList.add('active')

          button.addEventListener('click', () => {
            activeDate = key
            activeDateInput.value = key
            updateEditorTitle()
            renderCalendar()
            renderHistory()
          })

          calendarGrid.appendChild(button)
        }
      }

      function renderHistory() {
        historyList.innerHTML = ''
        const md = activeDate.slice(5)

        for (let i = 1; i <= 6; i += 1) {
          const year = 2026 - i
          const item = document.createElement('article')
          item.className = 'history-item'
          item.innerHTML = `<strong>${year} 年 ${md}</strong><br /><small>往年今日摘要（演示）</small>`
          historyList.appendChild(item)
        }
      }

      function setMode(mode) {
        editorMode = mode
        dailyModeBtn.classList.toggle('active', mode === 'daily')
        yearlyModeBtn.classList.toggle('active', mode === 'yearly')

        if (mode === 'daily') {
          editorArea.value = '# 今天的记录\n\n这里是日记模式。'
        } else {
          const year = activeDate.slice(0, 4)
          editorArea.value = `## ${year} 年度总结\n\n- 年度成果\n- 问题复盘\n- 来年计划`
        }

        updateEditorTitle()
      }

      function openAuthModal() {
        authModal.classList.remove('hidden')
      }

      function closeAuthModal() {
        authModal.classList.add('hidden')
      }

      authModeSelect.addEventListener('change', () => {
        const isFirstUse = authModeSelect.value === 'first'
        setupFields.classList.toggle('hidden', !isFirstUse)
        authDesc.textContent = isFirstUse
          ? '首次使用请配置仓库与密钥；后续打开只需输入主密码。'
          : '日常打开仅需输入主密码，认证后弹层关闭。'
      })

      submitAuthBtn.addEventListener('click', () => {
        sessionState.textContent = '会话：已解锁（演示）'
        closeAuthModal()
      })

      openAuthBtn.addEventListener('click', () => {
        openAuthModal()
      })

      document.getElementById('prevMonth').addEventListener('click', () => {
        currentMonth = new Date(currentMonth.getFullYear(), currentMonth.getMonth() - 1, 1)
        renderCalendar()
      })

      document.getElementById('nextMonth').addEventListener('click', () => {
        currentMonth = new Date(currentMonth.getFullYear(), currentMonth.getMonth() + 1, 1)
        renderCalendar()
      })

      activeDateInput.addEventListener('change', (event) => {
        if (!event.target.value) return
        activeDate = event.target.value
        const parsed = new Date(`${activeDate}T00:00:00`)
        if (!Number.isNaN(parsed.getTime())) {
          currentMonth = new Date(parsed.getFullYear(), parsed.getMonth(), 1)
        }
        updateEditorTitle()
        renderCalendar()
        renderHistory()
      })

      editorArea.addEventListener('input', () => {
        if (saveTimer) clearTimeout(saveTimer)
        saveState.textContent = '保存中...'
        saveState.className = 'status saving'

        saveTimer = setTimeout(() => {
          saveState.textContent = '已保存到本地'
          saveState.className = 'status saved'
        }, 500)
      })

      document.getElementById('syncNow').addEventListener('click', () => {
        syncState.textContent = '同步状态：syncing'
        setTimeout(() => {
          syncState.textContent = '同步状态：success（刚刚）'
        }, 800)
      })

      dailyModeBtn.addEventListener('click', () => setMode('daily'))
      yearlyModeBtn.addEventListener('click', () => setMode('yearly'))

      renderWeekday()
      renderCalendar()
      renderHistory()
      setMode('daily')
      openAuthModal()
    </script>
  </body>
</html>
