<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>TraceDiary 任务看板（一次性迁移快照）</title>
    <style>
      :root {
        --bg: #f6f4ee;
        --panel: rgba(255, 255, 255, 0.88);
        --ink: #1e2329;
        --muted: #5c6672;
        --line: rgba(30, 35, 41, 0.16);
        --accent: #0f766e;
        --done: #1d4ed8;
        --doing: #b45309;
        --todo: #475569;
        --blocked: #be123c;
        --shadow: 0 16px 40px rgba(30, 35, 41, 0.12);
      }
      * {
        box-sizing: border-box;
      }
      body {
        margin: 0;
        font-family: "Noto Sans SC", "PingFang SC", "Microsoft YaHei", sans-serif;
        color: var(--ink);
        background:
          radial-gradient(circle at 8% 10%, rgba(15, 118, 110, 0.16), transparent 36%),
          radial-gradient(circle at 92% 84%, rgba(29, 78, 216, 0.14), transparent 35%),
          var(--bg);
      }
      .wrap {
        max-width: 1320px;
        margin: 0 auto;
        padding: 24px;
      }
      .hero {
        background: var(--panel);
        border: 1px solid var(--line);
        border-radius: 18px;
        box-shadow: var(--shadow);
        padding: 20px 24px;
      }
      .hero h1 {
        margin: 0;
        font-size: 28px;
        letter-spacing: 0.02em;
      }
      .meta {
        margin-top: 8px;
        color: var(--muted);
        font-size: 13px;
      }
      .toolbar {
        margin-top: 18px;
        display: grid;
        grid-template-columns: 1.3fr 0.9fr 0.9fr;
        gap: 12px;
      }
      .toolbar input,
      .toolbar select {
        width: 100%;
        border: 1px solid var(--line);
        border-radius: 10px;
        background: rgba(255, 255, 255, 0.92);
        color: var(--ink);
        padding: 10px 12px;
        font-size: 14px;
      }
      .stats {
        margin-top: 14px;
        display: grid;
        grid-template-columns: repeat(5, minmax(0, 1fr));
        gap: 10px;
      }
      .card {
        border: 1px solid var(--line);
        background: rgba(255, 255, 255, 0.85);
        border-radius: 12px;
        padding: 10px 12px;
      }
      .card .label {
        display: block;
        color: var(--muted);
        font-size: 12px;
      }
      .card .value {
        margin-top: 4px;
        font-size: 24px;
        font-weight: 700;
      }
      .panel {
        margin-top: 16px;
        border: 1px solid var(--line);
        border-radius: 16px;
        background: rgba(255, 255, 255, 0.9);
        overflow: hidden;
        box-shadow: var(--shadow);
      }
      table {
        width: 100%;
        border-collapse: collapse;
        table-layout: fixed;
      }
      th,
      td {
        padding: 10px 12px;
        border-bottom: 1px solid var(--line);
        vertical-align: top;
        text-align: left;
      }
      thead th {
        position: sticky;
        top: 0;
        background: rgba(244, 241, 233, 0.95);
        z-index: 2;
        font-size: 12px;
        color: var(--muted);
        letter-spacing: 0.04em;
        text-transform: uppercase;
      }
      tbody tr:hover {
        background: rgba(15, 118, 110, 0.06);
      }
      .status {
        display: inline-flex;
        align-items: center;
        border-radius: 999px;
        font-size: 11px;
        font-weight: 700;
        padding: 3px 8px;
        letter-spacing: 0.03em;
      }
      .status-DONE {
        background: rgba(29, 78, 216, 0.12);
        color: var(--done);
      }
      .status-DOING {
        background: rgba(180, 83, 9, 0.14);
        color: var(--doing);
      }
      .status-TODO {
        background: rgba(71, 85, 105, 0.14);
        color: var(--todo);
      }
      .status-BLOCKED {
        background: rgba(190, 18, 60, 0.14);
        color: var(--blocked);
      }
      .tiny {
        font-size: 12px;
        color: var(--muted);
      }
      .mono {
        font-family: "JetBrains Mono", "SFMono-Regular", Menlo, monospace;
        font-size: 12px;
      }
      .scroll {
        max-height: 78vh;
        overflow: auto;
      }
      @media (max-width: 960px) {
        .toolbar {
          grid-template-columns: 1fr;
        }
        .stats {
          grid-template-columns: repeat(2, minmax(0, 1fr));
        }
      }
    </style>
  </head>
  <body>
    <main class="wrap">
      <section class="hero">
        <h1>TraceDiary 任务看板</h1>
        <p class="meta" id="meta"></p>
        <div class="toolbar">
          <input id="searchInput" placeholder="搜索：ID / 任务 / 分类 / 状态" />
          <select id="statusSelect"></select>
          <select id="categorySelect"></select>
        </div>
        <div class="stats">
          <div class="card"><span class="label">总任务</span><span class="value" id="statTotal">0</span></div>
          <div class="card"><span class="label">DONE</span><span class="value" id="statDone">0</span></div>
          <div class="card"><span class="label">DOING</span><span class="value" id="statDoing">0</span></div>
          <div class="card"><span class="label">TODO</span><span class="value" id="statTodo">0</span></div>
          <div class="card"><span class="label">BLOCKED</span><span class="value" id="statBlocked">0</span></div>
        </div>
      </section>
      <section class="panel">
        <div class="scroll">
          <table>
            <thead>
              <tr>
                <th style="width: 10%">ID</th>
                <th style="width: 9%">状态</th>
                <th style="width: 20%">分类</th>
                <th style="width: 24%">任务</th>
                <th style="width: 20%">验收标准</th>
                <th style="width: 17%">完成记录</th>
              </tr>
            </thead>
            <tbody id="tableBody"></tbody>
          </table>
        </div>
      </section>
    </main>
    <script>
      const payload = {
  "generatedAt": "2026-02-21T14:31:06.652Z",
  "taskCount": 182,
  "tasks": [
    {
      "task_uid": "td_7ad2dda0484f9fc48af5",
      "display_id": "TD-BASE-001",
      "id_prefix": "BASE",
      "module_key": "6.1",
      "module_name": "基础工程与项目骨架",
      "module_label": "6.1 基础工程与项目骨架",
      "order": 1,
      "status": "DONE",
      "title": "初始化 React + TypeScript + Vite 工程骨架",
      "acceptance": "可本地启动并渲染首页",
      "related_files": [
        "package.json",
        "src/main.tsx",
        "src/App.tsx"
      ],
      "test_record": "\`npm run test:unit\` 通过（1/1）；\`npm run test:integration\` 通过（1/1）；\`npm run test:e2e\` 通过（冒烟）；\`timeout 10s npm run dev -- --host 127.0.0.1 --port 4174 --strictPort\` 启动成功（Vite ready）",
      "done_record": "2026-02-08 / 74e583b",
      "source": {
        "file": "TODO.md",
        "line": 20
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_66ba1804e915e4bea119",
      "display_id": "TD-BASE-002",
      "id_prefix": "BASE",
      "module_key": "6.1",
      "module_name": "基础工程与项目骨架",
      "module_label": "6.1 基础工程与项目骨架",
      "order": 2,
      "status": "DONE",
      "title": "接入 Tailwind CSS 并配置基础样式",
      "acceptance": "工具类生效且构建通过",
      "related_files": [
        "tailwind.config.*",
        "src/index.css"
      ],
      "test_record": "\`npm run test:unit\` 通过（1/1）；\`npm run test:integration\` 通过（1/1）；\`npm run test:e2e\` 通过（冒烟）；\`npm run build\` 通过",
      "done_record": "2026-02-08 / 064c39d",
      "source": {
        "file": "TODO.md",
        "line": 21
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_db7bd2f6252841ad51e2",
      "display_id": "TD-BASE-003",
      "id_prefix": "BASE",
      "module_key": "6.1",
      "module_name": "基础工程与项目骨架",
      "module_label": "6.1 基础工程与项目骨架",
      "order": 3,
      "status": "DONE",
      "title": "建立目录结构（components/pages/hooks/services/types/utils）",
      "acceptance": "目录与 SPEC 对齐",
      "related_files": [
        "src/"
      ],
      "test_record": "\`npm run test:unit\` 通过（1/1）；\`npm run test:integration\` 通过（1/1）；\`npm run test:e2e\` 通过（冒烟）；\`npm run lint\` 通过",
      "done_record": "2026-02-08 / 94001ac",
      "source": {
        "file": "TODO.md",
        "line": 22
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_ce04161382f074b704a9",
      "display_id": "TD-BASE-004",
      "id_prefix": "BASE",
      "module_key": "6.1",
      "module_name": "基础工程与项目骨架",
      "module_label": "6.1 基础工程与项目骨架",
      "order": 4,
      "status": "DONE",
      "title": "配置 React Router 基础路由（welcome/calendar/editor/yearly-summary）",
      "acceptance": "页面可路由跳转",
      "related_files": [
        "src/App.tsx",
        "src/pages/*"
      ],
      "test_record": "\`npm run test:unit\` 通过（1/1）；\`npm run test:integration\` 通过（1/1）；\`npm run test:e2e\` 通过（冒烟）；\`npm run lint\` 通过；\`npm run build\` 通过",
      "done_record": "2026-02-08 / 252a896",
      "source": {
        "file": "TODO.md",
        "line": 23
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_03630c72e5fdae8d6413",
      "display_id": "TD-BASE-005",
      "id_prefix": "BASE",
      "module_key": "6.1",
      "module_name": "基础工程与项目骨架",
      "module_label": "6.1 基础工程与项目骨架",
      "order": 5,
      "status": "DONE",
      "title": "接入 TanStack Query 并提供全局 QueryClient",
      "acceptance": "页面可使用 query/mutation",
      "related_files": [
        "src/main.tsx"
      ],
      "test_record": "\`npm run test:unit\` 通过（1/1）；\`npm run test:integration\` 通过（2/2）；\`npm run test:e2e\` 通过（冒烟）；\`npm run lint\` 通过；\`npm run build\` 通过",
      "done_record": "2026-02-08 / 4613379",
      "source": {
        "file": "TODO.md",
        "line": 24
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_e2f458662aea67cff24c",
      "display_id": "TD-SEC-001",
      "id_prefix": "SEC",
      "module_key": "6.2",
      "module_name": "认证、安全与密钥管理",
      "module_label": "6.2 认证、安全与密钥管理",
      "order": 6,
      "status": "DONE",
      "title": "实现首次欢迎页输入（Repo/Token/主密码）",
      "acceptance": "表单校验通过后进入初始化流程",
      "related_files": [
        "src/pages/welcome.tsx"
      ],
      "test_record": "\`npm run test:unit\` 通过（13/13）；\`npm run test:integration\` 通过（6/6）；\`npm run test:e2e\` 通过（冒烟）；\`npm run lint\` 通过；\`npm run build\` 通过",
      "done_record": "2026-02-08 / cb09c7f",
      "source": {
        "file": "TODO.md",
        "line": 30
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_9ef001c69ff43ab59187",
      "display_id": "TD-SEC-002",
      "id_prefix": "SEC",
      "module_key": "6.2",
      "module_name": "认证、安全与密钥管理",
      "module_label": "6.2 认证、安全与密钥管理",
      "order": 7,
      "status": "DONE",
      "title": "实现 Gitee 仓库访问校验",
      "acceptance": "无效 Token/Repo 可提示错误",
      "related_files": [
        "src/services/gitee.ts"
      ],
      "test_record": "\`npm run test:unit\` 通过（13/13）；\`npm run test:integration\` 通过（6/6）；\`npm run test:e2e\` 通过（冒烟）；\`npm run lint\` 通过；\`npm run build\` 通过",
      "done_record": "2026-02-08 / cb09c7f",
      "source": {
        "file": "TODO.md",
        "line": 31
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_401e697911c74a4dcec3",
      "display_id": "TD-SEC-003",
      "id_prefix": "SEC",
      "module_key": "6.2",
      "module_name": "认证、安全与密钥管理",
      "module_label": "6.2 认证、安全与密钥管理",
      "order": 8,
      "status": "DONE",
      "title": "实现 PBKDF2 动态迭代参数校准（200ms~500ms）",
      "acceptance": "生成并持久化 \`kdfParams\`",
      "related_files": [
        "src/services/crypto.ts",
        "src/types/config.ts"
      ],
      "test_record": "\`npm run test:unit\` 通过（13/13）；\`npm run test:integration\` 通过（6/6）；\`npm run test:e2e\` 通过（冒烟）；\`npm run lint\` 通过；\`npm run build\` 通过",
      "done_record": "2026-02-08 / cb09c7f",
      "source": {
        "file": "TODO.md",
        "line": 32
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_40c47cf8e7592c16297d",
      "display_id": "TD-SEC-004",
      "id_prefix": "SEC",
      "module_key": "6.2",
      "module_name": "认证、安全与密钥管理",
      "module_label": "6.2 认证、安全与密钥管理",
      "order": 9,
      "status": "DONE",
      "title": "实现 AES-256-GCM 加解密工具（IV+ciphertext Base64）",
      "acceptance": "加密后可无损解密",
      "related_files": [
        "src/services/crypto.ts"
      ],
      "test_record": "\`npm run test:unit\` 通过（13/13）；\`npm run test:integration\` 通过（6/6）；\`npm run test:e2e\` 通过（冒烟）；\`npm run lint\` 通过；\`npm run build\` 通过",
      "done_record": "2026-02-08 / cb09c7f",
      "source": {
        "file": "TODO.md",
        "line": 33
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_9939ec2a12d2bdcad70b",
      "display_id": "TD-SEC-005",
      "id_prefix": "SEC",
      "module_key": "6.2",
      "module_name": "认证、安全与密钥管理",
      "module_label": "6.2 认证、安全与密钥管理",
      "order": 10,
      "status": "DONE",
      "title": "实现 \`encryptedToken\` 存储与恢复",
      "acceptance": "本地无 Token 明文",
      "related_files": [
        "src/services/crypto.ts",
        "src/hooks/use-auth.ts"
      ],
      "test_record": "\`npm run test:unit\` 通过（13/13）；\`npm run test:integration\` 通过（6/6）；\`npm run test:e2e\` 通过（冒烟）；\`npm run lint\` 通过；\`npm run build\` 通过",
      "done_record": "2026-02-08 / cb09c7f",
      "source": {
        "file": "TODO.md",
        "line": 34
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_255fd2e28c0ddc0d8b94",
      "display_id": "TD-SEC-006",
      "id_prefix": "SEC",
      "module_key": "6.2",
      "module_name": "认证、安全与密钥管理",
      "module_label": "6.2 认证、安全与密钥管理",
      "order": 11,
      "status": "DONE",
      "title": "实现 7 天免输主密码机制（不存主密码明文）",
      "acceptance": "过期后强制重输密码",
      "related_files": [
        "src/hooks/use-auth.ts"
      ],
      "test_record": "\`npm run test:unit\` 通过（13/13）；\`npm run test:integration\` 通过（6/6）；\`npm run test:e2e\` 通过（冒烟）；\`npm run lint\` 通过；\`npm run build\` 通过",
      "done_record": "2026-02-08 / cb09c7f",
      "source": {
        "file": "TODO.md",
        "line": 35
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_084b86c1ec2baf423281",
      "display_id": "TD-SEC-007",
      "id_prefix": "SEC",
      "module_key": "6.2",
      "module_name": "认证、安全与密钥管理",
      "module_label": "6.2 认证、安全与密钥管理",
      "order": 12,
      "status": "DONE",
      "title": "实现 Token 解密失败/失效回退输入流程",
      "acceptance": "失败时可补输并覆盖本地密文",
      "related_files": [
        "src/pages/welcome.tsx",
        "src/hooks/use-auth.ts"
      ],
      "test_record": "\`npm run test:unit\` 通过（13/13）；\`npm run test:integration\` 通过（6/6）；\`npm run test:e2e\` 通过（冒烟）；\`npm run lint\` 通过；\`npm run build\` 通过",
      "done_record": "2026-02-08 / cb09c7f",
      "source": {
        "file": "TODO.md",
        "line": 36
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_ef3cf281e6d11fc504d0",
      "display_id": "TD-DATA-001",
      "id_prefix": "DATA",
      "module_key": "6.3",
      "module_name": "数据层与本地缓存",
      "module_label": "6.3 数据层与本地缓存",
      "order": 13,
      "status": "DONE",
      "title": "实现 IndexedDB 数据库与对象仓库（diaries/metadata/config）",
      "acceptance": "可读写并按索引查询",
      "related_files": [
        "src/services/indexeddb.ts"
      ],
      "test_record": "\`npm run test:unit\` 通过（22/22）；\`npm run test:integration\` 通过（6/6）；\`npm run test:e2e\` 通过（冒烟）；\`npm run lint\` 通过；\`npm run build\` 通过",
      "done_record": "2026-02-08 / f4ddb11",
      "source": {
        "file": "TODO.md",
        "line": 42
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_048d1e2a0afeeb36a847",
      "display_id": "TD-DATA-002",
      "id_prefix": "DATA",
      "module_key": "6.3",
      "module_name": "数据层与本地缓存",
      "module_label": "6.3 数据层与本地缓存",
      "order": 14,
      "status": "DONE",
      "title": "实现 \`DiaryEntry\` 与 \`MetadataEntry\` 类型（含 yearly \`year + date\`）",
      "acceptance": "类型与 SPEC 一致",
      "related_files": [
        "src/types/diary.ts",
        "src/types/metadata.ts"
      ],
      "test_record": "\`npm run test:unit\` 通过（22/22）；\`npm run test:integration\` 通过（6/6）；\`npm run test:e2e\` 通过（冒烟）；\`npm run lint\` 通过；\`npm run build\` 通过",
      "done_record": "2026-02-08 / f4ddb11",
      "source": {
        "file": "TODO.md",
        "line": 43
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_e904efbede4ff904945a",
      "display_id": "TD-DATA-003",
      "id_prefix": "DATA",
      "module_key": "6.3",
      "module_name": "数据层与本地缓存",
      "module_label": "6.3 数据层与本地缓存",
      "order": 15,
      "status": "DONE",
      "title": "实现 metadata 本地解密缓存与远端 \`metadata.json.enc\` 同步",
      "acceptance": "首次加载可拉取并解密",
      "related_files": [
        "src/services/sync.ts"
      ],
      "test_record": "\`npm run test:unit\` 通过（22/22）；\`npm run test:integration\` 通过（6/6）；\`npm run test:e2e\` 通过（冒烟）；\`npm run lint\` 通过；\`npm run build\` 通过",
      "done_record": "2026-02-08 / f4ddb11",
      "source": {
        "file": "TODO.md",
        "line": 44
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_77e127b9328161f8b6b1",
      "display_id": "TD-FUNC-001",
      "id_prefix": "FUNC",
      "module_key": "6.4",
      "module_name": "核心功能：日历、编辑、年度总结、往年今日",
      "module_label": "6.4 核心功能：日历、编辑、年度总结、往年今日",
      "order": 16,
      "status": "DONE",
      "title": "实现月历视图与月份切换",
      "acceptance": "可切换任意月份并点击日期",
      "related_files": [
        "src/components/calendar/*",
        "src/pages/calendar.tsx"
      ],
      "test_record": "\`npm run test:unit\` 通过（22/22）；\`npm run test:integration\` 通过（21/21）；\`npm run test:e2e\` 通过；\`npm run lint\` 通过；\`npm run build\` 通过",
      "done_record": "2026-02-08 / a71bf95",
      "source": {
        "file": "TODO.md",
        "line": 50
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_654caeb55b3136eafb14",
      "display_id": "TD-FUNC-002",
      "id_prefix": "FUNC",
      "module_key": "6.4",
      "module_name": "核心功能：日历、编辑、年度总结、往年今日",
      "module_label": "6.4 核心功能：日历、编辑、年度总结、往年今日",
      "order": 17,
      "status": "DONE",
      "title": "集成 Milkdown 编辑器并支持基础 Markdown",
      "acceptance": "可编辑标题/列表/任务列表",
      "related_files": [
        "src/components/editor/*"
      ],
      "test_record": "\`npm run test:unit\` 通过（22/22）；\`npm run test:integration\` 通过（21/21）；\`npm run test:e2e\` 通过；\`npm run lint\` 通过；\`npm run build\` 通过",
      "done_record": "2026-02-08 / a71bf95",
      "source": {
        "file": "TODO.md",
        "line": 51
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_2c9128014306e56da869",
      "display_id": "TD-FUNC-003",
      "id_prefix": "FUNC",
      "module_key": "6.4",
      "module_name": "核心功能：日历、编辑、年度总结、往年今日",
      "module_label": "6.4 核心功能：日历、编辑、年度总结、往年今日",
      "order": 18,
      "status": "DONE",
      "title": "实现日记创建/读取/编辑流程",
      "acceptance": "按日期保存并可回显",
      "related_files": [
        "src/pages/editor.tsx",
        "src/hooks/use-diary.ts"
      ],
      "test_record": "\`npm run test:unit\` 通过（22/22）；\`npm run test:integration\` 通过（21/21）；\`npm run test:e2e\` 通过；\`npm run lint\` 通过；\`npm run build\` 通过",
      "done_record": "2026-02-08 / a71bf95",
      "source": {
        "file": "TODO.md",
        "line": 52
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_cc5af7c7c514b6216bd7",
      "display_id": "TD-FUNC-004",
      "id_prefix": "FUNC",
      "module_key": "6.4",
      "module_name": "核心功能：日历、编辑、年度总结、往年今日",
      "module_label": "6.4 核心功能：日历、编辑、年度总结、往年今日",
      "order": 19,
      "status": "DONE",
      "title": "实现编辑实时写入 IndexedDB",
      "acceptance": "刷新后本地内容不丢失",
      "related_files": [
        "src/hooks/use-diary.ts"
      ],
      "test_record": "\`npm run test:unit\` 通过（22/22）；\`npm run test:integration\` 通过（21/21）；\`npm run test:e2e\` 通过；\`npm run lint\` 通过；\`npm run build\` 通过",
      "done_record": "2026-02-08 / a71bf95",
      "source": {
        "file": "TODO.md",
        "line": 53
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_581a4a45dfd6ebf2d52a",
      "display_id": "TD-FUNC-005",
      "id_prefix": "FUNC",
      "module_key": "6.4",
      "module_name": "核心功能：日历、编辑、年度总结、往年今日",
      "module_label": "6.4 核心功能：日历、编辑、年度总结、往年今日",
      "order": 20,
      "status": "DONE",
      "title": "实现 30 秒防抖上传与手动保存立即上传",
      "acceptance": "符合触发时机定义",
      "related_files": [
        "src/hooks/use-sync.ts",
        "src/services/sync.ts"
      ],
      "test_record": "\`npm run test:unit\` 通过（22/22）；\`npm run test:integration\` 通过（21/21）；\`npm run test:e2e\` 通过；\`npm run lint\` 通过；\`npm run build\` 通过",
      "done_record": "2026-02-08 / a71bf95",
      "source": {
        "file": "TODO.md",
        "line": 54
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_eecf82b0102b7ede9645",
      "display_id": "TD-FUNC-006",
      "id_prefix": "FUNC",
      "module_key": "6.4",
      "module_name": "核心功能：日历、编辑、年度总结、往年今日",
      "module_label": "6.4 核心功能：日历、编辑、年度总结、往年今日",
      "order": 21,
      "status": "DONE",
      "title": "实现年度总结创建/编辑（\`YYYY-summary.md.enc\`）",
      "acceptance": "可按年份管理总结",
      "related_files": [
        "src/pages/yearly-summary.tsx"
      ],
      "test_record": "\`npm run test:unit\` 通过（22/22）；\`npm run test:integration\` 通过（21/21）；\`npm run test:e2e\` 通过；\`npm run lint\` 通过；\`npm run build\` 通过",
      "done_record": "2026-02-08 / a71bf95",
      "source": {
        "file": "TODO.md",
        "line": 55
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_1abcae207c67b9da3506",
      "display_id": "TD-FUNC-007",
      "id_prefix": "FUNC",
      "module_key": "6.4",
      "module_name": "核心功能：日历、编辑、年度总结、往年今日",
      "module_label": "6.4 核心功能：日历、编辑、年度总结、往年今日",
      "order": 22,
      "status": "DONE",
      "title": "实现“往年今日”查询与预览",
      "acceptance": "显示同月同日历史记录",
      "related_files": [
        "src/components/history/*"
      ],
      "test_record": "\`npm run test:unit\` 通过（22/22）；\`npm run test:integration\` 通过（21/21）；\`npm run test:e2e\` 通过；\`npm run lint\` 通过；\`npm run build\` 通过",
      "done_record": "2026-02-08 / a71bf95",
      "source": {
        "file": "TODO.md",
        "line": 56
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_6c9d25e5258050244a78",
      "display_id": "TD-FUNC-008",
      "id_prefix": "FUNC",
      "module_key": "6.4",
      "module_name": "核心功能：日历、编辑、年度总结、往年今日",
      "module_label": "6.4 核心功能：日历、编辑、年度总结、往年今日",
      "order": 23,
      "status": "DONE",
      "title": "实现“往年今日”虚拟滚动（react-window）",
      "acceptance": "历史数据较多时滚动流畅",
      "related_files": [
        "src/components/history/*"
      ],
      "test_record": "\`npm run test:unit\` 通过（22/22）；\`npm run test:integration\` 通过（21/21）；\`npm run test:e2e\` 通过；\`npm run lint\` 通过；\`npm run build\` 通过",
      "done_record": "2026-02-08 / a71bf95",
      "source": {
        "file": "TODO.md",
        "line": 57
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_a67e658adc8d55171571",
      "display_id": "TD-FUNC-009",
      "id_prefix": "FUNC",
      "module_key": "6.4",
      "module_name": "核心功能：日历、编辑、年度总结、往年今日",
      "module_label": "6.4 核心功能：日历、编辑、年度总结、往年今日",
      "order": 24,
      "status": "DONE",
      "title": "修复基础 Markdown 标题/列表视觉差异并新增可编辑源码模式",
      "acceptance": "标题（\`#\`）在可视化模式具备明显层级样式；无序/有序列表样式可见；支持“可视化/源码”双模式切换且内容双向同步、不丢失",
      "related_files": [
        "src/components/editor/markdown-editor.tsx",
        "src/components/editor/markdown-editor.css",
        "src/__tests__/integration/markdown-editor.integration.test.tsx",
        "e2e/specs/daily-edit.spec.ts",
        "e2e/specs/yearly-summary.spec.ts",
        "e2e/specs/calendar-history.spec.ts",
        "e2e/specs/manual-sync-hang-guard.spec.ts",
        "TODO.md"
      ],
      "test_record": "\`npm run lint\` 通过；\`npm run test:unit\` 通过（51/51）；\`npm run test:integration\` 通过（50/50）；\`npm run test:e2e\` 通过（21/21）",
      "done_record": "2026-02-11 / e465517",
      "source": {
        "file": "TODO.md",
        "line": 58
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_4b182dd29a949ffcd029",
      "display_id": "TD-SYNC-001",
      "id_prefix": "SYNC",
      "module_key": "6.5",
      "module_name": "同步与冲突解决",
      "module_label": "6.5 同步与冲突解决",
      "order": 25,
      "status": "DONE",
      "title": "封装 Gitee 文件读取与写入（优先 Authorization）",
      "acceptance": "支持 contents API 拉取与更新",
      "related_files": [
        "src/services/gitee.ts"
      ],
      "test_record": "\`npm run test:unit\` 通过（35/35）；\`npm run test:integration\` 通过（26/26）；\`npm run test:e2e\` 通过；\`npm run lint\` 通过",
      "done_record": "2026-02-09 / 5a2eb1c",
      "source": {
        "file": "TODO.md",
        "line": 64
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_2bda9594fb8fde90a512",
      "display_id": "TD-SYNC-002",
      "id_prefix": "SYNC",
      "module_key": "6.5",
      "module_name": "同步与冲突解决",
      "module_label": "6.5 同步与冲突解决",
      "order": 26,
      "status": "DONE",
      "title": "实现上传前 SHA 预检与 \`expectedSha\` CAS 更新",
      "acceptance": "更新请求携带正确 \`sha\`",
      "related_files": [
        "src/services/sync.ts"
      ],
      "test_record": "\`npm run test:unit\` 通过（35/35）；\`npm run test:integration\` 通过（26/26）；\`npm run test:e2e\` 通过；\`npm run lint\` 通过",
      "done_record": "2026-02-09 / 247234f",
      "source": {
        "file": "TODO.md",
        "line": 65
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_e9b5df153b68d64af1a8",
      "display_id": "TD-SYNC-003",
      "id_prefix": "SYNC",
      "module_key": "6.5",
      "module_name": "同步与冲突解决",
      "module_label": "6.5 同步与冲突解决",
      "order": 27,
      "status": "DONE",
      "title": "实现 \`sha mismatch\` 冲突识别",
      "acceptance": "冲突可被稳定检测",
      "related_files": [
        "src/services/sync.ts"
      ],
      "test_record": "\`npm run test:unit\` 通过（35/35）；\`npm run test:integration\` 通过（26/26）；\`npm run test:e2e\` 通过；\`npm run lint\` 通过",
      "done_record": "2026-02-09 / 247234f",
      "source": {
        "file": "TODO.md",
        "line": 66
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_5591f65d149d69fb7c51",
      "display_id": "TD-SYNC-004",
      "id_prefix": "SYNC",
      "module_key": "6.5",
      "module_name": "同步与冲突解决",
      "module_label": "6.5 同步与冲突解决",
      "order": 28,
      "status": "DONE",
      "title": "实现冲突弹窗（本地/远端/合并）",
      "acceptance": "三种分支均可完成",
      "related_files": [
        "src/components/common/*",
        "src/pages/workspace.tsx",
        "src/pages/yearly-summary.tsx",
        "src/services/sync.ts",
        "src/hooks/use-sync.ts"
      ],
      "test_record": "\`npm run test:unit\` 通过（35/35）；\`npm run test:integration\` 通过（26/26）；\`npm run test:e2e\` 通过；\`npm run lint\` 通过",
      "done_record": "2026-02-09 / 0616277",
      "source": {
        "file": "TODO.md",
        "line": 67
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_e0cfeed8204cd1ca8b00",
      "display_id": "TD-SYNC-005",
      "id_prefix": "SYNC",
      "module_key": "6.5",
      "module_name": "同步与冲突解决",
      "module_label": "6.5 同步与冲突解决",
      "order": 29,
      "status": "DONE",
      "title": "实现离线检测与网络恢复自动重试",
      "acceptance": "断网有提示，恢复后自动同步",
      "related_files": [
        "src/hooks/use-sync.ts"
      ],
      "test_record": "\`npm run test:unit\` 通过（35/35）；\`npm run test:integration\` 通过（26/26）；\`npm run test:e2e\` 通过；\`npm run lint\` 通过",
      "done_record": "2026-02-09 / c991e44",
      "source": {
        "file": "TODO.md",
        "line": 68
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_de307af79de9489e48e9",
      "display_id": "TD-SYNC-006",
      "id_prefix": "SYNC",
      "module_key": "6.5",
      "module_name": "同步与冲突解决",
      "module_label": "6.5 同步与冲突解决",
      "order": 30,
      "status": "DONE",
      "title": "修复日期切换内容错位并提升云端上传可用性反馈（不含加密改造）",
      "acceptance": "标题日期与编辑器内容一致；未解锁/未配置时给出明确不可上传提示；手动上传失败可读",
      "related_files": [
        "src/hooks/use-diary.ts",
        "src/components/editor/markdown-editor.tsx",
        "src/pages/workspace.tsx",
        "src/pages/yearly-summary.tsx",
        "src/hooks/use-sync.ts",
        "src/__tests__/*"
      ],
      "test_record": "\`npm run test:unit\` 通过（35/35）；\`npm run test:integration\` 通过（28/28）；\`npm run test:e2e\` 通过；\`npm run lint\` 通过",
      "done_record": "2026-02-09 / cb7823e",
      "source": {
        "file": "TODO.md",
        "line": 69
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_f8166d77ab20547c4121",
      "display_id": "TD-SYNC-007",
      "id_prefix": "SYNC",
      "module_key": "6.5",
      "module_name": "同步与冲突解决",
      "module_label": "6.5 同步与冲突解决",
      "order": 31,
      "status": "DONE",
      "title": "修复 Gitee 默认分支与写入方法导致的同步失败，并补齐可暴露该问题的测试",
      "acceptance": "默认分支兼容 \`master\`；可配置分支；手动与自动上传可成功；测试可覆盖真实失败原因",
      "related_files": [
        "src/types/config.ts",
        "src/hooks/use-auth.ts",
        "src/components/auth/auth-modal.tsx",
        "src/pages/workspace.tsx",
        "src/pages/yearly-summary.tsx",
        "src/services/gitee.ts",
        "src/services/sync.ts",
        "src/services/__tests__/*",
        "src/hooks/__tests__/*",
        "scripts/e2e-smoke.sh"
      ],
      "test_record": "\`npm run test:unit\` 通过（37/37）；\`npm run test:integration\` 通过（29/29）；\`npm run test:e2e\` 通过；\`npm run lint\` 通过",
      "done_record": "2026-02-09 / b87ead4",
      "source": {
        "file": "TODO.md",
        "line": 70
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_0602f9f7bebe7fde9747",
      "display_id": "TD-SYNC-008",
      "id_prefix": "SYNC",
      "module_key": "6.5",
      "module_name": "同步与冲突解决",
      "module_label": "6.5 同步与冲突解决",
      "order": 32,
      "status": "DONE",
      "title": "手动上传失败原因改为按钮旁内联提示，并返回可消费的手动上传结果",
      "acceptance": "手动点击失败时在按钮旁显示具体原因；自动上传失败不占用该提示位；日记与年度总结页行为一致",
      "related_files": [
        "src/hooks/use-sync.ts",
        "src/pages/workspace.tsx",
        "src/pages/yearly-summary.tsx",
        "src/hooks/__tests__/use-sync.test.ts",
        "src/__tests__/integration/*"
      ],
      "test_record": "\`npm run test:unit\` 通过（37/37）；\`npm run test:integration\` 通过（30/30）；\`npm run test:e2e\` 通过；\`npm run lint\` 通过",
      "done_record": "2026-02-09 / 932ab2c",
      "source": {
        "file": "TODO.md",
        "line": 71
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_f468bd6539107aef6cc0",
      "display_id": "TD-SYNC-009",
      "id_prefix": "SYNC",
      "module_key": "6.5",
      "module_name": "同步与冲突解决",
      "module_label": "6.5 同步与冲突解决",
      "order": 33,
      "status": "DONE",
      "title": "修复手动上传在并发场景下静默失败（禁止并发并提供明确反馈）",
      "acceptance": "上传进行中点击手动按钮会给出“请稍候”提示且不静默；按钮在同步中禁用；失败分支均有可消费错误信息",
      "related_files": [
        "src/hooks/use-sync.ts",
        "src/pages/workspace.tsx",
        "src/pages/yearly-summary.tsx",
        "src/hooks/__tests__/use-sync.test.ts",
        "src/__tests__/integration/editor.integration.test.tsx"
      ],
      "test_record": "\`npm run test:unit\` 通过（37/37）；\`npm run test:integration\` 通过（32/32）；\`npm run test:e2e\` 通过；\`npm run lint\` 通过；\`npm run build\` 通过",
      "done_record": "2026-02-09 / c5cbdf2",
      "source": {
        "file": "TODO.md",
        "line": 72
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_3c69b9709c804165f87e",
      "display_id": "TD-SYNC-010",
      "id_prefix": "SYNC",
      "module_key": "6.5",
      "module_name": "同步与冲突解决",
      "module_label": "6.5 同步与冲突解决",
      "order": 34,
      "status": "DONE",
      "title": "修复上传分支不匹配导致的持续失败并增强失败可观测性",
      "acceptance": "配置分支不存在时可自动回退到可用分支并上传成功；手动与自动失败原因可见且不被静默覆盖",
      "related_files": [
        "src/services/sync.ts",
        "src/pages/workspace.tsx",
        "src/pages/yearly-summary.tsx",
        "src/services/__tests__/sync.test.ts",
        "src/__tests__/integration/editor.integration.test.tsx"
      ],
      "test_record": "\`npm run test:unit\` 通过（38/38）；\`npm run test:integration\` 通过（32/32）；\`npm run test:e2e\` 通过；\`npm run lint\` 通过；\`npm run build\` 通过",
      "done_record": "2026-02-09 / 996b21d",
      "source": {
        "file": "TODO.md",
        "line": 73
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_f9912f126a1acc98ac28",
      "display_id": "TD-SYNC-011",
      "id_prefix": "SYNC",
      "module_key": "6.5",
      "module_name": "同步与冲突解决",
      "module_label": "6.5 同步与冲突解决",
      "order": 35,
      "status": "DONE",
      "title": "修复上传请求卡死导致长期处于 syncing 的问题（增加超时保护）",
      "acceptance": "上传请求超时后应自动结束 syncing 并给出明确错误；后续手动上传可继续触发；不再长期显示“正在上传”",
      "related_files": [
        "src/hooks/use-sync.ts",
        "src/hooks/__tests__/use-sync.test.ts"
      ],
      "test_record": "\`npm run test:unit\` 通过（38/38）；\`npm run test:integration\` 通过（33/33）；\`npm run test:e2e\` 通过；\`npm run lint\` 通过；\`npm run build\` 通过",
      "done_record": "2026-02-09 / 78152db",
      "source": {
        "file": "TODO.md",
        "line": 74
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_5c5a0479a5e37bb7e14c",
      "display_id": "TD-SYNC-012",
      "id_prefix": "SYNC",
      "module_key": "6.5",
      "module_name": "同步与冲突解决",
      "module_label": "6.5 同步与冲突解决",
      "order": 36,
      "status": "DONE",
      "title": "修复失败后排队任务持续重入导致同步长时间不退出的问题",
      "acceptance": "上传失败/超时后不应立刻重启下一轮上传；busy 提示在退出 syncing 后自动清理；状态可恢复到可重试",
      "related_files": [
        "src/hooks/use-sync.ts",
        "src/pages/workspace.tsx",
        "src/pages/yearly-summary.tsx",
        "src/hooks/__tests__/use-sync.test.ts"
      ],
      "test_record": "\`npm run test:unit\` 通过（38/38）；\`npm run test:integration\` 通过（33/33）；\`npm run test:e2e\` 通过；\`npm run lint\` 通过；\`npm run build\` 通过",
      "done_record": "2026-02-09 / 07de517",
      "source": {
        "file": "TODO.md",
        "line": 75
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_46afe40527c4d82ca27b",
      "display_id": "TD-SYNC-013",
      "id_prefix": "SYNC",
      "module_key": "6.5",
      "module_name": "同步与冲突解决",
      "module_label": "6.5 同步与冲突解决",
      "order": 37,
      "status": "DONE",
      "title": "修复同步中手动上传按钮无响应（移除 disabled 并保留忙碌反馈）",
      "acceptance": "同步中按钮可点击；点击后立刻提示“当前正在上传，请稍候重试”；不再出现无响应体感",
      "related_files": [
        "src/pages/workspace.tsx",
        "src/pages/yearly-summary.tsx",
        "src/__tests__/integration/editor.integration.test.tsx"
      ],
      "test_record": "\`npm run test:unit\` 通过（38/38）；\`npm run test:integration\` 通过（33/33）；\`npm run test:e2e\` 通过；\`npm run lint\` 通过；\`npm run build\` 通过",
      "done_record": "2026-02-09 / 87ed64f",
      "source": {
        "file": "TODO.md",
        "line": 76
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_be15cc63775ee9ae0ee6",
      "display_id": "TD-SYNC-014",
      "id_prefix": "SYNC",
      "module_key": "6.5",
      "module_name": "同步与冲突解决",
      "module_label": "6.5 同步与冲突解决",
      "order": 38,
      "status": "DONE",
      "title": "增强手动上传点击反馈可见性（点击即显示已触发状态）",
      "acceptance": "每次点击手动上传都应立即出现可见反馈，且 busy/失败信息不被自动隐藏",
      "related_files": [
        "src/pages/workspace.tsx",
        "src/pages/yearly-summary.tsx",
        "src/__tests__/integration/editor.integration.test.tsx"
      ],
      "test_record": "\`npm run test:unit\` 通过（38/38）；\`npm run test:integration\` 通过（33/33）；\`npm run test:e2e\` 通过；\`npm run lint\` 通过；\`npm run build\` 通过",
      "done_record": "2026-02-09 / 6c7962f",
      "source": {
        "file": "TODO.md",
        "line": 77
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_9d22e524d38ae5262396",
      "display_id": "TD-SYNC-015",
      "id_prefix": "SYNC",
      "module_key": "6.5",
      "module_name": "同步与冲突解决",
      "module_label": "6.5 同步与冲突解决",
      "order": 39,
      "status": "DONE",
      "title": "修复同步可靠性与加密模型一致性问题（队列保留/冲突解密/CAS方法/主密码派生密钥）",
      "acceptance": "失败后保留并可重放最新排队 payload；冲突展示远端明文且不双重加密；metadata CAS 更新使用 PUT；日记数据密钥改为主密码派生并贯通上传链路",
      "related_files": [
        "src/hooks/use-sync.ts",
        "src/hooks/__tests__/use-sync.test.ts",
        "src/services/sync.ts",
        "src/services/__tests__/sync.test.ts",
        "src/hooks/use-auth.ts",
        "src/hooks/__tests__/use-auth.test.tsx",
        "src/pages/workspace.tsx",
        "src/pages/yearly-summary.tsx"
      ],
      "test_record": "\`npm run test:unit\` 通过（42/42）；\`npm run test:integration\` 通过（35/35）；\`npm run test:e2e\` 通过（7/7）；\`npm run lint\` 通过",
      "done_record": "2026-02-09 / 1fcf734",
      "source": {
        "file": "TODO.md",
        "line": 78
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_675ec2becce6625b68e0",
      "display_id": "TD-SYNC-016",
      "id_prefix": "SYNC",
      "module_key": "6.5",
      "module_name": "同步与冲突解决",
      "module_label": "6.5 同步与冲突解决",
      "order": 40,
      "status": "DONE",
      "title": "修复自动解锁后缺少数据加密密钥导致手动上传异常，并增强同步状态可观测性",
      "acceptance": "自动解锁后可直接手动上传；并发触发“请稍候重试”不会在非上传中状态残留；状态区可区分是否存在未提交改动",
      "related_files": [
        "src/hooks/use-auth.ts",
        "src/services/crypto.ts",
        "src/hooks/use-sync.ts",
        "src/pages/workspace.tsx",
        "src/pages/yearly-summary.tsx",
        "src/hooks/__tests__/use-auth.test.tsx"
      ],
      "test_record": "\`npm run test:unit\` 通过（43/43）；\`npm run test:integration\` 通过（39/39）；\`npm run test:e2e\` 通过（17/17）；\`npx playwright test e2e/specs/manual-sync-success.spec.ts e2e/specs/manual-sync-busy-clear.spec.ts e2e/specs/daily-edit.spec.ts --project=chromium --repeat-each=3 --retries=0\` 通过（9/9）；\`npm run build\` 通过；\`npm run lint\` 失败（仓库既有问题：\`e2e/helpers/conflict.ts:247 no-unsafe-finally\`）",
      "done_record": "2026-02-10 / 4578a86",
      "source": {
        "file": "TODO.md",
        "line": 79
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_f10bdb5f74458c81711f",
      "display_id": "TD-SYNC-017",
      "id_prefix": "SYNC",
      "module_key": "6.5",
      "module_name": "同步与冲突解决",
      "module_label": "6.5 同步与冲突解决",
      "order": 41,
      "status": "DONE",
      "title": "修复自动同步成功后“最近同步时间”未更新并补齐端到端回归用例",
      "acceptance": "自动同步成功后“最近同步”应刷新为最新时间；同页连续两次成功同步时后一次时间严格晚于前一次；新增 E2E 用例稳定通过",
      "related_files": [
        "src/hooks/use-sync.ts",
        "src/pages/workspace.tsx",
        "e2e/specs/auto-sync-last-synced.spec.ts"
      ],
      "test_record": "\`npm run test:unit\` 通过（43/43）；\`npm run test:integration\` 通过（40/40）；\`npm run test:e2e\` 通过（17 passed，1 flaky 重试通过）；\`npx playwright test e2e/specs/auto-sync-last-synced.spec.ts --project=chromium --repeat-each=3 --retries=0\` 通过（3/3）",
      "done_record": "2026-02-10 / ff12550",
      "source": {
        "file": "TODO.md",
        "line": 80
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_f38e78b169542ac63fc0",
      "display_id": "TD-SYNC-018",
      "id_prefix": "SYNC",
      "module_key": "6.5",
      "module_name": "同步与冲突解决",
      "module_label": "6.5 同步与冲突解决",
      "order": 42,
      "status": "DONE",
      "title": "新增“手动上传成功后状态应收敛”端到端回归用例（覆盖 pending 提示消失后仍待同步风险）",
      "acceptance": "点击“手动保存并立即上传”后应先出现“手动上传已触发，正在等待结果...”，随后提示消失；远端上传成功后页面状态应为“云端已同步”且“未提交改动：无”",
      "related_files": [
        "e2e/specs/manual-sync-state-consistency.spec.ts",
        "TODO.md"
      ],
      "test_record": "\`npx playwright test e2e/specs/manual-sync-state-consistency.spec.ts --project=chromium --retries=0\` 通过（1/1）；\`npx playwright test e2e/specs/manual-sync-state-consistency.spec.ts --project=chromium --repeat-each=3 --retries=0\` 通过（3/3）；\`npm run test:unit\` 通过（43/43）；\`npm run test:integration\` 通过（40/40）；\`npm run test:e2e\` 通过（19/19）",
      "done_record": "2026-02-10 / 382f07b",
      "source": {
        "file": "TODO.md",
        "line": 81
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_6fdbd7ae000e57e521ea",
      "display_id": "TD-SYNC-019",
      "id_prefix": "SYNC",
      "module_key": "6.5",
      "module_name": "同步与冲突解决",
      "module_label": "6.5 同步与冲突解决",
      "order": 43,
      "status": "DONE",
      "title": "修复手动上传后状态不收敛（自动上传悬挂导致长期 syncing）并补齐去重与超时回归测试",
      "acceptance": "手动上传成功后若触发同内容自动上传不应重复请求；自动上传悬挂时应在超时后退出 syncing 并给出可重试错误；状态可恢复并与远端结果一致",
      "related_files": [
        "src/hooks/use-sync.ts",
        "src/hooks/__tests__/use-sync.test.ts",
        "src/__tests__/integration/editor.integration.test.tsx",
        "e2e/specs/manual-sync-hang-guard.spec.ts",
        "e2e/specs/auto-sync-last-synced.spec.ts",
        "TODO.md"
      ],
      "test_record": "\`npm run test:unit\` 通过（43/43）；\`npm run test:integration\` 通过（43/43）；\`npx playwright test e2e/specs/manual-sync-hang-guard.spec.ts --project=chromium --retries=0\` 通过（1/1）；\`npx playwright test e2e/specs/auto-sync-last-synced.spec.ts --project=chromium --retries=0\` 通过（1/1）；\`npm run test:e2e\` 通过（20/20）",
      "done_record": "2026-02-10 / 4a20958",
      "source": {
        "file": "TODO.md",
        "line": 82
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_d1f2b97ef0111cb6a1be",
      "display_id": "TD-SYNC-020",
      "id_prefix": "SYNC",
      "module_key": "6.5",
      "module_name": "同步与冲突解决",
      "module_label": "6.5 同步与冲突解决",
      "order": 44,
      "status": "DONE",
      "title": "落地服务层最小重构（收敛 Base64/UTF-8、统一 metadata 走 Gitee 网关、固化 sync/gitee 职责边界，并统一测试入口）",
      "acceptance": "\`sync.ts\` 不再维护重复文本 Base64 实现且 metadata 读写不直接发起 contents API；\`gitee.ts\` 作为唯一 Gitee 网关；测试入口统一为 \`src/__tests__/\` 且单元/集成/E2E 全部通过",
      "related_files": [
        "src/services/sync.ts",
        "src/services/gitee.ts",
        "src/services/__tests__/sync.test.ts",
        "src/test/setup.ts",
        "src/__tests__/setup.ts",
        "vitest.config.ts",
        "TODO.md"
      ],
      "test_record": "\`npm run test:unit\` 通过（48/48）；\`npm run test:integration\` 通过（43/43）；\`npm run test:e2e\` 通过（19 passed，1 flaky 重试通过，网络超时后重试成功）；\`npm run lint\` 失败（仓库既有问题：\`e2e/helpers/conflict.ts:247 no-unsafe-finally\`）；\`npm run build\` 通过",
      "done_record": "2026-02-10 / 9733c4e",
      "source": {
        "file": "TODO.md",
        "line": 83
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_50c3f532f9250e61a45c",
      "display_id": "TD-SYNC-021",
      "id_prefix": "SYNC",
      "module_key": "6.5",
      "module_name": "同步与冲突解决",
      "module_label": "6.5 同步与冲突解决",
      "order": 45,
      "status": "DONE",
      "title": "清理跨层重复实现（同步状态/手动上传文案、认证表单结构、crypto/sync 基础工具）并收敛公共模块",
      "acceptance": "\`workspace/yearly-summary\` 共享同步状态与手动上传文案逻辑；\`welcome/auth-modal\` 共享认证表单配置；\`sync.ts\` 不再重复实现可复用的 crypto 基础工具；单元/集成/E2E 全部通过",
      "related_files": [
        "src/pages/workspace.tsx",
        "src/pages/yearly-summary.tsx",
        "src/components/common/status-hint.tsx",
        "src/utils/sync-availability.ts",
        "src/utils/sync-presentation.ts",
        "src/pages/welcome.tsx",
        "src/components/auth/auth-modal.tsx",
        "src/components/auth/auth-form-model.ts",
        "src/components/auth/auth-form-shared.tsx",
        "src/services/sync.ts",
        "src/services/crypto.ts",
        "src/services/__tests__/sync.test.ts",
        "TODO.md"
      ],
      "test_record": "\`npm run test:unit\` 通过（48/48）；\`npm run test:integration\` 通过（43/43）；\`npm run test:e2e\` 通过（20/20）；\`npm run lint\` 失败（仓库既有问题：\`e2e/helpers/conflict.ts:247 no-unsafe-finally\`）；\`npm run build\` 通过",
      "done_record": "2026-02-10 / da84ae1",
      "source": {
        "file": "TODO.md",
        "line": 84
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_096d335e1a98c9479b51",
      "display_id": "TD-SYNC-022",
      "id_prefix": "SYNC",
      "module_key": "6.5",
      "module_name": "同步与冲突解决",
      "module_label": "6.5 同步与冲突解决",
      "order": 46,
      "status": "DONE",
      "title": "重构未提交改动判定为“按 entry 基线 + 内容指纹”，修复手动上传点击即从“无”变“有”与跨日期脏状态污染",
      "acceptance": "未提交改动仅在“从未提交”或“提交后内容变化”时显示“有”；手动上传点击不应无条件变脏；切换其他日期不应继承脏状态",
      "related_files": [
        "src/hooks/use-sync.ts",
        "src/services/indexeddb.ts",
        "src/pages/workspace.tsx",
        "src/pages/yearly-summary.tsx",
        "src/utils/sync-dirty.ts",
        "src/hooks/__tests__/use-sync.test.ts",
        "TODO.md"
      ],
      "test_record": "\`npm run lint\` 通过；\`npm run test:unit\` 通过（48/48）；\`npm run test:integration\` 通过（45/45）；\`npm run test:e2e\` 通过（20/20）；\`npm run build\` 通过",
      "done_record": "2026-02-10 / 70ad5b8",
      "source": {
        "file": "TODO.md",
        "line": 85
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_536d776276d1ce109f1d",
      "display_id": "TD-SYNC-023",
      "id_prefix": "SYNC",
      "module_key": "6.5",
      "module_name": "同步与冲突解决",
      "module_label": "6.5 同步与冲突解决",
      "order": 47,
      "status": "DONE",
      "title": "修复下载同步缺失导致云端日记无法落本地（解锁后自动拉取并按 \`modifiedAt\` 决策覆盖）",
      "acceptance": "解锁后自动从远端拉取 metadata 与对应日记并写入 IndexedDB；云端已有 \`2100-01-01\` 时页面可见；同条目仅在远端 \`modifiedAt\` 更新时覆盖本地",
      "related_files": [
        "src/services/sync.ts",
        "src/hooks/use-auth.ts",
        "src/pages/workspace.tsx",
        "src/pages/yearly-summary.tsx",
        "src/services/__tests__/sync.test.ts",
        "src/hooks/__tests__/use-auth.test.tsx",
        "src/__tests__/integration/*",
        "e2e/specs/*",
        "TODO.md"
      ],
      "test_record": "\`npm run test:unit\` 通过（50/50）；\`npm run test:integration\` 通过（46/46）；\`npm run test:e2e\` 通过（21/21）",
      "done_record": "2026-02-11 / 42008cc",
      "source": {
        "file": "TODO.md",
        "line": 86
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_67d7813854f0e4f27f41",
      "display_id": "TD-SYNC-024",
      "id_prefix": "SYNC",
      "module_key": "6.5",
      "module_name": "同步与冲突解决",
      "module_label": "6.5 同步与冲突解决",
      "order": 48,
      "status": "DONE",
      "title": "将数据密钥改为仅由主密码导出并补齐“内容可解密可读”的端到端校验",
      "acceptance": "数据加密主密钥不再依赖 \`kdfParams\` 随机盐；仅凭主密码可导出同一数据密钥；相关 E2E 必须断言拉取后内容可读且非空",
      "related_files": [
        "src/services/crypto.ts",
        "src/hooks/use-auth.ts",
        "src/services/sync.ts",
        "src/pages/workspace.tsx",
        "src/pages/yearly-summary.tsx",
        "src/components/editor/markdown-editor.tsx",
        "src/hooks/use-diary.ts",
        "src/services/__tests__/crypto.test.ts",
        "src/services/__tests__/sync.test.ts",
        "src/hooks/__tests__/use-auth.test.tsx",
        "src/hooks/__tests__/use-diary.test.ts",
        "e2e/specs/remote-pull-sync.spec.ts",
        "TODO.md"
      ],
      "test_record": "用户明确授权采用必要测试策略；已执行：\`npm run lint\`（通过）、\`npm run test:unit\`（53/53 通过）、\`npm run test:integration\`（47/47 通过）、\`npx playwright test e2e/specs/remote-pull-sync.spec.ts --project=chromium --retries=0\`（1/1 通过）；未执行全量 \`npm run test:e2e\`（已按授权仅执行与改动直接相关用例）",
      "done_record": "2026-02-11 / 1965ec9",
      "source": {
        "file": "TODO.md",
        "line": 87
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_a24b41639534d9f76ebc",
      "display_id": "TD-SYNC-025",
      "id_prefix": "SYNC",
      "module_key": "6.5",
      "module_name": "同步与冲突解决",
      "module_label": "6.5 同步与冲突解决",
      "order": 49,
      "status": "DONE",
      "title": "移除 fallback 密钥逻辑并强制仅使用主密码派生密钥进行加解密",
      "acceptance": "代码中不再保留 fallback 密钥参数、状态与解密分支；上传与下载仅使用主密码派生数据密钥；相关单元/集成/E2E 回归通过",
      "related_files": [
        "src/hooks/use-auth.ts",
        "src/services/sync.ts",
        "src/pages/workspace.tsx",
        "src/pages/yearly-summary.tsx",
        "src/hooks/__tests__/use-auth.test.tsx",
        "src/services/__tests__/sync.test.ts",
        "e2e/specs/upload-encryption.spec.ts",
        "e2e/specs/conflict-resolution.spec.ts",
        "TODO.md"
      ],
      "test_record": "用户明确授权“可不跑全量 E2E”；已执行：\`npm run lint\`（通过）、\`npm run test:unit\`（51/51 通过）、\`npm run test:integration\`（47/47 通过）、\`npx playwright test e2e/specs/remote-pull-sync.spec.ts e2e/specs/upload-encryption.spec.ts --project=chromium --retries=0\`（2/2 通过）；未执行全量 \`npm run test:e2e\`（按授权仅执行最相关用例）",
      "done_record": "2026-02-11 / 38f812d",
      "source": {
        "file": "TODO.md",
        "line": 88
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_66a5c2fe2fc038fff396",
      "display_id": "TD-SYNC-026",
      "id_prefix": "SYNC",
      "module_key": "6.5",
      "module_name": "同步与冲突解决",
      "module_label": "6.5 同步与冲突解决",
      "order": 50,
      "status": "DONE",
      "title": "清空 \`.env.e2e\` 指向测试仓库并按主密码密钥重建测试密文数据",
      "acceptance": "远端旧密文被清空；重建后的 \`metadata.json.enc\` 与示例日记文件可被主密码成功解密且内容可读",
      "related_files": [
        "TODO.md"
      ],
      "test_record": "已执行远端清空与重建脚本并校验通过：清理后文件数 \`0\`，重建后文件数 \`4\`（\`2100-01-01.md.enc\`、\`2100-06-06.md.enc\`、\`2100-summary.md.enc\`、\`metadata.json.enc\`）；回读后使用 \`E2E_MASTER_PASSWORD\` 可成功解密 \`metadata.json.enc\` 与 \`2100-01-01.md.enc\`，内容可读",
      "done_record": "2026-02-11 / 1be61cb",
      "source": {
        "file": "TODO.md",
        "line": 89
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_132d9cdef8d8cb2ee418",
      "display_id": "TD-SYNC-027",
      "id_prefix": "SYNC",
      "module_key": "6.5",
      "module_name": "同步与冲突解决",
      "module_label": "6.5 同步与冲突解决",
      "order": 51,
      "status": "DONE",
      "title": "永久移除自动上传并收敛为“仅手动同步”链路",
      "acceptance": "编辑过程不再触发任何自动上传请求；手动上传作为唯一远端写入入口；状态显示与测试用例不再依赖自动上传/自动重试语义",
      "related_files": [
        "src/hooks/use-sync.ts",
        "src/services/sync.ts",
        "src/pages/workspace.tsx",
        "src/pages/yearly-summary.tsx",
        "src/utils/sync-presentation.ts",
        "src/hooks/__tests__/use-sync.test.ts",
        "src/services/__tests__/sync.test.ts",
        "src/__tests__/integration/editor.integration.test.tsx",
        "e2e/specs/auto-sync-last-synced.spec.ts",
        "e2e/specs/calendar-history.spec.ts",
        "e2e/specs/manual-sync-hang-guard.spec.ts",
        "e2e/specs/manual-sync-failure.spec.ts",
        "TODO.md"
      ],
      "test_record": "\`npm run lint\` 通过；\`npm run test:unit\` 通过（51/51）；\`npm run test:integration\` 通过（42/42）；\`npm run test:e2e\` 通过（20 passed，1 flaky：\`manual-sync-failure\` 重试通过）",
      "done_record": "2026-02-11 / f186e02",
      "source": {
        "file": "TODO.md",
        "line": 90
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_89497c2c4abaeebec1f3",
      "display_id": "TD-SYNC-028",
      "id_prefix": "SYNC",
      "module_key": "6.5",
      "module_name": "同步与冲突解决",
      "module_label": "6.5 同步与冲突解决",
      "order": 52,
      "status": "DONE",
      "title": "修复手动 Push 后状态不收敛并拆分 Pull/Push 按钮（Push 取消预检读取，冲突统一走弹窗处理）",
      "acceptance": "Push 成功后状态可收敛为“云端已同步”；编辑页支持独立 Pull/Push；Push 不再先读取远端内容；Pull/Push 冲突均可进入冲突弹窗",
      "related_files": [
        "src/services/sync.ts",
        "src/hooks/use-sync.ts",
        "src/pages/workspace.tsx",
        "src/pages/yearly-summary.tsx",
        "src/utils/sync-presentation.ts",
        "src/utils/sync-dirty.ts",
        "src/services/__tests__/sync.test.ts",
        "src/hooks/__tests__/use-sync.test.ts",
        "src/__tests__/integration/editor.integration.test.tsx",
        "e2e/specs/manual-sync-*.spec.ts",
        "SPEC.md",
        "TODO.md"
      ],
      "test_record": "\`npm run lint\` 通过；\`npm run test:unit\` 通过（54/54）；\`npm run test:integration\` 通过（43/43）；\`npx playwright test e2e/specs/manual-sync-success.spec.ts --project=chromium --retries=0 --workers=1\` 通过（1/1）；\`npx playwright test e2e/specs/manual-sync-state-consistency.spec.ts e2e/specs/yearly-summary.spec.ts --project=chromium --retries=0 --workers=1\` 通过（3/3）；\`npx playwright test e2e/specs/conflict-resolution.spec.ts --project=chromium --workers=1 --retries=1 --grep \\\\\\"保留本地版本\\\\\\"\` 通过（1/1）",
      "done_record": "2026-02-11 / e01a8ce",
      "source": {
        "file": "TODO.md",
        "line": 91
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_4700c855a486844f90ce",
      "display_id": "TD-SYNC-029",
      "id_prefix": "SYNC",
      "module_key": "6.5",
      "module_name": "同步与冲突解决",
      "module_label": "6.5 同步与冲突解决",
      "order": 53,
      "status": "DONE",
      "title": "修复“push 成功后仍显示云端待同步”状态不收敛问题（覆盖刷新后状态恢复）",
      "acceptance": "push 成功后状态应收敛为“云端已同步”；刷新/重进页面后仍保持“云端已同步”；新增回归测试可稳定覆盖该链路",
      "related_files": [
        "src/hooks/use-sync.ts",
        "src/hooks/__tests__/use-sync.test.ts",
        "e2e/specs/manual-sync-state-consistency.spec.ts",
        "e2e/specs/yearly-summary.spec.ts",
        "TODO.md"
      ],
      "test_record": "\`npm run lint\` 通过；\`npm run test:unit\` 通过（58/58）；\`npm run test:integration\` 通过（53/53）；\`npm run test:e2e:full\` 首次失败（新 worktree 缺少 \`.env.e2e\`）；复制主工作区 \`.env.e2e\` 后重跑 \`npm run test:e2e:full\` 通过（21/21）",
      "done_record": "2026-02-13 / 517ef81",
      "source": {
        "file": "TODO.md",
        "line": 92
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_912c9433f9fab43547ac",
      "display_id": "TD-SYNC-030",
      "id_prefix": "SYNC",
      "module_key": "6.5",
      "module_name": "同步与冲突解决",
      "module_label": "6.5 同步与冲突解决",
      "order": 54,
      "status": "DONE",
      "title": "将“云端待同步/已同步”判定收敛为时间戳方案（本地修改时间 vs 最后同步时间）",
      "acceptance": "push 成功后基于 \`lastSyncedAt\` 与本地 \`modifiedAt\` 判定“已同步/待同步”；刷新后状态保持一致；相关单元/集成/E2E 回归通过",
      "related_files": [
        "src/hooks/use-sync.ts",
        "src/pages/workspace.tsx",
        "src/pages/yearly-summary.tsx",
        "src/hooks/__tests__/use-sync.test.ts",
        "e2e/fixtures/app.ts",
        "TODO.md"
      ],
      "test_record": "\`npm run lint\` 通过；\`npm run test:unit\` 通过（58/58）；\`npm run test:integration\` 通过（54/54）；\`npm run test:e2e:full\` 首轮失败（11 failed，根因为 fixture 仅匹配 \`.ProseMirror\` 与默认源码模式不兼容）；修复 \`e2e/fixtures/app.ts\` 后执行 \`npx playwright test e2e/specs/manual-sync-success.spec.ts e2e/specs/manual-sync-state-consistency.spec.ts e2e/specs/manual-sync-busy-clear.spec.ts --project=chromium --retries=0 --workers=1\` 通过（3/3）；\`npx playwright test e2e/specs/conflict-resolution.spec.ts e2e/specs/manual-sync-failure.spec.ts e2e/specs/manual-sync-hang-guard.spec.ts e2e/specs/remote-pull-sync.spec.ts e2e/specs/upload-encryption.spec.ts --project=chromium --retries=0 --workers=1\` 通过（8/8）；重跑 \`npm run test:e2e:full\` 通过（21/21）",
      "done_record": "2026-02-13 / 4735ee9",
      "source": {
        "file": "TODO.md",
        "line": 93
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_fba78c7748d27ee3f711",
      "display_id": "TD-SYNC-031",
      "id_prefix": "SYNC",
      "module_key": "6.5",
      "module_name": "同步与冲突解决",
      "module_label": "6.5 同步与冲突解决",
      "order": 55,
      "status": "DONE",
      "title": "移除“云端待同步/已同步”推断展示，改为 Pull/Push 执行结果与时间展示（不显示耗时）",
      "acceptance": "工作台与年度总结页均展示 \`Pull\` 与 \`Push\` 最近执行状态（未执行/进行中/成功/失败）及绝对时间；不再展示“云端待同步/已同步”胶囊；刷新后状态可恢复；相关单元/集成/E2E 回归通过",
      "related_files": [
        "src/utils/sync-presentation.ts",
        "src/pages/workspace.tsx",
        "src/pages/yearly-summary.tsx",
        "src/__tests__/integration/editor.integration.test.tsx",
        "e2e/fixtures/app.ts",
        "e2e/specs/manual-sync-*.spec.ts",
        "e2e/specs/conflict-resolution.spec.ts",
        "e2e/specs/yearly-summary.spec.ts",
        "TODO.md"
      ],
      "test_record": "\`npm run lint\` 通过；\`npm run test:unit\` 通过（58/58）；\`npm run test:integration\` 通过（54/54）；\`npx playwright test e2e/specs/conflict-resolution.spec.ts --project=chromium --workers=1 --retries=1\` 通过（4/4）；\`npm run test:e2e:full\` 通过（21/21）",
      "done_record": "2026-02-14 / a4bee89",
      "source": {
        "file": "TODO.md",
        "line": 94
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_e1fc1f60d7b7d83c5be0",
      "display_id": "TD-SYNC-032",
      "id_prefix": "SYNC",
      "module_key": "6.5",
      "module_name": "同步与冲突解决",
      "module_label": "6.5 同步与冲突解决",
      "order": 56,
      "status": "DONE",
      "title": "同步工具栏 UI 升级为“仪表条 Pro”并引入去重 Toast（同类型全局唯一），新增空内容 Push 拦截",
      "acceptance": "工作台与年度总结页同步区视觉升级且布局一致；移除按钮旁内联错误，统一为去重 Toast；空内容（trim 后为空）点击 push 不发请求并提示“当前内容为空，无需 push”；相关单元/集成/E2E 回归通过",
      "related_files": [
        "src/components/common/sync-control-bar.tsx",
        "src/components/common/toast-center.tsx",
        "src/hooks/use-toast.ts",
        "src/App.tsx",
        "src/pages/diary.tsx",
        "src/pages/yearly-summary.tsx",
        "src/index.css",
        "src/__tests__/integration/editor.integration.test.tsx",
        "e2e/fixtures/app.ts",
        "e2e/specs/manual-sync-*.spec.ts",
        "e2e/specs/remote-pull-sync.spec.ts",
        "e2e/specs/yearly-summary.spec.ts",
        "TODO.md"
      ],
      "test_record": "\`npm run lint\` 通过；\`npm run test:unit\` 通过（58/58）；\`npm run test:integration\` 通过（55/55）；\`npm run test:e2e:full\` 首次失败（新 worktree 缺少 .env.e2e）；执行 \`bash /home/ljcwsl/.codex/skills/main-worktree-flow/scripts/worktree-flow.sh fix-e2e-env --branch plan/sync-toolbar-toast-empty-push-v2 --repo /home/ljcwsl/0-code/TraceDiary --worktree /home/ljcwsl/0-code/TraceDiary/.worktrees/plan_sync-toolbar-toast-empty-push-v2 --e2e-cmd \\\\\\"npm run test:e2e:full\\\\\\"\` 后，补跑定向 \`npx playwright test e2e/specs/manual-sync-hang-guard.spec.ts e2e/specs/remote-pull-sync.spec.ts e2e/specs/yearly-summary.spec.ts --project=chromium --workers=1 --retries=1\` 通过（4/4），最终 \`npm run test:e2e:full\` 通过（22/22）",
      "done_record": "2026-02-14 / f4229fe",
      "source": {
        "file": "TODO.md",
        "line": 95
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_1410da3ee3cba2626995",
      "display_id": "TD-SYNC-033",
      "id_prefix": "SYNC",
      "module_key": "6.5",
      "module_name": "同步与冲突解决",
      "module_label": "6.5 同步与冲突解决",
      "order": 57,
      "status": "DONE",
      "title": "修复 StrictMode 下单次 push 被误判为 stale（前端 2-3 秒提示“当前正在上传”但远端已成功）",
      "acceptance": "单次点击 push 在开发模式（StrictMode）不再误报“当前正在上传/失败”；手动 push 成功后前端状态与远端结果一致；新增回归测试覆盖 StrictMode 生命周期",
      "related_files": [
        "src/hooks/use-sync.ts",
        "src/hooks/__tests__/use-sync.test.ts",
        "TODO.md"
      ],
      "test_record": "\`npm run lint\` 通过；\`npm run test:unit\` 通过（58/58）；\`npm run test:integration\` 失败（\`src/__tests__/integration/app.integration.test.tsx\` 3 项失败，属已知阻塞任务 \`TD-TEST-013\` 的导航迁移断言，不属于本次改动范围）；\`npx playwright test e2e/specs/manual-sync-success.spec.ts --project=chromium --retries=0\` 通过（1/1）；\`npx playwright test e2e/specs/manual-sync-state-consistency.spec.ts --project=chromium --retries=0\` 通过（1/1）",
      "done_record": "2026-02-14 / abb6366",
      "source": {
        "file": "TODO.md",
        "line": 96
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_3a1934a399bf0073135a",
      "display_id": "TD-SYNC-034",
      "id_prefix": "SYNC",
      "module_key": "6.5",
      "module_name": "同步与冲突解决",
      "module_label": "6.5 同步与冲突解决",
      "order": 58,
      "status": "DONE",
      "title": "优化远端 push 提交信息：去除“手动同步”冗余文案并改为北京时间秒级时间戳",
      "acceptance": "push 到远端时 commit message 不含“手动同步”字样；时间戳为北京时间（\`+08:00\`）且精确到秒；保持现有冲突处理与上传语义不变；相关测试通过",
      "related_files": [
        "src/services/sync.ts",
        "src/services/__tests__/sync.test.ts",
        "TODO.md"
      ],
      "test_record": "风险分级：中；\`npm run lint\` 通过；\`npm run test:unit\` 通过（59/59）；\`npm run test:integration\` 通过（62/62）；\`npm run test:e2e:fast\` 通过（4/4）",
      "done_record": "2026-02-15 / 4cab9bb, 98af599",
      "source": {
        "file": "TODO.md",
        "line": 97
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_af82d9ca79a3829594ba",
      "display_id": "TD-SYNC-035",
      "id_prefix": "SYNC",
      "module_key": "6.5",
      "module_name": "同步与冲突解决",
      "module_label": "6.5 同步与冲突解决",
      "order": 59,
      "status": "DONE",
      "title": "新增“Pull 全部”与结果汇总弹窗，拉取流程改为 metadata 单次读取 + 差异下载（冲突跳过并汇总）",
      "acceptance": "同步条默认支持一键 Pull 全部；Pull 结束弹窗对齐导入结果展示；metadata 仅拉取一次；冲突不覆盖本地并可见汇总",
      "related_files": [
        "src/components/common/sync-control-bar.tsx",
        "src/components/common/pull-result-dialog.tsx",
        "src/pages/diary.tsx",
        "src/pages/yearly-summary.tsx",
        "src/services/sync.ts",
        "src/services/__tests__/sync.test.ts",
        "src/__tests__/integration/editor.integration.test.tsx",
        "e2e/specs/bulk-pull-result-dialog.spec.ts",
        "e2e/specs/upload-encryption.spec.ts",
        "TODO.md"
      ],
      "test_record": "风险分级：高；\`npm run lint\` 通过；\`npm run test:unit\` 通过（90/90）；\`npm run test:integration\` 通过（70/70，含既有 \`act(...)\` 警告）；\`npm run test:e2e:full\` 通过（26 passed，3 flaky：\`conflict-resolution\` 2 条、\`yearly-summary\` 1 条，重试后通过）",
      "done_record": "2026-02-18 / 68ae89e",
      "source": {
        "file": "TODO.md",
        "line": 98
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_a60bc4c1665e37c79323",
      "display_id": "TD-PWA-001",
      "id_prefix": "PWA",
      "module_key": "6.6",
      "module_name": "PWA、部署与安全头",
      "module_label": "6.6 PWA、部署与安全头",
      "order": 60,
      "status": "DONE",
      "title": "配置 Vite PWA、manifest 与图标资源",
      "acceptance": "可安装到主屏幕",
      "related_files": [
        "vite.config.*",
        "public/manifest.json"
      ],
      "test_record": "风险分级：中；\`npm run lint\` 通过；\`npm run test:unit\` 通过（85/85）；\`npm run test:integration\` 通过（68/68）；\`npm run test:e2e:fast\` 通过（5/5）；未执行全量 \`npm run test:e2e\`（本任务未命中全量门禁）",
      "done_record": "2026-02-17 / e6e8994",
      "source": {
        "file": "TODO.md",
        "line": 104
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_c6829859ee2d9eae12d8",
      "display_id": "TD-PWA-002",
      "id_prefix": "PWA",
      "module_key": "6.6",
      "module_name": "PWA、部署与安全头",
      "module_label": "6.6 PWA、部署与安全头",
      "order": 61,
      "status": "DONE",
      "title": "配置 Service Worker 缓存策略（应用壳缓存、日记 NetworkOnly）",
      "acceptance": "离线可见壳，不缓存日记内容",
      "related_files": [
        "vite.config.*"
      ],
      "test_record": "风险分级：中；\`npm run lint\` 通过；\`npm run test:unit\` 通过（85/85）；\`npm run test:integration\` 通过（68/68）；\`npm run test:e2e:fast\` 通过（5/5）；未执行全量 \`npm run test:e2e\`（本任务未命中全量门禁）",
      "done_record": "2026-02-17 / 1c50bff",
      "source": {
        "file": "TODO.md",
        "line": 105
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_14f540992266b0318e91",
      "display_id": "TD-DEP-001",
      "id_prefix": "DEP",
      "module_key": "6.6",
      "module_name": "PWA、部署与安全头",
      "module_label": "6.6 PWA、部署与安全头",
      "order": 62,
      "status": "DONE",
      "title": "配置 \`vercel.json\` 安全响应头（CSP/HSTS/Referrer/Permissions）",
      "acceptance": "响应头符合 SPEC",
      "related_files": [
        "vercel.json"
      ],
      "test_record": "风险分级：中；\`node -e \\\\\\"const fs=require('fs'); JSON.parse(fs.readFileSync('vercel.json','utf8'));\\\\\\"\` 通过；\`npm run lint\` 通过；\`npm run test:unit\` 通过（85/85）；\`npm run test:integration\` 通过（68/68）；\`npm run test:e2e:fast\` 通过（5/5）；未执行全量 \`npm run test:e2e\`（本任务未命中全量门禁）",
      "done_record": "2026-02-17 / 5031be6",
      "source": {
        "file": "TODO.md",
        "line": 106
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_db5d80007e0928fe1a13",
      "display_id": "TD-DEP-002",
      "id_prefix": "DEP",
      "module_key": "6.6",
      "module_name": "PWA、部署与安全头",
      "module_label": "6.6 PWA、部署与安全头",
      "order": 63,
      "status": "DONE",
      "title": "补充入口访问控制部署说明（Cloudflare Access/Vercel/Basic Auth）",
      "acceptance": "部署文档可执行",
      "related_files": [
        "README.md",
        "SPEC.md"
      ],
      "test_record": "风险分级：低（仅文档）；仅文档改动，无功能行为变化；未执行自动化测试（\`lint/unit/integration/E2E\`）",
      "done_record": "2026-02-17 / a03d3fc",
      "source": {
        "file": "TODO.md",
        "line": 107
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_dd5e3f89f430e9824d84",
      "display_id": "TD-DEP-003",
      "id_prefix": "DEP",
      "module_key": "6.6",
      "module_name": "PWA、部署与安全头",
      "module_label": "6.6 PWA、部署与安全头",
      "order": 64,
      "status": "DONE",
      "title": "执行 Vercel 生产部署并回传可访问地址",
      "acceptance": "成功产出生产部署 URL 且可访问",
      "related_files": [
        "TODO.md",
        ".gitignore"
      ],
      "test_record": "风险分级：低（部署与配置记录）；\`npm run lint\` 通过；\`npx vercel whoami --token ***\` 通过（账号：\`lane0218\`）；\`npx vercel --prod --yes --name tracediary --token ***\` 通过（Production: \`https://tracediary-g0q3xm6tx-lanes-projects-29cb0384.vercel.app\`，Alias: \`https://tracediary.vercel.app\`）；\`curl -I https://tracediary.vercel.app\` 返回 \`HTTP/2 200\` 且安全响应头生效；\`curl -I https://tracediary-g0q3xm6tx-lanes-projects-29cb0384.vercel.app\` 返回 \`HTTP/2 401\`（部署保护）",
      "done_record": "2026-02-17 / 232ca05",
      "source": {
        "file": "TODO.md",
        "line": 108
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_e25214c85b98c3f84beb",
      "display_id": "TD-DEP-004",
      "id_prefix": "DEP",
      "module_key": "6.6",
      "module_name": "PWA、部署与安全头",
      "module_label": "6.6 PWA、部署与安全头",
      "order": 65,
      "status": "DONE",
      "title": "绑定 TraceDiary 到自定义二级域名（\`tracediary.laneljc.cn\` 与 \`diary.laneljc.cn\`）",
      "acceptance": "目标域名完成 Vercel 绑定并可通过 HTTPS 访问应用首页",
      "related_files": [
        "TODO.md"
      ],
      "test_record": "风险分级：低（部署配置）；\`npx vercel domains add tracediary.laneljc.cn --scope lanes-projects-29cb0384 --token ***\` 通过；\`npx vercel domains add diary.laneljc.cn --scope lanes-projects-29cb0384 --token ***\` 通过；\`curl -I https://tracediary.laneljc.cn\` 返回 \`HTTP/2 200\`；\`curl -I https://diary.laneljc.cn\` 返回 \`HTTP/2 200\`；\`npm run lint\` 通过；未执行 \`unit/integration/e2e\`（本任务为部署配置低风险，不涉及运行时代码变更）",
      "done_record": "2026-02-17 / bc46def",
      "source": {
        "file": "TODO.md",
        "line": 109
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_36eb8106a8fc0b07a2c2",
      "display_id": "TD-TEST-001",
      "id_prefix": "TEST",
      "module_key": "6.7",
      "module_name": "测试与验收",
      "module_label": "6.7 测试与验收",
      "order": 66,
      "status": "DONE",
      "title": "加密与 KDF 参数升级单元测试",
      "acceptance": "核心分支覆盖并通过",
      "related_files": [
        "src/services/__tests__/*"
      ],
      "test_record": "风险分级：中；\`npm run lint\` 通过；\`npx vitest run src/services/__tests__/crypto.test.ts\` 通过（5/5）；\`npm run test:unit\` 通过（86/86）",
      "done_record": "2026-02-17 / cc21f03",
      "source": {
        "file": "TODO.md",
        "line": 115
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_68dc60dc3a75f8cc2c41",
      "display_id": "TD-TEST-002",
      "id_prefix": "TEST",
      "module_key": "6.7",
      "module_name": "测试与验收",
      "module_label": "6.7 测试与验收",
      "order": 67,
      "status": "DONE",
      "title": "同步与冲突（CAS/sha mismatch）单元测试",
      "acceptance": "冲突分支断言完整",
      "related_files": [
        "src/services/__tests__/*"
      ],
      "test_record": "风险分级：中；\`npm run lint\` 通过；\`npx vitest run src/services/__tests__/sync.test.ts\` 通过（26/26）；\`npm run test:unit\` 通过（86/86）",
      "done_record": "2026-02-17 / cc21f03",
      "source": {
        "file": "TODO.md",
        "line": 116
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_d5acd28d42fe515f3f66",
      "display_id": "TD-TEST-003",
      "id_prefix": "TEST",
      "module_key": "6.7",
      "module_name": "测试与验收",
      "module_label": "6.7 测试与验收",
      "order": 68,
      "status": "DONE",
      "title": "认证流程集成测试（首次/7天内/过期/Token失效）",
      "acceptance": "4 条流程均通过",
      "related_files": [
        "src/hooks/__tests__/*"
      ],
      "test_record": "风险分级：中；\`npm run lint\` 通过；\`npx vitest run --environment jsdom src/hooks/__tests__/use-auth.test.tsx\` 通过（10/10）；\`npm run test:integration\` 通过（68/68）",
      "done_record": "2026-02-17 / cc21f03",
      "source": {
        "file": "TODO.md",
        "line": 117
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_d53533af3e7981eb8860",
      "display_id": "TD-TEST-004",
      "id_prefix": "TEST",
      "module_key": "6.7",
      "module_name": "测试与验收",
      "module_label": "6.7 测试与验收",
      "order": 69,
      "status": "DONE",
      "title": "关键用户流程 E2E（创建、编辑、同步、冲突）",
      "acceptance": "核心链路自动化通过",
      "related_files": [
        "e2e/*"
      ],
      "test_record": "\`npm run lint\` 通过；\`npm run test:unit\` 通过（39/39）；\`npm run test:integration\` 通过（33/33）；\`npm run test:e2e\` 通过（7/7）",
      "done_record": "2026-02-09 / f474348",
      "source": {
        "file": "TODO.md",
        "line": 118
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_ba943ea265a5751c318c",
      "display_id": "TD-TEST-005",
      "id_prefix": "TEST",
      "module_key": "6.7",
      "module_name": "测试与验收",
      "module_label": "6.7 测试与验收",
      "order": 70,
      "status": "DONE",
      "title": "性能验收（加载、切换日期、往年今日、输入延迟）",
      "acceptance": "满足 SPEC 指标",
      "related_files": [
        "test-report/*",
        "e2e/specs/performance-acceptance.spec.ts",
        "src/services/__tests__/import.performance.test.ts"
      ],
      "test_record": "风险分级：中；\`npm run lint\` 通过；\`npm run test:unit\` 通过（86/86，含 \`import.performance\`）；\`npm run test:integration\` 通过（68/68）；\`npx playwright test e2e/specs/performance-acceptance.spec.ts --project=chromium --retries=0\` 通过（1/1）；未执行全量 \`npm run test:e2e\`（本任务未命中全量门禁）",
      "done_record": "2026-02-17 / 543bd41",
      "source": {
        "file": "TODO.md",
        "line": 119
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_299a24be36aa4302c79b",
      "display_id": "TD-TEST-006",
      "id_prefix": "TEST",
      "module_key": "6.7",
      "module_name": "测试与验收",
      "module_label": "6.7 测试与验收",
      "order": 71,
      "status": "DONE",
      "title": "兼容性验收（Chrome/Edge/Safari/Firefox/安卓/iOS）",
      "acceptance": "验收清单全部勾选",
      "related_files": [
        "docs/compatibility-report.md"
      ],
      "test_record": "风险分级：低（验收文档回填）；\`npx playwright test --config=scripts/compatibility-check.mjs --grep @smoke --workers=1 --retries=0 --reporter=line\` 执行结果：Chrome/Edge/Firefox/安卓通过；Safari/iOS 按用户授权“这两个环境就不跑了，不做测试了”跳过并不纳入门禁；仅文档回填，未追加自动化测试",
      "done_record": "2026-02-17 / 7ec1e94",
      "source": {
        "file": "TODO.md",
        "line": 120
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_f5274671d10839f9380e",
      "display_id": "TD-TEST-007",
      "id_prefix": "TEST",
      "module_key": "6.7",
      "module_name": "测试与验收",
      "module_label": "6.7 测试与验收",
      "order": 72,
      "status": "DONE",
      "title": "补齐 Playwright 端到端关键验收场景（冲突三分支与再冲突、自动重试、年度总结、认证后续、日历导航、安全关键项）",
      "acceptance": "新增/改造 E2E 用例并通过完整测试（单元/集成/E2E）",
      "related_files": [
        "e2e/specs/*",
        "e2e/fixtures/*",
        "e2e/helpers/*"
      ],
      "test_record": "\`npm run test:unit\` 通过（42/42）；\`npm run test:integration\` 通过（35/35）；\`npm run test:e2e\` 通过（17/17）；\`npm run lint\` 通过",
      "done_record": "2026-02-09 / a58cc80",
      "source": {
        "file": "TODO.md",
        "line": 121
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_82a6665760319d4e0868",
      "display_id": "TD-TEST-008",
      "id_prefix": "TEST",
      "module_key": "6.7",
      "module_name": "测试与验收",
      "module_label": "6.7 测试与验收",
      "order": 73,
      "status": "DONE",
      "title": "修复 E2E 假阳性与冲突时序风险（metadata 应用链路断言 + 手动上传使用持久化快照）",
      "acceptance": "metadata 加密断言基于应用真实上传链路；手动上传与冲突流程在快速输入场景下保持一致性并通过完整测试",
      "related_files": [
        "src/services/sync.ts",
        "src/hooks/use-diary.ts",
        "src/pages/workspace.tsx",
        "src/pages/yearly-summary.tsx",
        "src/hooks/__tests__/*",
        "src/__tests__/integration/*",
        "e2e/specs/*"
      ],
      "test_record": "\`npm run test:unit\` 通过（43/43）；\`npm run test:integration\` 通过（36/36）；\`npm run test:e2e\` 通过（17/17）；\`npx playwright test e2e/specs/conflict-resolution.spec.ts --project=chromium\` 通过（4/4）",
      "done_record": "2026-02-09 / 165cd5f",
      "source": {
        "file": "TODO.md",
        "line": 122
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_3e7056c3afe96bc8d231",
      "display_id": "TD-TEST-009",
      "id_prefix": "TEST",
      "module_key": "6.7",
      "module_name": "测试与验收",
      "module_label": "6.7 测试与验收",
      "order": 74,
      "status": "DONE",
      "title": "修复冲突 E2E 长跑不稳定（认证重试 + 同步状态收敛 + 冲突注入可观测性）",
      "acceptance": "\`conflict-resolution\` 在高重复执行下不再因认证抖动或同步状态长期卡住导致失败；日志可区分预写失败与目标请求未触发",
      "related_files": [
        "e2e/fixtures/app.ts",
        "e2e/specs/conflict-resolution.spec.ts",
        "e2e/helpers/conflict.ts",
        "src/hooks/use-sync.ts"
      ],
      "test_record": "\`npm run test:unit\` 通过（43/43）；\`npm run test:integration\` 通过（36/36）；\`npm run test:e2e\` 通过（17/17）；\`npx playwright test e2e/specs/conflict-resolution.spec.ts --project=chromium --repeat-each=3 --retries=0\` 通过（12/12）；\`npx playwright test e2e/specs/conflict-resolution.spec.ts --project=chromium --repeat-each=10 --retries=0\` 通过（40/40）",
      "done_record": "2026-02-10 / 769aa47",
      "source": {
        "file": "TODO.md",
        "line": 123
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_8989c7926038f2b79d58",
      "display_id": "TD-TEST-010",
      "id_prefix": "TEST",
      "module_key": "6.7",
      "module_name": "测试与验收",
      "module_label": "6.7 测试与验收",
      "order": 75,
      "status": "DONE",
      "title": "修复 lint 报错 \`e2e/helpers/conflict.ts\` 中 \`no-unsafe-finally\` 违规并恢复 lint 全绿",
      "acceptance": "\`npm run lint\` 不再报 \`no-unsafe-finally\`；并通过必要回归（单元/集成 + 冲突相关 E2E）",
      "related_files": [
        "e2e/helpers/conflict.ts",
        "TODO.md"
      ],
      "test_record": "\`npm run lint\` 通过；\`npm run test:unit\` 通过（48/48）；\`npm run test:integration\` 通过（43/43）；\`npx playwright test e2e/specs/conflict-resolution.spec.ts --project=chromium --retries=0\` 通过（4/4）",
      "done_record": "2026-02-10 / 8c9ec50",
      "source": {
        "file": "TODO.md",
        "line": 124
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_474b8804934969013296",
      "display_id": "TD-TEST-011",
      "id_prefix": "TEST",
      "module_key": "6.7",
      "module_name": "测试与验收",
      "module_label": "6.7 测试与验收",
      "order": 76,
      "status": "DONE",
      "title": "移除冗余 E2E 冒烟脚本与 npm 入口",
      "acceptance": "仓库不再保留 \`test:e2e:smoke\` 与 \`scripts/e2e-smoke.sh\`；无遗留运行入口",
      "related_files": [
        "package.json",
        "scripts/e2e-smoke.sh",
        "TODO.md"
      ],
      "test_record": "\`npm run lint\` 通过；\`npm run test:unit\` 通过（48/48）；\`npm run test:integration\` 通过（43/43）；按用户授权采用必要测试策略，未执行全量 E2E",
      "done_record": "2026-02-10 / 6e7d886",
      "source": {
        "file": "TODO.md",
        "line": 125
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_1696f889d32cba469b99",
      "display_id": "TD-TEST-012",
      "id_prefix": "TEST",
      "module_key": "6.7",
      "module_name": "测试与验收",
      "module_label": "6.7 测试与验收",
      "order": 77,
      "status": "DONE",
      "title": "落地本地高效测试分层策略（Playwright 并发/分片脚本、用例标签、AGENTS 默认执行规范）",
      "acceptance": "新增 \`test:e2e:fast/changed/last-failed/full/slow/remote/local-shard:*\` 脚本；关键 E2E 完成 \`@smoke/@slow/@remote\` 标签；\`AGENTS.md\` 明确“默认分层 + 全量门禁”；新增测试策略文档可直接执行",
      "related_files": [
        "playwright.config.ts",
        "package.json",
        "e2e/specs/*.spec.ts",
        "AGENTS.md",
        "docs/testing-strategy.md",
        "TODO.md",
        "scripts/compatibility-check.mjs"
      ],
      "test_record": "风险分级：中；\`git show --name-only --oneline 42faaba\` 校验通过（已包含策略落地文件）；\`rg\` 复核 \`package.json\` E2E 分层脚本、\`e2e/specs/*.spec.ts\` 标签、\`AGENTS.md\` 全量门禁、\`docs/testing-strategy.md\` 可执行指引均存在",
      "done_record": "2026-02-11 / 42faaba",
      "source": {
        "file": "TODO.md",
        "line": 126
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_c79e1b4649e240022308",
      "display_id": "TD-TEST-013",
      "id_prefix": "TEST",
      "module_key": "6.7",
      "module_name": "测试与验收",
      "module_label": "6.7 测试与验收",
      "order": 78,
      "status": "DONE",
      "title": "测试迁移与断言更新（适配新信息架构与统一导航）",
      "acceptance": "集成/E2E 不再依赖“会话：已解锁”；导航断言迁移为统一入口并覆盖 \`/settings\` 可访问；\`stats-insights\` 跳转断言改为新导航结构并稳定通过",
      "related_files": [
        "src/__tests__/integration/app.integration.test.tsx",
        "e2e/fixtures/app.ts",
        "e2e/specs/stats-insights.spec.ts",
        "TODO.md"
      ],
      "test_record": "风险分级：中；\`npm run lint\` 通过；\`npm run test:unit\` 通过（86/86）；\`npm run test:integration\` 通过（68/68，含 \`app.integration\`）；\`npx playwright test e2e/specs/stats-insights.spec.ts --project=chromium --retries=0\` 通过（1/1）",
      "done_record": "2026-02-17 / cc21f03",
      "source": {
        "file": "TODO.md",
        "line": 127
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_7568230d7783fedebff1",
      "display_id": "TD-UI-001",
      "id_prefix": "UI",
      "module_key": "6.8",
      "module_name": "UI 体验优化",
      "module_label": "6.8 UI 体验优化",
      "order": 79,
      "status": "DONE",
      "title": "提供极简专业风的布局与交互原型 HTML",
      "acceptance": "可在浏览器中演示导航切换、月份切换与状态反馈逻辑",
      "related_files": [
        "docs/ui-layout-prototype.html"
      ],
      "test_record": "\`npm run test:unit\` 通过（22/22）；\`npm run test:integration\` 通过（21/21）；\`npm run test:e2e\` 通过",
      "done_record": "2026-02-08 / c45592a",
      "source": {
        "file": "TODO.md",
        "line": 133
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_b4dcdc12bff0cce189be",
      "display_id": "TD-UI-002",
      "id_prefix": "UI",
      "module_key": "6.8",
      "module_name": "UI 体验优化",
      "module_label": "6.8 UI 体验优化",
      "order": 80,
      "status": "DONE",
      "title": "调整原型为“欢迎弹层 + 单页工作台（日历与日记/年度总结同屏）”",
      "acceptance": "欢迎流程以弹层演示，主页面仅保留一个工作台并可切换日记/年度总结",
      "related_files": [
        "docs/ui-layout-prototype.html",
        "src/hooks/use-diary.ts"
      ],
      "test_record": "\`npm run test:unit\` 通过（22/22）；\`npm run test:integration\` 通过（21/21）；\`npm run test:e2e\` 通过",
      "done_record": "2026-02-08 / 4a4ff1c",
      "source": {
        "file": "TODO.md",
        "line": 134
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_ff8ce106000b68a881de",
      "display_id": "TD-UI-003",
      "id_prefix": "UI",
      "module_key": "6.8",
      "module_name": "UI 体验优化",
      "module_label": "6.8 UI 体验优化",
      "order": 81,
      "status": "DONE",
      "title": "落地 blog 同源风格并重构为单页工作台（欢迎弹层 + 日历/日记/年度总结同屏）",
      "acceptance": "默认进入工作台；认证以弹层呈现；视觉风格与 blog 一致；旧路由可兼容跳转",
      "related_files": [
        "src/App.tsx",
        "src/index.css",
        "tailwind.config.js",
        "src/pages/workspace.tsx",
        "src/components/auth/*",
        "src/components/calendar/*",
        "src/components/history/*",
        "src/components/editor/*",
        "src/__tests__/integration/*"
      ],
      "test_record": "\`npm run test:unit\` 通过（22/22）；\`npm run test:integration\` 通过（23/23）；\`npm run test:e2e\` 通过；\`npm run lint\` 通过",
      "done_record": "2026-02-08 / 661051b",
      "source": {
        "file": "TODO.md",
        "line": 135
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_c30e21ee4a97c72d6019",
      "display_id": "TD-UI-004",
      "id_prefix": "UI",
      "module_key": "6.8",
      "module_name": "UI 体验优化",
      "module_label": "6.8 UI 体验优化",
      "order": 82,
      "status": "DONE",
      "title": "精修工作台视觉层级、工具条编排、状态反馈与弹层细节",
      "acceptance": "主次区域更清晰；工具条分层；状态可感知；弹层模式切换和错误区更稳定；移动端布局更稳",
      "related_files": [
        "src/pages/workspace.tsx",
        "src/components/auth/auth-modal.tsx",
        "src/components/calendar/month-calendar.tsx",
        "src/components/history/on-this-day-list.tsx",
        "src/index.css"
      ],
      "test_record": "\`npm run test:unit\` 通过（22/22）；\`npm run test:integration\` 通过（23/23）；\`npm run test:e2e\` 通过；\`npm run lint\` 通过",
      "done_record": "2026-02-09 / b426bbd",
      "source": {
        "file": "TODO.md",
        "line": 136
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_96967fa6cdf0fcbdf379",
      "display_id": "TD-UI-005",
      "id_prefix": "UI",
      "module_key": "6.8",
      "module_name": "UI 体验优化",
      "module_label": "6.8 UI 体验优化",
      "order": 83,
      "status": "DONE",
      "title": "收敛日期入口：移除双日期输入框并新增“月标题点击年月选择”",
      "acceptance": "删除指定文案；无“当前日期/查询日期”输入框；可通过月标题弹层选择年月并联动编辑与往年今日",
      "related_files": [
        "src/pages/workspace.tsx",
        "src/components/calendar/month-calendar.tsx",
        "src/pages/calendar.tsx",
        "src/__tests__/integration/app.integration.test.tsx"
      ],
      "test_record": "\`npm run test:unit\` 通过（22/22）；\`npm run test:integration\` 通过（23/23）；\`npm run test:e2e\` 通过；\`npm run lint\` 通过",
      "done_record": "2026-02-09 / 9ae8d0e",
      "source": {
        "file": "TODO.md",
        "line": 137
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_411c69b1dda35d5e5921",
      "display_id": "TD-UI-006",
      "id_prefix": "UI",
      "module_key": "6.8",
      "module_name": "UI 体验优化",
      "module_label": "6.8 UI 体验优化",
      "order": 84,
      "status": "DONE",
      "title": "优化工作台信息简化与左侧结构（移除条目ID/冗余描述，分离往年今日卡片，缩小日历日期格）",
      "acceptance": "不显示条目ID；“往年今日”无附加解释文案；往年今日独立于日历卡片；日期格尺寸更紧凑",
      "related_files": [
        "src/pages/workspace.tsx",
        "src/components/calendar/month-calendar.tsx"
      ],
      "test_record": "\`npm run test:unit\` 通过（22/22）；\`npm run test:integration\` 通过（23/23）；\`npm run test:e2e\` 通过；\`npm run lint\` 通过",
      "done_record": "2026-02-09 / 6f2fe9a",
      "source": {
        "file": "TODO.md",
        "line": 138
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_25c74a5b6374efd90fb9",
      "display_id": "TD-UI-007",
      "id_prefix": "UI",
      "module_key": "6.8",
      "module_name": "UI 体验优化",
      "module_label": "6.8 UI 体验优化",
      "order": 85,
      "status": "DONE",
      "title": "重构“日记主页面 + 年度总结独立页”信息架构（移除同级 Tab，新增 \`/yearly/:year\` 长时写作页与年终提示）",
      "acceptance": "工作台仅保留日记编辑；可从按钮和年终提示进入年度总结独立页；年度总结支持按自然年切换与保存；返回日记不丢失上下文",
      "related_files": [
        "src/App.tsx",
        "src/pages/workspace.tsx",
        "src/pages/yearly-summary.tsx",
        "src/pages/calendar.tsx",
        "src/__tests__/integration/*"
      ],
      "test_record": "\`npm run test:unit\` 通过（22/22）；\`npm run test:integration\` 通过（23/23）；\`npm run test:e2e\` 通过；\`npm run lint\` 通过",
      "done_record": "2026-02-09 / 8d66a0b",
      "source": {
        "file": "TODO.md",
        "line": 139
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_ef264dc1653722ac01e9",
      "display_id": "TD-UI-008",
      "id_prefix": "UI",
      "module_key": "6.8",
      "module_name": "UI 体验优化",
      "module_label": "6.8 UI 体验优化",
      "order": 86,
      "status": "DONE",
      "title": "编辑器模式切换收敛为单“源码”按钮并对齐既有按钮样式",
      "acceptance": "默认未点击“源码”时展示可视化编辑；点击“源码”后进入源码编辑；按钮样式与站内 \`td-btn\` 体系一致",
      "related_files": [
        "src/components/editor/markdown-editor.tsx",
        "src/pages/workspace.tsx",
        "TODO.md"
      ],
      "test_record": "\`npm run lint\` 通过；\`npm run test:unit\` 通过（51/51）；\`npm run test:integration\` 通过（45/45）；\`E2E\` 未执行（用户在本任务中明确要求“修改完后不用进行端到端测试”）",
      "done_record": "2026-02-11 / b53bd69",
      "source": {
        "file": "TODO.md",
        "line": 140
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_66a6691bf77d1e8c7ee1",
      "display_id": "TD-UI-009",
      "id_prefix": "UI",
      "module_key": "6.8",
      "module_name": "UI 体验优化",
      "module_label": "6.8 UI 体验优化",
      "order": 87,
      "status": "DONE",
      "title": "收敛同步信息展示（移除编辑页分支显示，仅保留云端状态胶囊）",
      "acceptance": "\`workspace/yearly\` 不展示“分支”与“未提交改动”；欢迎页与设置仍展示分支；云端状态胶囊保留并可反映同步状态",
      "related_files": [
        "src/pages/workspace.tsx",
        "src/pages/yearly-summary.tsx",
        "src/__tests__/integration/editor.integration.test.tsx",
        "e2e/specs/manual-sync-state-consistency.spec.ts",
        "e2e/specs/manual-sync-failure.spec.ts",
        "TODO.md"
      ],
      "test_record": "\`npm run lint\` 通过；\`npm run test:unit\` 通过（51/51）；\`npm run test:integration\` 通过（45/45）；\`npx playwright test e2e/specs/manual-sync-state-consistency.spec.ts e2e/specs/manual-sync-failure.spec.ts e2e/specs/manual-sync-success.spec.ts --project=chromium --retries=0 --workers=1\` 通过（3/3）",
      "done_record": "2026-02-11 / 43b9ae5",
      "source": {
        "file": "TODO.md",
        "line": 141
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_51713932a3b7c5904992",
      "display_id": "TD-UI-010",
      "id_prefix": "UI",
      "module_key": "6.8",
      "module_name": "UI 体验优化",
      "module_label": "6.8 UI 体验优化",
      "order": 88,
      "status": "DONE",
      "title": "新增编辑器右下角字数角标、修复往年今日渐隐截断并清理历史日历冗余组件",
      "acceptance": "日记与年度总结编辑器右下角显示字数（非空白字符）；往年今日长内容不溢出且底部渐隐自然；移除不再使用的 \`calendar\` 页面与路由",
      "related_files": [
        "src/components/editor/markdown-editor.tsx",
        "src/__tests__/integration/markdown-editor.integration.test.tsx",
        "src/components/history/on-this-day-list.tsx",
        "src/App.tsx",
        "src/pages/calendar.tsx",
        "src/__tests__/integration/calendar.integration.test.tsx",
        "TODO.md"
      ],
      "test_record": "\`npm run lint\` 通过；\`npm run test:unit\` 通过（51/51）；\`npm run test:integration\` 通过（42/42）；\`E2E\` 未执行（用户在本任务中明确要求“修改完后不用进行端到端测试”）",
      "done_record": "2026-02-11 / 3f9e8d4",
      "source": {
        "file": "TODO.md",
        "line": 142
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_5f0b96f413443d014900",
      "display_id": "TD-UI-011",
      "id_prefix": "UI",
      "module_key": "6.8",
      "module_name": "UI 体验优化",
      "module_label": "6.8 UI 体验优化",
      "order": 89,
      "status": "DONE",
      "title": "优化月历年份输入交互与年月弹层视觉统一（支持年份直输即生效、去蓝色、缩窄月份格）",
      "acceptance": "年份可自然输入中间态并在合法值时即时切换；弹层与主页面风格统一且不使用蓝色强调；12 个月按钮视觉更紧凑",
      "related_files": [
        "src/components/calendar/month-calendar.tsx",
        "TODO.md"
      ],
      "test_record": "\`npm run lint\` 通过；\`npm run test:unit\` 通过（51/51）；\`npm run test:integration\` 通过（42/42）；\`npx playwright test e2e/specs/calendar-history.spec.ts --project=chromium --retries=0\` 通过（1/1）；未执行全量 \`npm run test:e2e\`（本任务未命中全量门禁，已执行与改动直接相关目标 E2E）",
      "done_record": "2026-02-11 / 3b77020",
      "source": {
        "file": "TODO.md",
        "line": 143
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_9266d4b3ba5cfe41701a",
      "display_id": "TD-UI-012",
      "id_prefix": "UI",
      "module_key": "6.8",
      "module_name": "UI 体验优化",
      "module_label": "6.8 UI 体验优化",
      "order": 90,
      "status": "DONE",
      "title": "修复年月弹层定位跳动并收窄月份与年份输入控件",
      "acceptance": "不再出现先右后中跳动；月份格和年份输入框更紧凑",
      "related_files": [
        "src/components/calendar/month-calendar.tsx",
        "TODO.md"
      ],
      "test_record": "\`npm run lint\` 通过；\`npm run test:unit\` 通过（51/51）；\`npm run test:integration\` 通过（42/42）；\`npx playwright test e2e/specs/calendar-history.spec.ts --project=chromium --retries=0\` 通过（1/1）；未执行全量 \`npm run test:e2e\`（本任务未命中全量门禁，已执行与改动直接相关目标 E2E）",
      "done_record": "2026-02-11 / 2ed232e",
      "source": {
        "file": "TODO.md",
        "line": 144
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_3278d87cc657c6e39750",
      "display_id": "TD-UI-013",
      "id_prefix": "UI",
      "module_key": "6.8",
      "module_name": "UI 体验优化",
      "module_label": "6.8 UI 体验优化",
      "order": 91,
      "status": "DONE",
      "title": "移除往年今日字数展示并统一编辑器与metadata字数口径（去空白字符数）",
      "acceptance": "往年今日不再显示字数；编辑器右下角字数与新写入 metadata \`wordCount\` 口径一致（去空白字符数）",
      "related_files": [
        "src/components/history/on-this-day-list.tsx",
        "src/components/history/on-this-day-utils.ts",
        "src/components/editor/markdown-editor.tsx",
        "src/hooks/use-diary.ts",
        "src/pages/workspace.tsx",
        "src/services/sync.ts",
        "src/utils/word-count.ts",
        "src/__tests__/integration/markdown-editor.integration.test.tsx",
        "src/__tests__/integration/app.integration.test.tsx",
        "TODO.md"
      ],
      "test_record": "\`npm run lint\` 通过；\`npm run test:unit\` 通过（51/51）；\`npm run test:integration\` 通过（44/44）；\`npx playwright test e2e/specs/calendar-history.spec.ts --project=chromium --retries=0\` 通过（1/1）；未执行全量 \`npm run test:e2e\`（本任务未命中全量门禁，已执行与改动直接相关目标 E2E）",
      "done_record": "2026-02-11 / 8fd5bab",
      "source": {
        "file": "TODO.md",
        "line": 145
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_44e722804543cb964c5c",
      "display_id": "TD-UI-014",
      "id_prefix": "UI",
      "module_key": "6.8",
      "module_name": "UI 体验优化",
      "module_label": "6.8 UI 体验优化",
      "order": 92,
      "status": "DONE",
      "title": "消除编辑输入时“本地已保存/云端待同步”状态闪烁，收敛为仅异常/慢保存提示与稳定云端状态切换",
      "acceptance": "连续输入时状态栏不频闪；本地仅在慢保存/失败时提示；云端状态仅在关键边沿切换",
      "related_files": [
        "src/components/common/status-hint.tsx",
        "src/hooks/use-sync.ts",
        "src/pages/workspace.tsx",
        "src/pages/yearly-summary.tsx",
        "src/hooks/__tests__/use-sync.test.ts",
        "src/__tests__/integration/editor.integration.test.tsx",
        "src/__tests__/integration/status-hint.integration.test.tsx",
        "e2e/specs/daily-edit.spec.ts",
        "e2e/specs/yearly-summary.spec.ts",
        "e2e/fixtures/app.ts",
        "TODO.md"
      ],
      "test_record": "\`npm run lint\` 通过；\`npm run test:unit\` 通过（51/51）；\`npm run test:integration\` 通过（46/46）；\`npm run test:e2e:fast\` 通过（3/3）；\`npx playwright test e2e/specs/yearly-summary.spec.ts --project=chromium --retries=0\` 通过（2/2）；未执行全量 \`npm run test:e2e\`（本任务未命中全量门禁，已执行与改动直接相关目标 E2E）",
      "done_record": "2026-02-11 / 29323d7",
      "source": {
        "file": "TODO.md",
        "line": 146
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_8487cf1e979532942e65",
      "display_id": "TD-UI-015",
      "id_prefix": "UI",
      "module_key": "6.8",
      "module_name": "UI 体验优化",
      "module_label": "6.8 UI 体验优化",
      "order": 93,
      "status": "DONE",
      "title": "新增写作统计视图（侧栏“往年今日/统计”分段切换 + 统计详情页）并提供累计字数/篇数/连续天数等指标",
      "acceptance": "工作台左侧支持“往年今日/统计”切换且默认不影响往年今日首屏可见；统计口径正确（总日记、总年度总结、累计字数、当前连续、最长连续、本年字数）；新增 \`/insights\` 页面可查看年度汇总与近12月趋势",
      "related_files": [
        "src/App.tsx",
        "src/pages/workspace.tsx",
        "src/pages/insights.tsx",
        "src/components/stats/stats-overview-card.tsx",
        "src/hooks/use-stats.ts",
        "src/utils/stats.ts",
        "src/types/stats.ts",
        "src/__tests__/unit/stats.unit.test.ts",
        "src/__tests__/integration/app.integration.test.tsx",
        "e2e/specs/stats-insights.spec.ts",
        "TODO.md"
      ],
      "test_record": "\`npm run lint\` 通过；\`npm run test:unit\` 通过（55/55）；\`npm run test:integration\` 通过（50/50）；\`npx playwright test e2e/specs/calendar-history.spec.ts --project=chromium --retries=0\` 通过（1/1）；\`npx playwright test e2e/specs/stats-insights.spec.ts --project=chromium --retries=0\` 通过（1/1）；未执行全量 \`npm run test:e2e\`（本任务未命中全量门禁，已执行与改动直接相关目标 E2E）",
      "done_record": "2026-02-11 / 1c6f8e3",
      "source": {
        "file": "TODO.md",
        "line": 147
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_fddb788d8d2756f8b43a",
      "display_id": "TD-UI-016",
      "id_prefix": "UI",
      "module_key": "6.8",
      "module_name": "UI 体验优化",
      "module_label": "6.8 UI 体验优化",
      "order": 94,
      "status": "DONE",
      "title": "将同步操作按钮文案统一为 \`pull\` / \`push\`",
      "acceptance": "日记页与年度总结页按钮默认态与进行态文案统一为英文 \`pull/pulling...\`、\`push/pushing...\`，相关集成与 E2E 断言同步通过",
      "related_files": [
        "src/pages/workspace.tsx",
        "src/pages/yearly-summary.tsx",
        "src/__tests__/integration/editor.integration.test.tsx",
        "e2e/specs/manual-sync-busy-clear.spec.ts",
        "e2e/specs/yearly-summary.spec.ts",
        "SPEC.md",
        "TODO.md"
      ],
      "test_record": "\`npm run lint\` 通过；\`npm run test:unit\` 通过（58/58）；\`npm run test:integration\` 通过（51/51）；\`npx playwright test e2e/specs/manual-sync-busy-clear.spec.ts e2e/specs/yearly-summary.spec.ts --project=chromium --retries=0 --workers=1\` 通过（3/3）；未执行全量 \`npm run test:e2e\`（本任务未命中全量门禁，已执行与改动直接相关目标 E2E）",
      "done_record": "2026-02-11 / a72146e",
      "source": {
        "file": "TODO.md",
        "line": 148
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_2eb2561dcf1f53072014",
      "display_id": "TD-UI-017",
      "id_prefix": "UI",
      "module_key": "6.8",
      "module_name": "UI 体验优化",
      "module_label": "6.8 UI 体验优化",
      "order": 95,
      "status": "DONE",
      "title": "修复字数口径回退：确保编辑器角标与 metadata \`wordCount\` 统计口径一致，并保留往年今日不显示字数",
      "acceptance": "\`workspace\` 与 \`sync\` 写入/回填 \`wordCount\` 统一为去空白字符数；往年今日列表不展示字数；补充回归断言防止再次回退",
      "related_files": [
        "src/pages/workspace.tsx",
        "src/services/sync.ts",
        "src/services/__tests__/sync.test.ts",
        "TODO.md"
      ],
      "test_record": "\`npm run lint\` 通过；\`npm run test:unit\` 通过（58/58）；\`npm run test:integration\` 通过（51/51）；\`npx playwright test e2e/specs/calendar-history.spec.ts --project=chromium --retries=0\` 初次因缺少 \`.env.e2e\` 失败，补齐后通过（1/1）；未执行全量 \`npm run test:e2e\`（本任务未命中全量门禁，已执行与改动直接相关目标 E2E）",
      "done_record": "2026-02-11 / 0e11160",
      "source": {
        "file": "TODO.md",
        "line": 149
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_c67ec89d2145d6912271",
      "display_id": "TD-UI-018",
      "id_prefix": "UI",
      "module_key": "6.8",
      "module_name": "UI 体验优化",
      "module_label": "6.8 UI 体验优化",
      "order": 96,
      "status": "DONE",
      "title": "精简统计卡片信息层级（仅保留 3x2 指标）并重排“统计详情”入口到分段切换行",
      "acceptance": "统计卡片仅保留 6 个指标，无底部说明文案与底部详情按钮；分段切换两项始终可见并有明确选中态；“统计详情”入口仅在选中统计时显示于切换行右侧",
      "related_files": [
        "src/components/stats/stats-overview-card.tsx",
        "src/pages/workspace.tsx",
        "src/__tests__/integration/app.integration.test.tsx",
        "e2e/specs/stats-insights.spec.ts",
        "TODO.md"
      ],
      "test_record": "\`npm run lint\` 通过；\`npm run test:unit\` 通过（58/58）；\`npm run test:integration\` 通过（51/51）；\`npx playwright test e2e/specs/stats-insights.spec.ts --project=chromium --retries=0\` 通过（1/1）；未执行全量 \`npm run test:e2e\`（本任务未命中全量门禁，已执行与改动直接相关目标 E2E）",
      "done_record": "2026-02-11 / 3f06350",
      "source": {
        "file": "TODO.md",
        "line": 150
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_37524b1d521934295d98",
      "display_id": "TD-UI-019",
      "id_prefix": "UI",
      "module_key": "6.8",
      "module_name": "UI 体验优化",
      "module_label": "6.8 UI 体验优化",
      "order": 97,
      "status": "DONE",
      "title": "修复左侧“往年今日/统计”分段条可见性与往年今日列表冗余外框",
      "acceptance": "分段条两项始终可见且选中态明确；切换时分段区宽度稳定不抖动；往年今日列表外侧无冗余边框",
      "related_files": [
        "src/pages/workspace.tsx",
        "src/components/history/on-this-day-list.tsx",
        "src/__tests__/integration/app.integration.test.tsx",
        "e2e/specs/stats-insights.spec.ts",
        "e2e/specs/calendar-history.spec.ts",
        "TODO.md"
      ],
      "test_record": "\`npm run lint\` 通过；\`npm run test:unit\` 通过（58/58）；\`npm run test:integration\` 通过（51/51）；\`npx playwright test e2e/specs/stats-insights.spec.ts --project=chromium --retries=0\` 通过（1/1）；\`npx playwright test e2e/specs/calendar-history.spec.ts --project=chromium --retries=0\` 通过（1/1）；未执行全量 \`npm run test:e2e\`（本任务未命中全量门禁，已执行与改动直接相关目标 E2E）",
      "done_record": "2026-02-11 / 07a7bf6",
      "source": {
        "file": "TODO.md",
        "line": 151
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_f4f11f6a71807bbb2d21",
      "display_id": "TD-UI-020",
      "id_prefix": "UI",
      "module_key": "6.8",
      "module_name": "UI 体验优化",
      "module_label": "6.8 UI 体验优化",
      "order": 98,
      "status": "DONE",
      "title": "重构左栏视觉语言（分段控件/往年今日/统计卡片）以提升整体质感",
      "acceptance": "左栏分段控件、往年今日、统计卡片在色彩/边界/间距上形成统一设计语言；去除廉价感与拼接感；移动端与桌面端均可正常显示",
      "related_files": [
        "src/pages/workspace.tsx",
        "src/components/history/on-this-day-list.tsx",
        "src/components/stats/stats-overview-card.tsx",
        "TODO.md"
      ],
      "test_record": "用户已明确要求“这次不用跑测试”，本任务未执行 \`lint/unit/integration/E2E\` 自动化测试",
      "done_record": "2026-02-11 / 594b1fc",
      "source": {
        "file": "TODO.md",
        "line": 152
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_71d75aebf53d12c3b9c2",
      "display_id": "TD-UI-021",
      "id_prefix": "UI",
      "module_key": "6.8",
      "module_name": "UI 体验优化",
      "module_label": "6.8 UI 体验优化",
      "order": 99,
      "status": "DONE",
      "title": "回退左栏为原中性色并移除“往年今日/统计”内容区外层边框",
      "acceptance": "左栏恢复非彩色设计；往年今日与统计内容区不再存在额外外层边框，仅保留必要卡片边界；分段切换与详情入口行为不变",
      "related_files": [
        "src/pages/workspace.tsx",
        "src/components/history/on-this-day-list.tsx",
        "src/components/stats/stats-overview-card.tsx",
        "TODO.md"
      ],
      "test_record": "\`npm run lint\` 通过；\`npm run test:unit\` 通过（58/58）；\`npm run test:integration\` 通过（51/51）；\`npx playwright test e2e/specs/stats-insights.spec.ts --project=chromium --retries=0\` 通过（1/1）；\`npx playwright test e2e/specs/calendar-history.spec.ts --project=chromium --retries=0\` 通过（1/1）；未执行全量 \`npm run test:e2e\`（本任务未命中全量门禁，已执行与改动直接相关目标 E2E）",
      "done_record": "2026-02-11 / e921d52",
      "source": {
        "file": "TODO.md",
        "line": 153
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_39ee370b5537e0bc4230",
      "display_id": "TD-UI-022",
      "id_prefix": "UI",
      "module_key": "6.8",
      "module_name": "UI 体验优化",
      "module_label": "6.8 UI 体验优化",
      "order": 100,
      "status": "DONE",
      "title": "统一工作台“往年今日/统计/今日日记”内容区高度并补齐回归测试",
      "acceptance": "桌面端三块内容区高度一致；移动端保持自适应；新增高度相关集成与 E2E 断言通过",
      "related_files": [
        "src/pages/workspace.tsx",
        "src/components/history/on-this-day-list.tsx",
        "src/components/stats/stats-overview-card.tsx",
        "src/components/editor/markdown-editor.tsx",
        "src/components/editor/markdown-editor.css",
        "src/__tests__/integration/app.integration.test.tsx",
        "src/__tests__/integration/markdown-editor.integration.test.tsx",
        "e2e/specs/stats-insights.spec.ts",
        "TODO.md"
      ],
      "test_record": "\`npm run lint\` 通过；\`npm run test:unit\` 通过（58/58）；\`npm run test:integration\` 通过（52/52）；\`npx playwright test e2e/specs/stats-insights.spec.ts --project=chromium --retries=0\` 通过（1/1，含高度对齐断言）；\`npx playwright test e2e/specs/calendar-history.spec.ts --project=chromium --retries=0\` 通过（1/1）；未执行全量 \`npm run test:e2e\`（本任务未命中全量门禁，已执行与改动直接相关目标 E2E）",
      "done_record": "2026-02-12 / 78290c3",
      "source": {
        "file": "TODO.md",
        "line": 154
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_ee22f037fee7395977dd",
      "display_id": "TD-UI-023",
      "id_prefix": "UI",
      "module_key": "6.8",
      "module_name": "UI 体验优化",
      "module_label": "6.8 UI 体验优化",
      "order": 101,
      "status": "DONE",
      "title": "优化工作台左右视觉长度与统计卡片密度（避免编辑区偏短与统计单卡过高）",
      "acceptance": "编辑区在桌面端视觉上不再显著短于左栏；统计卡片高度与密度更紧凑；历史与统计切换体验保持稳定",
      "related_files": [
        "src/pages/workspace.tsx",
        "src/components/stats/stats-overview-card.tsx",
        "e2e/specs/stats-insights.spec.ts",
        "TODO.md"
      ],
      "test_record": "\`npm run lint\` 通过；\`npm run test:unit\` 通过（58/58）；\`npm run test:integration\` 通过（52/52）；\`npx playwright test e2e/specs/stats-insights.spec.ts --project=chromium --retries=0\` 通过（1/1，含编辑区长度与统计卡片高度断言）；\`npx playwright test e2e/specs/calendar-history.spec.ts --project=chromium --retries=0\` 通过（1/1）；未执行全量 \`npm run test:e2e\`（本任务未命中全量门禁，已执行与改动直接相关目标 E2E）",
      "done_record": "2026-02-12 / 900c3a7",
      "source": {
        "file": "TODO.md",
        "line": 155
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_ca67d5c5b4a1cfde1387",
      "display_id": "TD-UI-024",
      "id_prefix": "UI",
      "module_key": "6.8",
      "module_name": "UI 体验优化",
      "module_label": "6.8 UI 体验优化",
      "order": 102,
      "status": "DONE",
      "title": "统一“往年今日/统计”面板高度并将往年今日改为紧凑列表（去预览）",
      "acceptance": "左侧切换 history/stats 时外层与内容区高度一致；往年今日不再显示正文预览，仅展示紧凑日期条目；统计卡片不出现过高拉伸",
      "related_files": [
        "src/pages/workspace.tsx",
        "src/components/history/on-this-day-list.tsx",
        "src/components/stats/stats-overview-card.tsx",
        "src/utils/sync-dirty.ts",
        "e2e/specs/stats-insights.spec.ts",
        "e2e/specs/calendar-history.spec.ts",
        "TODO.md"
      ],
      "test_record": "\`npm run lint\` 通过；\`npm run test:unit\` 通过（58/58）；\`npm run test:integration\` 通过（53/53）；\`npx playwright test e2e/specs/stats-insights.spec.ts --project=chromium --retries=0\` 通过（1/1，含 history/stats 等高断言）；\`npx playwright test e2e/specs/calendar-history.spec.ts --project=chromium --retries=0\` 通过（1/1，已适配紧凑列表断言）；未执行全量 \`npm run test:e2e\`（本任务未命中全量门禁，已执行与改动直接相关目标 E2E）",
      "done_record": "2026-02-13 / 68bbce5",
      "source": {
        "file": "TODO.md",
        "line": 156
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_6806a89ca3576e342c8a",
      "display_id": "TD-UI-025",
      "id_prefix": "UI",
      "module_key": "6.8",
      "module_name": "UI 体验优化",
      "module_label": "6.8 UI 体验优化",
      "order": 103,
      "status": "DONE",
      "title": "收敛左侧统计态留白（在保持 history/stats 等高前提下下调左侧面板高度）",
      "acceptance": "history/stats 两个 tab 的左侧面板高度保持一致；统计态不再出现大面积空白留白；往年今日紧凑列表与统计卡片展示正常",
      "related_files": [
        "src/pages/workspace.tsx",
        "src/components/stats/stats-overview-card.tsx",
        "TODO.md"
      ],
      "test_record": "\`npm run lint\` 通过；\`npm run test:unit\` 通过（58/58）；\`npm run test:integration\` 通过（53/53）；\`npx playwright test e2e/specs/stats-insights.spec.ts --project=chromium --retries=0\` 通过（1/1）；\`npx playwright test e2e/specs/calendar-history.spec.ts --project=chromium --retries=0\` 通过（1/1）；未执行全量 \`npm run test:e2e\`（本任务未命中全量门禁，已执行与改动直接相关目标 E2E）",
      "done_record": "2026-02-13 / 98a93d3",
      "source": {
        "file": "TODO.md",
        "line": 157
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_d0ea65c79eee5d09af9f",
      "display_id": "TD-UI-026",
      "id_prefix": "UI",
      "module_key": "6.8",
      "module_name": "UI 体验优化",
      "module_label": "6.8 UI 体验优化",
      "order": 104,
      "status": "DONE",
      "title": "继续收敛工作台高度：右侧编辑框外内框等高贴合并进一步下调左侧面板高度",
      "acceptance": "右侧编辑区外框不再因拉伸出现内框下方大留白；左侧 history/stats 面板高度进一步收敛且两 tab 仍等高；统计卡片密度保持可读",
      "related_files": [
        "src/pages/workspace.tsx",
        "src/components/stats/stats-overview-card.tsx",
        "src/components/editor/markdown-editor.tsx",
        "e2e/specs/stats-insights.spec.ts",
        "TODO.md"
      ],
      "test_record": "\`npm run lint\` 通过；\`npm run test:unit\` 通过（58/58）；\`npm run test:integration\` 通过（53/53）；\`npx playwright test e2e/specs/stats-insights.spec.ts --project=chromium --retries=0\` 通过（1/1，含左右底边对齐与统计卡不溢出断言）；\`npx playwright test e2e/specs/calendar-history.spec.ts --project=chromium --retries=0\` 通过（1/1）；未执行全量 \`npm run test:e2e\`（本任务未命中全量门禁，已执行与改动直接相关目标 E2E）",
      "done_record": "2026-02-13 / a06f71b",
      "source": {
        "file": "TODO.md",
        "line": 158
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_bdc1c2c8afd6d692830b",
      "display_id": "TD-UI-027",
      "id_prefix": "UI",
      "module_key": "6.8",
      "module_name": "UI 体验优化",
      "module_label": "6.8 UI 体验优化",
      "order": 105,
      "status": "DONE",
      "title": "微调工作台左栏分段控件（移除左栏“统计详情”按钮、分段去蓝）并修正编辑区标题与源码按钮对齐/间距",
      "acceptance": "左栏不再出现“统计详情”冗余按钮；分段控件在选中/未选中态均具备清晰可读对比且不使用蓝色；“日记”标题与“源码”按钮视觉对齐且标题与编辑框间距更舒展",
      "related_files": [
        "src/pages/workspace.tsx",
        "src/__tests__/integration/app.integration.test.tsx",
        "e2e/specs/stats-insights.spec.ts",
        "TODO.md"
      ],
      "test_record": "\`npm run lint\` 通过；\`npm run test:unit\` 通过（58/58）；\`npm run test:integration\` 通过（53/53）；\`npx playwright test e2e/specs/stats-insights.spec.ts --project=chromium --retries=0\` 通过（1/1，含分段对比度与入口回归断言）；\`npx playwright test e2e/specs/calendar-history.spec.ts --project=chromium --retries=0\` 通过（1/1）；未执行全量 \`npm run test:e2e\`（本任务未命中全量门禁，已执行与改动直接相关目标 E2E）",
      "done_record": "2026-02-13 / f458fd5",
      "source": {
        "file": "TODO.md",
        "line": 159
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_9310196e173544c2bbce",
      "display_id": "TD-UI-028",
      "id_prefix": "UI",
      "module_key": "6.8",
      "module_name": "UI 体验优化",
      "module_label": "6.8 UI 体验优化",
      "order": 106,
      "status": "DONE",
      "title": "将“今日日记”编辑框默认模式改为编辑（源码）模式",
      "acceptance": "进入工作台后，日记编辑框默认处于源码可输入态，无需先点“源码”按钮",
      "related_files": [
        "src/pages/workspace.tsx",
        "e2e/specs/daily-edit.spec.ts",
        "TODO.md"
      ],
      "test_record": "\`npm run lint\` 通过；\`npm run test:unit\` 通过（58/58）；\`npm run test:integration\` 通过（53/53）；\`npx playwright test e2e/specs/daily-edit.spec.ts --project=chromium --retries=0\` 首次失败（用例仍按旧默认可视化断言），修正用例后重跑通过（1/1）；未执行全量 \`npm run test:e2e\`（本任务未命中全量门禁，已执行与改动直接相关目标 E2E）",
      "done_record": "2026-02-13 / 1101a59",
      "source": {
        "file": "TODO.md",
        "line": 160
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_f1a5aba9c6c210cd0cfa",
      "display_id": "TD-UI-029",
      "id_prefix": "UI",
      "module_key": "6.8",
      "module_name": "UI 体验优化",
      "module_label": "6.8 UI 体验优化",
      "order": 107,
      "status": "DONE",
      "title": "将“今日日记”编辑框默认模式回退为可视化（所见即所得）",
      "acceptance": "进入工作台后，日记编辑框默认处于可视化编辑态；仅点击“源码”后才进入源码输入态",
      "related_files": [
        "src/pages/workspace.tsx",
        "e2e/specs/daily-edit.spec.ts",
        "TODO.md"
      ],
      "test_record": "\`npm run lint\` 通过；\`npm run test:unit\` 通过（58/58）；\`npm run test:integration\` 通过（54/54）；\`npx playwright test e2e/specs/daily-edit.spec.ts --project=chromium --retries=0\` 通过（1/1）；未执行全量 \`npm run test:e2e\`（本任务未命中全量门禁，已执行与改动直接相关目标 E2E）",
      "done_record": "2026-02-13 / c3a611d",
      "source": {
        "file": "TODO.md",
        "line": 161
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_30bb0019abe42a197c34",
      "display_id": "TD-UI-030",
      "id_prefix": "UI",
      "module_key": "6.8",
      "module_name": "UI 体验优化",
      "module_label": "6.8 UI 体验优化",
      "order": 108,
      "status": "DONE",
      "title": "全仓去除“Workspace/工作台”命名并统一为“日记/diary”（不做兼容）",
      "acceptance": "用户可见与代码层（路由、页面名、测试标识、E2E helper、文档）不再使用 workspace 术语；默认入口为 \`/diary\`；不保留 \`/workspace\` 兼容路由；\`TODO.md\` 历史记录保持原样",
      "related_files": [
        "src/App.tsx",
        "src/pages/diary.tsx",
        "src/pages/yearly-summary.tsx",
        "src/pages/insights.tsx",
        "src/components/auth/auth-modal.tsx",
        "src/__tests__/integration/app.integration.test.tsx",
        "e2e/fixtures/app.ts",
        "e2e/specs/*.spec.ts",
        "SPEC.md",
        "docs/ui-layout-prototype.html",
        "TODO.md"
      ],
      "test_record": "\`npm run lint\` 通过；\`npm run test:unit\` 通过（58/58）；\`npm run test:integration\` 通过（54/54）；\`npx playwright test e2e/specs/daily-edit.spec.ts e2e/specs/yearly-summary.spec.ts e2e/specs/stats-insights.spec.ts e2e/specs/calendar-history.spec.ts e2e/specs/auth-session.spec.ts --project=chromium --retries=0\` 首次失败（缺少 \`.env.e2e\`）；复制主工作区 \`.env.e2e\` 后重跑通过（9/9）；\`rg -n -i \\"workspace|工作台\\" --glob '!.git' --glob '!.worktrees/**' --glob '!TODO.md'\` 无命中",
      "done_record": "2026-02-14 / 5c0b76e",
      "source": {
        "file": "TODO.md",
        "line": 162
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_566065b893bf871c50ce",
      "display_id": "TD-UI-031",
      "id_prefix": "UI",
      "module_key": "6.8",
      "module_name": "UI 体验优化",
      "module_label": "6.8 UI 体验优化",
      "order": 109,
      "status": "DONE",
      "title": "同步工具栏与同步提示回退为中性灰风格（去蓝色强调）",
      "acceptance": "日记页与年度总结页同步工具栏不使用蓝色背景/按钮/信息态强调，整体回归中性灰风格且不影响 pull/push/Toast 行为",
      "related_files": [
        "src/index.css",
        "src/components/common/sync-control-bar.tsx",
        "src/components/common/toast-center.tsx",
        "src/pages/diary.tsx",
        "src/pages/yearly-summary.tsx",
        "TODO.md"
      ],
      "test_record": "\`npm run lint\` 通过；\`npm run test:unit\` 通过（58/58）；\`npm run test:integration\` 通过（55/55）；\`npm run test:e2e:fast\` 通过（4/4）",
      "done_record": "2026-02-14 / 994e551",
      "source": {
        "file": "TODO.md",
        "line": 163
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_3a3289ad748f94b91358",
      "display_id": "TD-UI-032",
      "id_prefix": "UI",
      "module_key": "6.8",
      "module_name": "UI 体验优化",
      "module_label": "6.8 UI 体验优化",
      "order": 110,
      "status": "DONE",
      "title": "同步工具栏背景色与日历背景保持一致（去除偏色叠加）",
      "acceptance": "同步工具栏背景与日历卡片背景完全一致（同色值来源）；视觉上不再偏暖/偏蓝；不影响 pull/push/Toast 功能与状态展示",
      "related_files": [
        "src/index.css",
        "src/pages/diary.tsx",
        "src/pages/yearly-summary.tsx",
        "TODO.md"
      ],
      "test_record": "\`npm run lint\` 通过；\`npm run test:unit\` 通过（58/58）；\`npm run test:integration\` 通过（55/55）；\`npm run test:e2e:fast\` 首次失败（\`manual-sync-success\` 出现 push 失败）；重跑 \`npx playwright test e2e/specs/manual-sync-success.spec.ts --project=chromium --retries=0\` 通过（1/1）；复跑 \`npm run test:e2e:fast\` 通过（4/4）",
      "done_record": "2026-02-14 / 5a4295b",
      "source": {
        "file": "TODO.md",
        "line": 164
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_7a30bdd5ca117aea3fde",
      "display_id": "TD-UI-033",
      "id_prefix": "UI",
      "module_key": "6.8",
      "module_name": "UI 体验优化",
      "module_label": "6.8 UI 体验优化",
      "order": 111,
      "status": "DONE",
      "title": "统一三页导航栏并将“会话”改为“设置”（进入设置页进行配置）",
      "acceptance": "日记/年度总结/统计三页使用同一导航结构；顶部移除“会话状态胶囊”；“设置”入口统一跳转设置页；设置页可完成配置并保留锁定入口；整体视觉保持当前简约风格",
      "related_files": [
        "src/components/common/app-header.tsx",
        "src/pages/settings.tsx",
        "src/pages/diary.tsx",
        "src/pages/yearly-summary.tsx",
        "src/pages/insights.tsx",
        "src/App.tsx",
        "src/__tests__/integration/app.integration.test.tsx",
        "e2e/fixtures/app.ts",
        "e2e/specs/stats-insights.spec.ts",
        "TODO.md"
      ],
      "test_record": "\`npm run lint\` 通过；\`npm run test:unit\` 通过（58/58）；\`npm run test:integration\` 通过（56/56）；\`npm run test:e2e:full\` 通过（22/22）",
      "done_record": "2026-02-14 / 97228db",
      "source": {
        "file": "TODO.md",
        "line": 165
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_e8fd281171b199189157",
      "display_id": "TD-UI-034",
      "id_prefix": "UI",
      "module_key": "6.8",
      "module_name": "UI 体验优化",
      "module_label": "6.8 UI 体验优化",
      "order": 112,
      "status": "DONE",
      "title": "优化月历年份步进控件为“箭头按钮 + 输入框”并保留直输跳转",
      "acceptance": "年份选择器支持点击左右箭头按年增减；保留输入合法年份即时跳转；边界年份按钮禁用且样式清晰；整体视觉与现有中性风格一致",
      "related_files": [
        "src/components/calendar/month-calendar.tsx",
        "TODO.md"
      ],
      "test_record": "风险分级：中；\`npm run lint\` 通过；\`npm run test:unit\` 通过（58/58）；\`npm run test:integration\` 通过（57/57）；\`npx playwright test e2e/specs/calendar-history.spec.ts --project=chromium --retries=0\` 通过（1/1）；未执行全量 \`npm run test:e2e\`（本任务未命中全量门禁，已执行与改动直接相关目标 E2E）",
      "done_record": "2026-02-15 / 81550f7",
      "source": {
        "file": "TODO.md",
        "line": 166
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_561fff684b060e682051",
      "display_id": "TD-UI-035",
      "id_prefix": "UI",
      "module_key": "6.8",
      "module_name": "UI 体验优化",
      "module_label": "6.8 UI 体验优化",
      "order": 113,
      "status": "DONE",
      "title": "精简年月弹层文案：移除“年份”标签并将“回到本月”改为图标按钮",
      "acceptance": "弹层中年份区域不再显示“年份”字样；回到当前月份入口改为仅图标按钮且具备可访问名称；保留年份输入与箭头步进全部功能",
      "related_files": [
        "src/components/calendar/month-calendar.tsx",
        "TODO.md"
      ],
      "test_record": "风险分级：中；\`npm run lint\` 通过；\`npm run test:unit\` 通过（116/116，含 \`.worktrees\` 重复测试文件）；\`npm run test:integration\` 通过（114/114，含 \`.worktrees\` 重复测试文件）；\`npx playwright test e2e/specs/calendar-history.spec.ts --project=chromium --retries=0\` 通过（1/1）；未执行全量 \`npm run test:e2e\`（本任务未命中全量门禁，已执行与改动直接相关目标 E2E）",
      "done_record": "2026-02-15 / 65445f5",
      "source": {
        "file": "TODO.md",
        "line": 167
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_72bf27e31a4f09024bbd",
      "display_id": "TD-UI-036",
      "id_prefix": "UI",
      "module_key": "6.8",
      "module_name": "UI 体验优化",
      "module_label": "6.8 UI 体验优化",
      "order": 114,
      "status": "DONE",
      "title": "点击 pull/push 任一按钮后，两个按钮在进行中同时禁用",
      "acceptance": "触发 pull 或 push 后，两按钮均立即进入禁用态；请求结束后恢复；不影响现有成功/失败提示与冲突流程",
      "related_files": [
        "src/components/common/sync-control-bar.tsx",
        "src/index.css",
        "src/__tests__/integration/editor.integration.test.tsx",
        "e2e/specs/manual-sync-busy-clear.spec.ts",
        "TODO.md"
      ],
      "test_record": "风险分级：中；\`npm run lint\` 通过；\`npm run test:unit\` 通过（58/58）；\`npm run test:integration\` 通过（57/57）；\`npm run test:e2e:fast\` 首次失败（新 worktree 缺少 \`.env.e2e\`），执行 \`bash /home/ljcwsl/.codex/skills/main-worktree-flow/scripts/worktree-flow.sh fix-e2e-env --branch plan/push-pull-dual-disable --repo /home/ljcwsl/0-code/TraceDiary --worktree /home/ljcwsl/0-code/TraceDiary/.worktrees/plan-push-pull-dual-disable --e2e-cmd \\\\\\"npm run test:e2e:fast\\\\\\"\` 后重跑通过（4/4）",
      "done_record": "2026-02-15 / 28ebb5d",
      "source": {
        "file": "TODO.md",
        "line": 168
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_a902d1578c9d7e8acc17",
      "display_id": "TD-UI-037",
      "id_prefix": "UI",
      "module_key": "6.8",
      "module_name": "UI 体验优化",
      "module_label": "6.8 UI 体验优化",
      "order": 115,
      "status": "DONE",
      "title": "重构设置页交互为页内直配（移除“配置”二次弹窗入口）并移除主动锁定按钮入口",
      "acceptance": "进入设置页可直接完成首次配置/解锁/Token 更新；设置页不再出现“配置”按钮与二次弹窗；保留日记/统计/年度总结未解锁阻断弹窗；全局不再提供“立即锁定”按钮",
      "related_files": [
        "src/pages/settings.tsx",
        "src/components/auth/auth-modal.tsx",
        "src/components/auth/auth-panel.tsx",
        "src/pages/welcome.tsx",
        "src/__tests__/integration/app.integration.test.tsx",
        "e2e/specs/auth-setup.spec.ts",
        "e2e/specs/auth-session.spec.ts",
        "TODO.md"
      ],
      "test_record": "风险分级：高；\`npm run lint\` 通过；\`npm run test:unit\` 通过（58/58）；\`npm run test:integration\` 通过（57/57）；\`npx playwright test e2e/specs/auth-setup.spec.ts e2e/specs/auth-session.spec.ts --project=chromium --retries=0\` 首次失败（缺少 \`.env.e2e\`）；执行 \`bash /home/ljcwsl/.codex/skills/main-worktree-flow/scripts/worktree-flow.sh fix-e2e-env --repo /home/ljcwsl/0-code/TraceDiary --branch plan/settings-inline-auth-panel --e2e-cmd \\"npx playwright test e2e/specs/auth-setup.spec.ts e2e/specs/auth-session.spec.ts --project=chromium --retries=0\\"\` 后重跑通过（5/5）；未执行全量 \`npm run test:e2e\`（本任务未命中全量门禁）",
      "done_record": "2026-02-15 / 502a1f8",
      "source": {
        "file": "TODO.md",
        "line": 169
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_56256e0f394c81548c99",
      "display_id": "TD-UI-038",
      "id_prefix": "UI",
      "module_key": "6.8",
      "module_name": "UI 体验优化",
      "module_label": "6.8 UI 体验优化",
      "order": 116,
      "status": "DONE",
      "title": "年度总结页对齐日记页编辑布局并统一年份切换控件",
      "acceptance": "年度总结页使用与日记页一致的“同步栏在上 + 编辑卡片在下”结构；年份切换交互与日历弹层一致（箭头步进+输入跳转）；编辑区在桌面端明显加长并接近铺满页面",
      "related_files": [
        "src/pages/yearly-summary.tsx",
        "src/__tests__/integration/editor.integration.test.tsx",
        "e2e/specs/yearly-summary.spec.ts",
        "TODO.md"
      ],
      "test_record": "风险分级：中；\`npm run lint\` 通过；\`npm run test:unit\` 通过（58/58）；\`npm run test:integration\` 通过（57/57）；\`npx playwright test e2e/specs/yearly-summary.spec.ts e2e/specs/calendar-history.spec.ts --project=chromium --retries=0\` 通过（3/3）；未执行全量 \`npm run test:e2e\`（本任务未命中全量门禁，已执行与改动直接相关目标 E2E）",
      "done_record": "2026-02-15 / c4172c6",
      "source": {
        "file": "TODO.md",
        "line": 170
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_ab9d395e89747198934a",
      "display_id": "TD-UI-039",
      "id_prefix": "UI",
      "module_key": "6.8",
      "module_name": "UI 体验优化",
      "module_label": "6.8 UI 体验优化",
      "order": 117,
      "status": "DONE",
      "title": "设置页去冗余并支持 ready 状态下直接编辑仓库/分支/Token",
      "acceptance": "设置页改为单层紧凑布局，移除解释性冗余文案与二级嵌套头；ready 状态可提交仓库/分支/Token 变更并即时校验生效；继续不提供“立即锁定”按钮",
      "related_files": [
        "src/pages/settings.tsx",
        "src/components/auth/auth-panel.tsx",
        "src/components/auth/auth-form-model.ts",
        "src/hooks/use-auth.ts",
        "src/hooks/__tests__/use-auth.test.tsx",
        "src/__tests__/integration/app.integration.test.tsx",
        "e2e/specs/settings-update.spec.ts",
        "TODO.md"
      ],
      "test_record": "风险分级：高；\`npm run lint\` 通过；\`npm run test:unit\` 通过（58/58）；\`npm run test:integration\` 通过（60/60）；\`npx playwright test e2e/specs/auth-setup.spec.ts e2e/specs/auth-session.spec.ts e2e/specs/settings-update.spec.ts --project=chromium --retries=0\` 首次失败（缺少 \`.env.e2e\`），执行 \`bash /home/ljcwsl/.codex/skills/main-worktree-flow/scripts/worktree-flow.sh fix-e2e-env --repo /home/ljcwsl/0-code/TraceDiary --branch plan/settings-page-compact-editable --e2e-cmd \\"npx playwright test e2e/specs/auth-setup.spec.ts e2e/specs/auth-session.spec.ts e2e/specs/settings-update.spec.ts --project=chromium --retries=0\\"\` 后发现新增 settings 用例失败，修复后重跑同命令通过（7/7）；未执行全量 \`npm run test:e2e\`（本任务未命中全量门禁）",
      "done_record": "2026-02-15 / 46fadd6",
      "source": {
        "file": "TODO.md",
        "line": 171
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_7dcc2612028875774cdb",
      "display_id": "TD-UI-040",
      "id_prefix": "UI",
      "module_key": "6.8",
      "module_name": "UI 体验优化",
      "module_label": "6.8 UI 体验优化",
      "order": 118,
      "status": "DONE",
      "title": "优化同步按钮进行中视觉与 Toast 生命周期（移除 \`...\`、进行中常驻到结束后被结果顶替）",
      "acceptance": "按钮进行中不再显示 \`pulling.../pushing...\`，改为 \`pull/push + 小圆点脉冲\`；\`pull/push\` 进行中提示不自动消失，成功/失败结束提示到达后顶替进行中提示并按原时长自动消失",
      "related_files": [
        "src/components/common/sync-control-bar.tsx",
        "src/index.css",
        "src/hooks/use-toast.ts",
        "src/pages/diary.tsx",
        "src/pages/yearly-summary.tsx",
        "src/hooks/__tests__/use-toast.test.tsx",
        "src/__tests__/integration/editor.integration.test.tsx",
        "e2e/specs/manual-sync-busy-clear.spec.ts",
        "TODO.md"
      ],
      "test_record": "风险分级：中；\`npm run lint\` 首次失败（worktree 缺少依赖，\`eslint: not found\`），挂载主工作区 \`node_modules\` 后通过；\`npm run test:unit\` 通过（58/58）；\`npm run test:integration\` 通过（59/59）；\`npm run test:e2e:fast\` 首次失败（缺少 \`.env.e2e\`）；执行 \`bash /home/ljcwsl/.codex/skills/main-worktree-flow/scripts/worktree-flow.sh fix-e2e-env --branch plan/sync-toast-motion-polish --repo /home/ljcwsl/0-code/TraceDiary --worktree /home/ljcwsl/0-code/TraceDiary-wt-plan_sync-toast-motion-polish --e2e-cmd \\"npm run test:e2e:fast\\"\` 后重跑通过（4/4）；\`npx playwright test e2e/specs/manual-sync-busy-clear.spec.ts --project=chromium --retries=0\` 通过（1/1）",
      "done_record": "2026-02-15 / 36b519e",
      "source": {
        "file": "TODO.md",
        "line": 172
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_4e3bfdfb09d876d4ab58",
      "display_id": "TD-UI-041",
      "id_prefix": "UI",
      "module_key": "6.8",
      "module_name": "UI 体验优化",
      "module_label": "6.8 UI 体验优化",
      "order": 119,
      "status": "DONE",
      "title": "继续精简设置页 ready 区域：移除重复状态展示并收敛文案到必要信息",
      "acceptance": "设置页 ready 区域不再重复出现 \`READY/状态卡/状态行\`；仅保留可编辑项与必要说明；文案简洁且无重复解释",
      "related_files": [
        "src/components/auth/auth-panel.tsx",
        "e2e/specs/settings-update.spec.ts",
        "TODO.md"
      ],
      "test_record": "风险分级：中；\`npm run lint\` 通过；\`npm run test:unit\` 通过（58/58）；\`npm run test:integration\` 通过（62/62）；\`npx playwright test e2e/specs/settings-update.spec.ts --project=chromium --retries=0\` 通过（2/2）；未执行全量 \`npm run test:e2e\`（本任务未命中全量门禁）",
      "done_record": "2026-02-15 / 35a06d1",
      "source": {
        "file": "TODO.md",
        "line": 173
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_a5d4c38eb50ac770acaa",
      "display_id": "TD-UI-042",
      "id_prefix": "UI",
      "module_key": "6.8",
      "module_name": "UI 体验优化",
      "module_label": "6.8 UI 体验优化",
      "order": 120,
      "status": "DONE",
      "title": "设置页进一步压缩留白并重排布局（去空占位、去无意义说明、桌面双列）",
      "acceptance": "设置页不再出现顶部/底部大空白；去除“仅保留必要项”说明；桌面端字段采用双列排布降低右侧留白，移动端保持单列可用",
      "related_files": [
        "src/pages/settings.tsx",
        "src/components/auth/auth-panel.tsx",
        "e2e/specs/settings-update.spec.ts",
        "TODO.md"
      ],
      "test_record": "风险分级：中；\`npm run lint\` 通过；\`npm run test:unit\` 通过（58/58）；\`npm run test:integration\` 通过（62/62）；\`npx playwright test e2e/specs/settings-update.spec.ts --project=chromium --retries=0\` 通过（2/2）；未执行全量 \`npm run test:e2e\`（本任务未命中全量门禁）",
      "done_record": "2026-02-15 / a98e819",
      "source": {
        "file": "TODO.md",
        "line": 174
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_17ad7760c424ccd90fc8",
      "display_id": "TD-UI-043",
      "id_prefix": "UI",
      "module_key": "6.8",
      "module_name": "UI 体验优化",
      "module_label": "6.8 UI 体验优化",
      "order": 121,
      "status": "DONE",
      "title": "统计页升级为图表主导仪表盘（保留明细表并新增月度趋势/年度对比可视化）",
      "acceptance": "统计页首屏展示 KPI + 月度趋势主图；新增年度对比图；年度表格保留并支持明细核对；移动端保持同密度可用",
      "related_files": [
        "src/pages/insights.tsx",
        "src/components/stats/monthly-trend-chart.tsx",
        "src/components/stats/yearly-comparison-chart.tsx",
        "src/components/stats/yearly-stats-table.tsx",
        "src/utils/stats.ts",
        "src/types/stats.ts",
        "src/__tests__/unit/stats.unit.test.ts",
        "src/__tests__/integration/app.integration.test.tsx",
        "e2e/specs/stats-insights.spec.ts",
        "TODO.md"
      ],
      "test_record": "风险分级：中；\`npm run lint\` 首次失败（worktree 缺少依赖，\`eslint: not found\`），挂载主工作区 \`node_modules\` 后通过；\`npm run test:unit\` 通过（59/59）；\`npm run test:integration\` 通过（62/62）；\`npx playwright test e2e/specs/stats-insights.spec.ts --project=chromium --retries=0\` 首次失败（缺少 \`.env.e2e\`），执行 \`bash /home/ljcwsl/.codex/skills/main-worktree-flow/scripts/worktree-flow.sh fix-e2e-env --branch plan/insights-dashboard-svg-v1 --repo /home/ljcwsl/0-code/TraceDiary --worktree /home/ljcwsl/0-code/TraceDiary-wt-plan_insights-dashboard-svg-v1 --e2e-cmd \\\\\\"npx playwright test e2e/specs/stats-insights.spec.ts --project=chromium --retries=0\\\\\\"\` 后重跑通过（1/1）；未执行全量 \`npm run test:e2e\`（本任务未命中全量门禁）",
      "done_record": "2026-02-15 / dac12c4",
      "source": {
        "file": "TODO.md",
        "line": 175
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_4b50e2e11e1a52fc5902",
      "display_id": "TD-UI-044",
      "id_prefix": "UI",
      "module_key": "6.8",
      "module_name": "UI 体验优化",
      "module_label": "6.8 UI 体验优化",
      "order": 122,
      "status": "DONE",
      "title": "重构同步栏为“主状态 + 悬浮明细”并去除主栏 pull/push 双气泡冗余",
      "acceptance": "主栏仅展示全局同步状态与 pull/push 按钮；pull/push 结果与时间改为 hover/focus/tap 可见明细；失败不在主栏常驻展示但可在 toast 与明细中回看；日记页与年度页复用同一同步栏组件",
      "related_files": [
        "src/components/common/sync-control-bar.tsx",
        "src/pages/diary.tsx",
        "src/pages/yearly-summary.tsx",
        "src/index.css",
        "TODO.md"
      ],
      "test_record": "风险分级：中；\`npm run lint\` 通过（首次失败：\`eslint: not found\`，已在 worktree 挂载主工作区 \`node_modules\` 后重跑通过）；\`npm run test:unit\` 通过（58/58）；\`npm run test:integration\` 通过（62/62）；\`npx playwright test e2e/specs/manual-sync-state-consistency.spec.ts e2e/specs/manual-sync-busy-clear.spec.ts e2e/specs/yearly-summary.spec.ts --project=chromium --retries=0\` 首次失败（缺少 \`.env.e2e\`）；执行 \`bash /home/ljcwsl/.codex/skills/main-worktree-flow/scripts/worktree-flow.sh fix-e2e-env --branch plan/syncbar-hover-details --repo /home/ljcwsl/0-code/TraceDiary --worktree /home/ljcwsl/0-code/TraceDiary-wt-plan_syncbar-hover-details --e2e-cmd \\\\\\"npx playwright test e2e/specs/manual-sync-state-consistency.spec.ts e2e/specs/manual-sync-busy-clear.spec.ts e2e/specs/yearly-summary.spec.ts --project=chromium --retries=0\\\\\\"\` 后重跑通过（4/4）；未执行全量 \`npm run test:e2e\`（本任务未命中全量门禁）",
      "done_record": "2026-02-15 / 2773497",
      "source": {
        "file": "TODO.md",
        "line": 176
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_80e76eb65bcdf6d480ea",
      "display_id": "TD-UI-045",
      "id_prefix": "UI",
      "module_key": "6.8",
      "module_name": "UI 体验优化",
      "module_label": "6.8 UI 体验优化",
      "order": 123,
      "status": "DONE",
      "title": "统计页文案收敛与可视区优化（去说明性副文案、移除年度总结篇数列、图表改为无横向滚动）",
      "acceptance": "统计页标题区不再出现说明性副文案；年度表格不再展示“年度总结篇数”；近12月趋势与年度对比在桌面端默认无需横向滚动即可完整展示",
      "related_files": [
        "src/pages/insights.tsx",
        "src/components/stats/monthly-trend-chart.tsx",
        "src/components/stats/yearly-comparison-chart.tsx",
        "src/components/stats/yearly-stats-table.tsx",
        "e2e/specs/stats-insights.spec.ts",
        "TODO.md"
      ],
      "test_record": "风险分级：中；\`npm run lint\` 首次失败（worktree 缺少依赖，\`eslint: not found\`），挂载主工作区 \`node_modules\` 后通过；\`npm run test:unit\` 通过（59/59）；\`npm run test:integration\` 通过（62/62）；\`npx playwright test e2e/specs/stats-insights.spec.ts --project=chromium --retries=0\` 首次失败（缺少 \`.env.e2e\`），执行 \`bash /home/ljcwsl/.codex/skills/main-worktree-flow/scripts/worktree-flow.sh fix-e2e-env --branch plan/insights-polish-no-scroll --repo /home/ljcwsl/0-code/TraceDiary --worktree /home/ljcwsl/0-code/TraceDiary-wt-plan_insights-polish-no-scroll --e2e-cmd \\\\\\"npx playwright test e2e/specs/stats-insights.spec.ts --project=chromium --retries=0\\\\\\"\` 后重跑通过（1/1）；未执行全量 \`npm run test:e2e\`（本任务未命中全量门禁）",
      "done_record": "2026-02-15 / c293293",
      "source": {
        "file": "TODO.md",
        "line": 177
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_d850c6acf945a690a96e",
      "display_id": "TD-UI-046",
      "id_prefix": "UI",
      "module_key": "6.8",
      "module_name": "UI 体验优化",
      "module_label": "6.8 UI 体验优化",
      "order": 124,
      "status": "DONE",
      "title": "同步栏改为仅点击小气泡展开明细，并在失败态展示完整失败原因（含刷新后保留）",
      "acceptance": "仅点击“已同步/未同步/同步中”小气泡触发明细；移除整栏 hover 触发；失败态在明细中显示完整原因并可刷新后继续查看；日记页与年度页复用同一实现",
      "related_files": [
        "src/components/common/sync-control-bar.tsx",
        "src/pages/diary.tsx",
        "src/pages/yearly-summary.tsx",
        "src/utils/sync-presentation.ts",
        "src/index.css",
        "e2e/specs/manual-sync-failure.spec.ts",
        "e2e/specs/manual-sync-hang-guard.spec.ts",
        "TODO.md"
      ],
      "test_record": "风险分级：中；\`npm run lint\` 通过；\`npm run test:unit\` 通过（59/59）；\`npm run test:integration\` 通过（62/62）；\`npx playwright test e2e/specs/manual-sync-busy-clear.spec.ts e2e/specs/manual-sync-state-consistency.spec.ts e2e/specs/manual-sync-failure.spec.ts e2e/specs/manual-sync-hang-guard.spec.ts --project=chromium --retries=0\` 通过（4/4）；未执行全量 \`npm run test:e2e\`（本任务未命中全量门禁）",
      "done_record": "2026-02-15 / 17c38d2",
      "source": {
        "file": "TODO.md",
        "line": 178
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_c052f1530b9827d7ca7b",
      "display_id": "TD-UI-047",
      "id_prefix": "UI",
      "module_key": "6.8",
      "module_name": "UI 体验优化",
      "module_label": "6.8 UI 体验优化",
      "order": 125,
      "status": "DONE",
      "title": "统计页改造为“年度卡片摘要 + 年度热力图（按日记日期、按字数着色）”，并移除重复统计与年度表格",
      "acceptance": "导航栏文案改为“数据统计”；统计详情页不再重复展示日记页已有 KPI；年度区域提供摘要卡片与按 \`daily.date\` 聚合的年度热力图（色阶基于当日字数，非篇数）；移除年度汇总表格并保证桌面/移动端无异常大留白",
      "related_files": [
        "src/components/common/app-header.tsx",
        "src/pages/insights.tsx",
        "src/components/stats/yearly-summary-cards.tsx",
        "src/components/stats/yearly-activity-heatmap.tsx",
        "src/utils/stats-heatmap.ts",
        "e2e/specs/stats-insights.spec.ts",
        "TODO.md"
      ],
      "test_record": "风险分级：中；\`npm run lint\` 通过；\`npm run test:unit\` 通过（63/63）；\`npm run test:integration\` 通过（62/62）；\`npx playwright test e2e/specs/stats-insights.spec.ts --project=chromium --retries=0\` 首次失败（缺少 \`.env.e2e\`）；执行 \`bash /home/ljcwsl/.codex/skills/main-worktree-flow/scripts/worktree-flow.sh fix-e2e-env --branch plan/insights-year-heatmap-cards --repo /home/ljcwsl/0-code/TraceDiary --worktree /home/ljcwsl/0-code/TraceDiary-wt-plan_insights-year-heatmap-cards --e2e-cmd \\\\\\"npx playwright test e2e/specs/stats-insights.spec.ts --project=chromium --retries=0\\\\\\"\` 后重跑通过（1/1）；未执行全量 \`npm run test:e2e\`（本任务未命中全量门禁）",
      "done_record": "2026-02-15 / 9b1801e",
      "source": {
        "file": "TODO.md",
        "line": 179
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_d02653136c25bd2d9293",
      "display_id": "TD-UI-048",
      "id_prefix": "UI",
      "module_key": "6.8",
      "module_name": "UI 体验优化",
      "module_label": "6.8 UI 体验优化",
      "order": 126,
      "status": "DONE",
      "title": "统计页热力图改造为“年份箭头输入 + 周一开头 + 右侧信息区”，消除右侧大面积留白",
      "acceptance": "热力图年份选择采用与日历体系一致的箭头+输入；周起始改为周一；右侧空白改为信息区（图例+选中日期+年度摘要）；整体视觉更均衡且无明显大块空白",
      "related_files": [
        "src/components/stats/yearly-activity-heatmap.tsx",
        "src/utils/stats-heatmap.ts",
        "src/__tests__/unit/stats-heatmap.unit.test.ts",
        "src/__tests__/integration/app.integration.test.tsx",
        "e2e/specs/stats-insights.spec.ts",
        "TODO.md"
      ],
      "test_record": "风险分级：中；\`npm run lint\` 通过；\`npm run test:unit\` 通过（76/76）；\`npm run test:integration\` 通过（67/67）；\`npx playwright test e2e/specs/stats-insights.spec.ts --project=chromium --retries=0\` 首次失败（缺少 \`.env.e2e\`），执行 \`bash /home/ljcwsl/.codex/skills/main-worktree-flow/scripts/worktree-flow.sh fix-e2e-env --branch plan/insights-heatmap-monday-picker --repo /home/ljcwsl/0-code/TraceDiary --worktree /home/ljcwsl/0-code/TraceDiary-wt-plan_insights-heatmap-monday-picker --e2e-cmd \\\\\\"npx playwright test e2e/specs/stats-insights.spec.ts --project=chromium --retries=0\\\\\\"\` 后发现选择器断言冲突，修正断言并重跑同命令通过（1/1）；未执行全量 \`npm run test:e2e\`（本任务未命中全量门禁）",
      "done_record": "2026-02-15 / c9dc785",
      "source": {
        "file": "TODO.md",
        "line": 180
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_0ee6432b401cd6467fcf",
      "display_id": "TD-UI-049",
      "id_prefix": "UI",
      "module_key": "6.8",
      "module_name": "UI 体验优化",
      "module_label": "6.8 UI 体验优化",
      "order": 127,
      "status": "DONE",
      "title": "将导入入口从日记页迁移到设置页，并统一导入/导出为同一暖色数据管理视觉体系",
      "acceptance": "设置页提供可用导入与导出入口；日记页不再展示导入入口；导入流程（预检/冲突/结果/自动上传）行为不回退；导入与导出卡片样式统一且与现有中性主界面分层共存",
      "related_files": [
        "src/pages/diary.tsx",
        "src/pages/settings.tsx",
        "src/components/common/import-data-panel.tsx",
        "src/components/common/export-data-panel.tsx",
        "src/index.css",
        "src/__tests__/integration/import.integration.test.tsx",
        "e2e/specs/import.spec.ts",
        "e2e/specs/stats-insights.spec.ts",
        "TODO.md"
      ],
      "test_record": "风险分级：中；\`npm run lint\` 通过；\`npm run test:unit\` 通过（75/75）；\`npm run test:integration\` 通过（67/67）；\`npx playwright test e2e/specs/import.spec.ts\` 首次失败（worktree 缺少 \`.env.e2e\`），复制主工作区 \`.env.e2e\` 后重跑通过（1/1）；\`npm run test:e2e:full\` 通过（26 passed，1 flaky 重试通过）；\`npx playwright test e2e/specs/stats-insights.spec.ts\` 通过（1/1，修复热力图年份切换稳定性）",
      "done_record": "2026-02-15 / dd5b3ce",
      "source": {
        "file": "TODO.md",
        "line": 181
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_bb87911a011772f1ea31",
      "display_id": "TD-UI-050",
      "id_prefix": "UI",
      "module_key": "6.8",
      "module_name": "UI 体验优化",
      "module_label": "6.8 UI 体验优化",
      "order": 128,
      "status": "DONE",
      "title": "精简导入/导出相关文案，仅保留必要信息",
      "acceptance": "设置页导入与导出面板仅保留“导入/导出”标题与按钮；进行中状态改为按钮左侧闪动圆点 + Toast（与 pull/push 反馈模式一致）；不影响导入导出行为与现有测试链路",
      "related_files": [
        "src/components/common/import-data-panel.tsx",
        "src/components/common/export-data-panel.tsx",
        "src/components/common/import-conflict-dialog.tsx",
        "src/components/common/import-result-dialog.tsx",
        "src/index.css",
        "TODO.md"
      ],
      "test_record": "风险分级：中；\`npm run lint\` 通过；\`npm run test:unit\` 通过（76/76）；\`npm run test:integration\` 通过（67/67）；\`npx playwright test e2e/specs/import.spec.ts e2e/specs/export-data.spec.ts --project=chromium --retries=0\` 首次失败（并行执行导致导出“无数据”断言受污染），追加 \`--workers=1\` 串行重跑通过（3/3）",
      "done_record": "2026-02-15 / ac1e1fe",
      "source": {
        "file": "TODO.md",
        "line": 182
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_19f4cf16c7086e6f3ffd",
      "display_id": "TD-UI-051",
      "id_prefix": "UI",
      "module_key": "6.8",
      "module_name": "UI 体验优化",
      "module_label": "6.8 UI 体验优化",
      "order": 129,
      "status": "DONE",
      "title": "统计页信息架构重排与图表留白优化（统一层级、月度指标右置、热力图图例/选中信息下置）",
      "acceptance": "统计页标题层级清晰（避免“年度对比/年度洞察/年度热力图”并列混乱）；月度趋势指标不再位于图表上下造成大面积留白；热力图右侧仅保留年度关键指标，图例与选中日期移至热力图下方；桌面端不出现明显不合理空白块",
      "related_files": [
        "src/pages/insights.tsx",
        "src/components/stats/monthly-trend-chart.tsx",
        "src/components/stats/yearly-activity-heatmap.tsx",
        "src/__tests__/integration/app.integration.test.tsx",
        "e2e/specs/stats-insights.spec.ts",
        "TODO.md"
      ],
      "test_record": "风险分级：中；\`npm run lint\` 首次失败（worktree 缺少依赖，\`eslint: not found\`），挂载主工作区 \`node_modules\` 后重跑通过；\`npm run test:unit\` 通过（76/76）；\`npm run test:integration\` 通过（67/67）；\`npx playwright test e2e/specs/stats-insights.spec.ts --project=chromium --retries=0\` 首次失败（缺少 \`.env.e2e\`），执行 \`bash /home/ljcwsl/.codex/skills/main-worktree-flow/scripts/worktree-flow.sh fix-e2e-env --branch plan/insights-ia-layout-polish --repo /home/ljcwsl/0-code/TraceDiary --worktree /home/ljcwsl/0-code/TraceDiary-wt-plan_insights-ia-layout-polish --e2e-cmd \\\\\\"npx playwright test e2e/specs/stats-insights.spec.ts --project=chromium --retries=0\\\\\\"\` 后重跑通过（1/1）；未执行全量 \`npm run test:e2e\`（本任务未命中全量门禁）",
      "done_record": "2026-02-15 / 4e05f33",
      "source": {
        "file": "TODO.md",
        "line": 183
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_7f4e71536443f4553569",
      "display_id": "TD-UI-052",
      "id_prefix": "UI",
      "module_key": "6.8",
      "module_name": "UI 体验优化",
      "module_label": "6.8 UI 体验优化",
      "order": 130,
      "status": "DONE",
      "title": "同步状态胶囊圆点改造为“颜色+动效”状态编码（保留圆点、不使用勾/感叹号）",
      "acceptance": "汇总/拉取/上传三类状态圆点可区分 \`idle/running/success/error\`；错误态为红色语义；不引入勾号/感叹号图形；文案与交互行为不回退",
      "related_files": [
        "src/components/common/sync-control-bar.tsx",
        "src/index.css",
        "src/__tests__/integration/editor.integration.test.tsx",
        "TODO.md"
      ],
      "test_record": "风险分级：中；\`npm run lint\` 通过；\`npm run test:unit\` 通过（76/76）；\`npm run test:integration\` 通过（67/67）；\`npm run test:e2e:fast\` 首次失败（新 worktree 缺少 \`.env.e2e\`）；执行 \`bash /home/ljcwsl/.codex/skills/main-worktree-flow/scripts/worktree-flow.sh fix-e2e-env --branch plan/sync-status-dot-color-only --repo /home/ljcwsl/0-code/TraceDiary --worktree /home/ljcwsl/0-code/TraceDiary-wt-plan_sync-status-dot-color-only --e2e-cmd \\\\\\"npm run test:e2e:fast\\\\\\"\` 后重跑通过（5/5）；未执行全量 \`npm run test:e2e\`（本任务未命中全量门禁）",
      "done_record": "2026-02-17 / 31bd262",
      "source": {
        "file": "TODO.md",
        "line": 184
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_e829bd32dd440d62fc30",
      "display_id": "TD-UI-053",
      "id_prefix": "UI",
      "module_key": "6.8",
      "module_name": "UI 体验优化",
      "module_label": "6.8 UI 体验优化",
      "order": 131,
      "status": "DONE",
      "title": "优化统计页月度趋势右侧指标区对齐与留白填充（顶部对齐图表，新增可伸展信息卡）",
      "acceptance": "右侧指标区顶部与图表绘图区顶边对齐（非图例）；右侧下方不再出现明显空白；桌面端视觉重心平衡且移动端不回退",
      "related_files": [
        "src/pages/insights.tsx",
        "src/components/stats/monthly-trend-chart.tsx",
        "src/__tests__/integration/app.integration.test.tsx",
        "e2e/specs/stats-insights.spec.ts",
        "TODO.md"
      ],
      "test_record": "风险分级：中；\`npm run lint\` 通过；\`npm run test:unit\` 通过（76/76）；\`npm run test:integration\` 通过（67/67）；\`npx playwright test e2e/specs/stats-insights.spec.ts --project=chromium --retries=0\` 首次失败（worktree 缺少 \`.env.e2e\`），从主工作区复制 \`.env.e2e\` 后重跑通过（1/1）；未执行全量 \`npm run test:e2e\`（本任务未命中全量门禁）",
      "done_record": "2026-02-17 / 48ebfb5",
      "source": {
        "file": "TODO.md",
        "line": 185
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_290d988f74b96a3efd2d",
      "display_id": "TD-UI-054",
      "id_prefix": "UI",
      "module_key": "6.8",
      "module_name": "UI 体验优化",
      "module_label": "6.8 UI 体验优化",
      "order": 132,
      "status": "DONE",
      "title": "设置页视觉一致性修正（顶部设置卡改为日历同款底色 + 覆盖 autofill 蓝底）",
      "acceptance": "设置页顶部“设置”卡片背景与日历卡片一致；浏览器自动填充后输入框不再出现突兀蓝底；交互与认证流程不回退",
      "related_files": [
        "src/pages/settings.tsx",
        "src/index.css",
        "TODO.md"
      ],
      "test_record": "风险分级：中；\`npm run lint\` 通过；\`npm run test:unit\` 通过（152/152）；\`npm run test:integration\` 通过（134/134）；\`npx playwright test e2e/specs/settings-update.spec.ts --project=chromium --retries=0\` 通过（2/2）；未执行全量 \`npm run test:e2e\`（本任务未命中全量门禁）",
      "done_record": "2026-02-17 / 9b0b869",
      "source": {
        "file": "TODO.md",
        "line": 186
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_99d08f0b39eb8b131625",
      "display_id": "TD-UI-055",
      "id_prefix": "UI",
      "module_key": "6.8",
      "module_name": "UI 体验优化",
      "module_label": "6.8 UI 体验优化",
      "order": 133,
      "status": "DONE",
      "title": "调整统计页月度与热力图布局（移除趋势解读、补齐4张统计卡、收紧热力图左右间距并拉齐右侧底边）",
      "acceptance": "月度趋势右侧改为 4 张数据卡且不再展示“趋势解读”；年度热力图左右间距收紧；右侧三卡底边与左侧下方信息卡区域底边对齐",
      "related_files": [
        "src/pages/insights.tsx",
        "src/components/stats/yearly-activity-heatmap.tsx",
        "src/__tests__/integration/app.integration.test.tsx",
        "e2e/specs/stats-insights.spec.ts",
        "TODO.md"
      ],
      "test_record": "风险分级：中；\`npm run lint\` 通过；\`npm run test:unit\` 通过（76/76）；\`npm run test:integration\` 通过（67/67）；\`npx playwright test e2e/specs/stats-insights.spec.ts --project=chromium --retries=0\` 首次失败（worktree 缺少 \`.env.e2e\`），从主工作区复制 \`.env.e2e\` 后重跑通过（1/1）；未执行全量 \`npm run test:e2e\`（本任务未命中全量门禁）",
      "done_record": "2026-02-17 / 700b2f6",
      "source": {
        "file": "TODO.md",
        "line": 187
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_a61fcf5313150138416c",
      "display_id": "TD-UI-056",
      "id_prefix": "UI",
      "module_key": "6.8",
      "module_name": "UI 体验优化",
      "module_label": "6.8 UI 体验优化",
      "order": 134,
      "status": "DONE",
      "title": "收敛年度热力图右侧空白并放大热力图主体（右栏贴右 + 左图自适应扩展）",
      "acceptance": "年度热力图右侧卡片应贴近容器右边且不留明显空白；左侧热力图较当前略放大；左右间距收敛并保持右栏底边与下方信息卡区域对齐",
      "related_files": [
        "src/components/stats/yearly-activity-heatmap.tsx",
        "e2e/specs/stats-insights.spec.ts",
        "TODO.md"
      ],
      "test_record": "风险分级：中；\`npm run lint\` 通过；\`npm run test:unit\` 通过（152/152）；\`npm run test:integration\` 通过（134/134）；\`npx playwright test e2e/specs/stats-insights.spec.ts --project=chromium --retries=0\` 通过（1/1）；未执行全量 \`npm run test:e2e\`（本任务未命中全量门禁）",
      "done_record": "2026-02-17 / 8fbb904",
      "source": {
        "file": "TODO.md",
        "line": 188
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_d47989b6fb9ee38f9a59",
      "display_id": "TD-UI-057",
      "id_prefix": "UI",
      "module_key": "6.8",
      "module_name": "UI 体验优化",
      "module_label": "6.8 UI 体验优化",
      "order": 135,
      "status": "DONE",
      "title": "重构设置页信息架构为“连接设置 + 数据管理单卡双动作”，补齐防误操作短文案",
      "acceptance": "设置页包含顶部简介、连接设置区与数据管理区；导入/导出合并在同一卡片两行展示；主任务区字段具备简短约束说明；现有导入/导出/设置更新链路不回退",
      "related_files": [
        "src/pages/settings.tsx",
        "src/components/auth/auth-panel.tsx",
        "src/components/common/import-data-panel.tsx",
        "src/components/common/export-data-panel.tsx",
        "src/index.css",
        "TODO.md"
      ],
      "test_record": "风险分级：中；\`npm run lint\` 通过；\`npm run test:unit\` 通过（76/76）；\`npm run test:integration\` 通过（67/67）；\`npx playwright test e2e/specs/settings-update.spec.ts e2e/specs/import.spec.ts e2e/specs/export-data.spec.ts --project=chromium --retries=0 --workers=1\` 首次失败（worktree 缺少 \`.env.e2e\`）；执行 \`bash /home/ljcwsl/.codex/skills/main-worktree-flow/scripts/worktree-flow.sh fix-e2e-env --repo /home/ljcwsl/0-code/TraceDiary --branch plan/settings-ia-data-management --worktree /home/ljcwsl/0-code/TraceDiary/.worktrees/plan-settings-ia-data-management --e2e-cmd \\\\\\"npx playwright test e2e/specs/settings-update.spec.ts e2e/specs/import.spec.ts e2e/specs/export-data.spec.ts --project=chromium --retries=0 --workers=1\\\\\\"\` 后重跑通过（5/5）；未执行全量 \`npm run test:e2e\`（本任务未命中全量门禁）",
      "done_record": "2026-02-17 / cb538bb",
      "source": {
        "file": "TODO.md",
        "line": 189
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_dc1f1d187883127319cf",
      "display_id": "TD-UI-058",
      "id_prefix": "UI",
      "module_key": "6.8",
      "module_name": "UI 体验优化",
      "module_label": "6.8 UI 体验优化",
      "order": 136,
      "status": "DONE",
      "title": "明确月度环比口径并统一统计页三图青绿配色（文案可读 + 主题一致）",
      "acceptance": "“最近月份字数环比”明确为字数口径；月度趋势/年度对比/年度热力图采用统一青绿系颜色；图例与图形颜色一致且可读",
      "related_files": [
        "src/pages/insights.tsx",
        "src/components/stats/monthly-trend-chart.tsx",
        "src/components/stats/yearly-comparison-chart.tsx",
        "src/components/stats/yearly-activity-heatmap.tsx",
        "src/components/stats/stats-chart-theme.ts",
        "TODO.md"
      ],
      "test_record": "风险分级：中；\`npm run lint\` 通过；\`npm run test:unit\` 通过（76/76）；\`npm run test:integration\` 通过（67/67）；\`npx playwright test e2e/specs/stats-insights.spec.ts --project=chromium --retries=0\` 通过（1/1）；未执行全量 \`npm run test:e2e\`（本任务未命中全量门禁）",
      "done_record": "2026-02-17 / 271a868",
      "source": {
        "file": "TODO.md",
        "line": 190
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_dfdd6b3f78efcadd6fca",
      "display_id": "TD-UI-059",
      "id_prefix": "UI",
      "module_key": "6.8",
      "module_name": "UI 体验优化",
      "module_label": "6.8 UI 体验优化",
      "order": 137,
      "status": "DONE",
      "title": "对齐设置页主标题样式并移除重复校验说明文案",
      "acceptance": "设置页主标题视觉样式与“数据统计”页一致；移除“填写后将立即校验连接与凭证…”与“提交后将立即校验…”两条重复提示；设置更新链路不回退",
      "related_files": [
        "src/pages/settings.tsx",
        "src/components/auth/auth-panel.tsx",
        "TODO.md"
      ],
      "test_record": "风险分级：中；\`npm run lint\` 通过；\`npm run test:unit\` 通过（76/76）；\`npm run test:integration\` 通过（67/67）；\`npx playwright test e2e/specs/settings-update.spec.ts --project=chromium --retries=0\` 通过（2/2）；未执行全量 \`npm run test:e2e\`（本任务未命中全量门禁）",
      "done_record": "2026-02-17 / 985ab49",
      "source": {
        "file": "TODO.md",
        "line": 191
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_cd7f09abbe666208cf94",
      "display_id": "TD-UI-060",
      "id_prefix": "UI",
      "module_key": "6.8",
      "module_name": "UI 体验优化",
      "module_label": "6.8 UI 体验优化",
      "order": 138,
      "status": "DONE",
      "title": "年度总结页改造为“左侧弱统计+目录 / 右侧写作主区”双栏布局，并增强年份标题层级与阅读宽度",
      "acceptance": "年度页桌面端为双栏结构且左栏包含年份锚点、弱统计、目录；移动端可折叠回单列；右侧编辑区保持写作主场并限制可读宽度；不影响 pull/push、年份切换、冲突处理",
      "related_files": [
        "src/pages/yearly-summary.tsx",
        "src/components/yearly/*",
        "src/utils/yearly-sidebar-stats.ts",
        "src/utils/markdown-toc.ts",
        "src/__tests__/unit/*",
        "src/__tests__/integration/editor.integration.test.tsx",
        "e2e/specs/yearly-summary.spec.ts",
        "TODO.md"
      ],
      "test_record": "风险分级：中；\`npm run lint\` 通过；\`npm run test:unit\` 通过（85/85）；\`npm run test:integration\` 通过（67/67）；\`npx playwright test e2e/specs/yearly-summary.spec.ts --project=chromium --retries=0\` 首次失败（worktree 缺少 \`.env.e2e\`），从主工作区复制 \`.env.e2e\` 后重跑通过（2/2）；未执行全量 \`npm run test:e2e\`（本任务未命中全量门禁）",
      "done_record": "2026-02-17 / a65b0c4",
      "source": {
        "file": "TODO.md",
        "line": 192
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_0f158555aa5d632b7917",
      "display_id": "TD-UI-061",
      "id_prefix": "UI",
      "module_key": "6.8",
      "module_name": "UI 体验优化",
      "module_label": "6.8 UI 体验优化",
      "order": 139,
      "status": "DONE",
      "title": "统一设置页按钮风格并将统计页刷新改为仅图标按钮",
      "acceptance": "设置页提交按钮采用深灰主按钮、导入导出采用次级按钮并与 pull/push 视觉一致；统计页刷新按钮仅显示图标且加载时旋转反馈；不回退现有交互与可访问性",
      "related_files": [
        "src/index.css",
        "src/components/auth/auth-panel.tsx",
        "src/components/common/import-data-panel.tsx",
        "src/components/common/export-data-panel.tsx",
        "src/pages/insights.tsx",
        "TODO.md"
      ],
      "test_record": "风险分级：中；\`npm run lint\` 通过；\`npm run test:unit\` 通过（85/85）；\`npm run test:integration\` 通过（67/67）；\`npx playwright test e2e/specs/settings-update.spec.ts e2e/specs/import.spec.ts e2e/specs/export-data.spec.ts e2e/specs/stats-insights.spec.ts --project=chromium --retries=0 --workers=1\` 首次失败（\`export-data\` 无数据场景偶发检测到下载），同命令重跑通过（6/6）；未执行全量 \`npm run test:e2e\`（本任务未命中全量门禁）",
      "done_record": "2026-02-17 / df7432d",
      "source": {
        "file": "TODO.md",
        "line": 193
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_b6a2df9a25f3d23a2022",
      "display_id": "TD-UI-062",
      "id_prefix": "UI",
      "module_key": "6.8",
      "module_name": "UI 体验优化",
      "module_label": "6.8 UI 体验优化",
      "order": 140,
      "status": "DONE",
      "title": "将设置页主标题区改为与数据统计页同款 header 结构",
      "acceptance": "设置页顶部标题不再使用 \`td-settings-hero\` 渐变卡片；主标题采用与数据统计页一致的 header 布局与样式语义；页面功能与测试链路不回退",
      "related_files": [
        "src/pages/settings.tsx",
        "src/index.css",
        "TODO.md"
      ],
      "test_record": "风险分级：中；\`npm run lint\` 通过；\`npm run test:unit\` 通过（85/85）；\`npm run test:integration\` 通过（67/67）；\`npx playwright test e2e/specs/settings-update.spec.ts --project=chromium --retries=0\` 通过（2/2）；未执行全量 \`npm run test:e2e\`（本任务未命中全量门禁）",
      "done_record": "2026-02-17 / 015e066",
      "source": {
        "file": "TODO.md",
        "line": 194
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_20f6c57450e7f546f212",
      "display_id": "TD-UI-063",
      "id_prefix": "UI",
      "module_key": "6.8",
      "module_name": "UI 体验优化",
      "module_label": "6.8 UI 体验优化",
      "order": 141,
      "status": "DONE",
      "title": "设置页文案精简与统计页刷新图标修正（同步设置命名 + 去括号标签 + SVG 图标）",
      "acceptance": "设置页“连接设置”改为“同步设置”；设置项标签去除括号补充说明（如“新 Token（可选）/主密码（仅更新 Token 时需要）”）；统计页刷新按钮改为标准 SVG 图标并保持交互不回退",
      "related_files": [
        "src/pages/settings.tsx",
        "src/components/auth/auth-panel.tsx",
        "src/pages/insights.tsx",
        "TODO.md"
      ],
      "test_record": "风险分级：中；\`npm run lint\` 通过；\`npm run test:unit\` 通过（85/85）；\`npm run test:integration\` 通过（67/67）；\`npx playwright test e2e/specs/settings-update.spec.ts e2e/specs/stats-insights.spec.ts --project=chromium --retries=0 --workers=1\` 通过（3/3）；未执行全量 \`npm run test:e2e\`（本任务未命中全量门禁）",
      "done_record": "2026-02-17 / 05b63ef",
      "source": {
        "file": "TODO.md",
        "line": 195
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_31892fad4cb965703c23",
      "display_id": "TD-UI-064",
      "id_prefix": "UI",
      "module_key": "6.8",
      "module_name": "UI 体验优化",
      "module_label": "6.8 UI 体验优化",
      "order": 142,
      "status": "DONE",
      "title": "年度总结页二次精简：年份改为点击弹层选择、删除静态描述文案、年度概览对齐日记统计风格、右侧仅保留编辑框并将源码/字数下置",
      "acceptance": "点击年份可弹出年份选择层并确认跳转；页面不再出现静态描述性语句；年度概览卡字号与层级向日记统计栏看齐；右侧去除“本年度内容”等冗余头部，仅保留编辑器与底部源码/字数",
      "related_files": [
        "src/pages/yearly-summary.tsx",
        "src/components/yearly/yearly-quick-stats.tsx",
        "src/components/yearly/yearly-toc.tsx",
        "src/components/editor/markdown-editor.tsx",
        "src/components/editor/markdown-editor.css",
        "src/__tests__/integration/editor.integration.test.tsx",
        "src/__tests__/integration/markdown-editor.integration.test.tsx",
        "e2e/specs/yearly-summary.spec.ts",
        "TODO.md"
      ],
      "test_record": "风险分级：中；\`npm run lint\` 通过；\`npm run test:unit\` 通过（85/85）；\`npm run test:integration\` 通过（68/68）；\`npx playwright test e2e/specs/yearly-summary.spec.ts --project=chromium --retries=0\` 首次失败（worktree 缺少 \`.env.e2e\`）；执行 \`bash /home/ljcwsl/.codex/skills/main-worktree-flow/scripts/worktree-flow.sh fix-e2e-env --branch plan/yearly-summary-copy-trim --repo /home/ljcwsl/0-code/TraceDiary --worktree /home/ljcwsl/0-code/TraceDiary-wt-plan_yearly-summary-copy-trim --e2e-cmd \\\\\\"npx playwright test e2e/specs/yearly-summary.spec.ts --project=chromium --retries=0\\\\\\"\` 后重跑通过（2/2）；未执行全量 \`npm run test:e2e\`（本任务未命中全量门禁）",
      "done_record": "2026-02-17 / e7e5fd4",
      "source": {
        "file": "TODO.md",
        "line": 196
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_a1a82b61da77cb46491f",
      "display_id": "TD-UI-065",
      "id_prefix": "UI",
      "module_key": "6.8",
      "module_name": "UI 体验优化",
      "module_label": "6.8 UI 体验优化",
      "order": 143,
      "status": "DONE",
      "title": "年度总结页将底部“源码”按钮右移，与字数并排聚合在右下角",
      "acceptance": "年度总结页编辑区底部工具条右侧同时显示“字数”和“源码”；源码按钮不再位于左下角；源码切换与字数显示行为不回退",
      "related_files": [
        "src/components/editor/markdown-editor.tsx",
        "src/__tests__/integration/markdown-editor.integration.test.tsx",
        "TODO.md"
      ],
      "test_record": "风险分级：中；\`npm run lint\` 通过；\`npm run test:unit\` 通过（85/85）；\`npm run test:integration\` 通过（68/68）；\`npx playwright test e2e/specs/yearly-summary.spec.ts --project=chromium --retries=0\` 通过（2/2）；未执行全量 \`npm run test:e2e\`（本任务未命中全量门禁）",
      "done_record": "2026-02-17 / ac892bb",
      "source": {
        "file": "TODO.md",
        "line": 197
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_175795e0c005eb31fd54",
      "display_id": "TD-UI-066",
      "id_prefix": "UI",
      "module_key": "6.8",
      "module_name": "UI 体验优化",
      "module_label": "6.8 UI 体验优化",
      "order": 144,
      "status": "DONE",
      "title": "统一日记页与年度总结页“源码/字数”气泡样式（高度、底色、边框一致）",
      "acceptance": "日记页与年度总结页中“源码”按钮和“字数”气泡高度一致、颜色一致；源码切换与字数统计行为不回退",
      "related_files": [
        "src/components/editor/markdown-editor.tsx",
        "src/__tests__/integration/markdown-editor.integration.test.tsx",
        "e2e/specs/daily-edit.spec.ts",
        "e2e/specs/yearly-summary.spec.ts",
        "TODO.md"
      ],
      "test_record": "风险分级：中；\`npm run lint\` 通过；\`npm run test:unit\` 通过（85/85）；\`npm run test:integration\` 通过（68/68）；\`npx playwright test e2e/specs/daily-edit.spec.ts e2e/specs/yearly-summary.spec.ts --project=chromium --retries=0\` 通过（3/3）；未执行全量 \`npm run test:e2e\`（本任务未命中全量门禁）",
      "done_record": "2026-02-17 / bd534ca",
      "source": {
        "file": "TODO.md",
        "line": 198
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_57a042d6050cad472d66",
      "display_id": "TD-UI-067",
      "id_prefix": "UI",
      "module_key": "6.8",
      "module_name": "UI 体验优化",
      "module_label": "6.8 UI 体验优化",
      "order": 145,
      "status": "DONE",
      "title": "调整编辑器“源码”按钮激活态颜色，与 push 按钮主色保持一致",
      "acceptance": "点击“源码”进入激活态后颜色应与 push 按钮一致（含 hover 态）；日记页与年度总结页表现一致；交互不回退",
      "related_files": [
        "src/components/editor/markdown-editor.tsx",
        "src/__tests__/integration/markdown-editor.integration.test.tsx",
        "e2e/specs/daily-edit.spec.ts",
        "e2e/specs/yearly-summary.spec.ts",
        "TODO.md"
      ],
      "test_record": "风险分级：中；\`npm run lint\` 通过；\`npm run test:unit\` 通过（85/85）；\`npm run test:integration\` 通过（68/68）；\`npx playwright test e2e/specs/daily-edit.spec.ts e2e/specs/yearly-summary.spec.ts --project=chromium --retries=0\` 通过（3/3）；未执行全量 \`npm run test:e2e\`（本任务未命中全量门禁）",
      "done_record": "2026-02-17 / fb11a2f",
      "source": {
        "file": "TODO.md",
        "line": 199
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_abab92dbe62d39728cee",
      "display_id": "TD-UI-068",
      "id_prefix": "UI",
      "module_key": "6.8",
      "module_name": "UI 体验优化",
      "module_label": "6.8 UI 体验优化",
      "order": 146,
      "status": "DONE",
      "title": "修复日记与年度总结页默认可视化编辑偶发不可输入（需点“源码”后才可编辑）问题",
      "acceptance": "页面初次进入即为可视化可编辑；点击“源码”可见并可编辑 Markdown；两种模式切换不丢内容且落库正常",
      "related_files": [
        "src/components/editor/markdown-editor.tsx",
        "src/__tests__/integration/markdown-editor.integration.test.tsx",
        "e2e/specs/daily-edit.spec.ts",
        "e2e/specs/yearly-summary.spec.ts",
        "TODO.md"
      ],
      "test_record": "风险分级：中；\`npm run lint\` 通过；\`npm run test:unit\` 通过（85/85）；\`npm run test:integration\` 通过（68/68）；\`npx playwright test e2e/specs/daily-edit.spec.ts e2e/specs/yearly-summary.spec.ts e2e/specs/manual-sync-success.spec.ts --project=chromium --retries=0\` 通过（4/4）；未执行全量 \`npm run test:e2e\`（本任务未命中全量门禁，已执行与改动直接相关目标 E2E）",
      "done_record": "2026-02-17 / 16cd385",
      "source": {
        "file": "TODO.md",
        "line": 200
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_a9d50e8f3c93a3d77903",
      "display_id": "TD-UI-069",
      "id_prefix": "UI",
      "module_key": "6.8",
      "module_name": "UI 体验优化",
      "module_label": "6.8 UI 体验优化",
      "order": 147,
      "status": "DONE",
      "title": "修复源码按钮激活态离开悬停后丢失底色（默认/激活样式互斥）",
      "acceptance": "点击“源码”后在非悬停状态仍保持 push 同色激活背景；日记页与年度总结页一致；源码切换与字数统计不回退",
      "related_files": [
        "src/components/editor/markdown-editor.tsx",
        "src/__tests__/integration/markdown-editor.integration.test.tsx",
        "e2e/specs/daily-edit.spec.ts",
        "e2e/specs/yearly-summary.spec.ts",
        "TODO.md"
      ],
      "test_record": "风险分级：中；\`npm run lint\` 通过；\`npm run test:unit\` 通过（85/85）；\`npm run test:integration\` 通过（68/68）；\`npx playwright test e2e/specs/daily-edit.spec.ts e2e/specs/yearly-summary.spec.ts --project=chromium --retries=0\` 通过（3/3）；未执行全量 \`npm run test:e2e\`（本任务未命中全量门禁）",
      "done_record": "2026-02-17 / 1735102",
      "source": {
        "file": "TODO.md",
        "line": 201
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_3d5c590df54256b0698f",
      "display_id": "TD-UI-070",
      "id_prefix": "UI",
      "module_key": "6.8",
      "module_name": "UI 体验优化",
      "module_label": "6.8 UI 体验优化",
      "order": 148,
      "status": "DONE",
      "title": "年度总结页目录仅显示一级标题（H1）",
      "acceptance": "左侧目录只展示 \`#\` 一级标题；\`##/###\` 不进入目录；目录点击与滚动高亮行为保持可用",
      "related_files": [
        "src/utils/markdown-toc.ts",
        "src/pages/yearly-summary.tsx",
        "src/__tests__/unit/markdown-toc.unit.test.ts",
        "TODO.md"
      ],
      "test_record": "风险分级：中；\`npm run lint\` 通过；\`npm run test:unit\` 通过（85/85）；\`npm run test:integration\` 通过（68/68）；\`npx playwright test e2e/specs/yearly-summary.spec.ts --project=chromium --retries=0\` 通过（2/2）；未执行全量 \`npm run test:e2e\`（本任务未命中全量门禁）",
      "done_record": "2026-02-17 / 029389f",
      "source": {
        "file": "TODO.md",
        "line": 202
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_a7ced15efd53eceebdae",
      "display_id": "TD-UI-071",
      "id_prefix": "UI",
      "module_key": "6.8",
      "module_name": "UI 体验优化",
      "module_label": "6.8 UI 体验优化",
      "order": 149,
      "status": "DONE",
      "title": "日记页将“字数+源码”并排置于顶部，顺序与年度总结页一致",
      "acceptance": "日记页顶部工具条显示“字数 + 源码”（字数在前）；不再在右下角浮动显示字数；年度总结页保持现状；源码切换和字数统计不回退",
      "related_files": [
        "src/components/editor/markdown-editor.tsx",
        "src/__tests__/integration/markdown-editor.integration.test.tsx",
        "e2e/specs/daily-edit.spec.ts",
        "e2e/specs/yearly-summary.spec.ts",
        "TODO.md"
      ],
      "test_record": "风险分级：中；\`npm run lint\` 通过；\`npm run test:unit\` 通过（85/85）；\`npm run test:integration\` 通过（68/68）；\`npx playwright test e2e/specs/daily-edit.spec.ts e2e/specs/yearly-summary.spec.ts --project=chromium --retries=0\` 通过（3/3）；未执行全量 \`npm run test:e2e\`（本任务未命中全量门禁）",
      "done_record": "2026-02-17 / 29348c0",
      "source": {
        "file": "TODO.md",
        "line": 203
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_c96636175522427faf60",
      "display_id": "TD-UI-072",
      "id_prefix": "UI",
      "module_key": "6.8",
      "module_name": "UI 体验优化",
      "module_label": "6.8 UI 体验优化",
      "order": 150,
      "status": "DONE",
      "title": "统一日记页与年度总结页编辑区宽度策略（采用日记页自适应宽度）",
      "acceptance": "年度总结页移除固定 \`max-w\` 限制并与日记页同宽度策略；编辑区内外框间隔保持当前 \`td-panel\` 风格；桌面与移动端自适应正常",
      "related_files": [
        "src/pages/yearly-summary.tsx",
        "TODO.md"
      ],
      "test_record": "风险分级：中；\`npm run lint\` 通过；\`npm run test:unit\` 通过（85/85）；\`npm run test:integration\` 通过（68/68）；\`npx playwright test e2e/specs/daily-edit.spec.ts e2e/specs/yearly-summary.spec.ts --project=chromium --retries=0\` 通过（3/3）；未执行全量 \`npm run test:e2e\`（本任务未命中全量门禁）",
      "done_record": "2026-02-17 / 19cebfc",
      "source": {
        "file": "TODO.md",
        "line": 204
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_7763ad50b26aa18e157b",
      "display_id": "TD-UI-073",
      "id_prefix": "UI",
      "module_key": "6.8",
      "module_name": "UI 体验优化",
      "module_label": "6.8 UI 体验优化",
      "order": 151,
      "status": "DONE",
      "title": "将站点图标替换为用户提供的 SVG 图标",
      "acceptance": "浏览器页签图标与 PWA manifest 图标入口均指向新 SVG；构建与基础测试通过",
      "related_files": [
        "public/icons/icon.svg",
        "public/icons/icon-192.png",
        "public/icons/icon-512.png",
        "index.html",
        "public/manifest.json",
        "TODO.md"
      ],
      "test_record": "风险分级：中；\`npm run lint\` 通过；\`npm run test:unit\` 通过（86/86）；\`npm run test:integration\` 通过（68/68，含既有 \`act(...)\` 警告）；\`npm run test:e2e:fast\` 通过（5/5）；未执行全量 \`npm run test:e2e:full\`（本任务未命中全量门禁）",
      "done_record": "2026-02-18 / 18bfbc7",
      "source": {
        "file": "TODO.md",
        "line": 205
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_996c6cf23b9ff2c4a3dc",
      "display_id": "TD-UI-074",
      "id_prefix": "UI",
      "module_key": "6.8",
      "module_name": "UI 体验优化",
      "module_label": "6.8 UI 体验优化",
      "order": 152,
      "status": "DONE",
      "title": "重设计站点图标以提升小尺寸可读性并替换现有图标资源",
      "acceptance": "16/24/32px 下轮廓可辨识；浏览器页签与 PWA 图标资源更新为新设计；构建与分层测试通过",
      "related_files": [
        "public/icons/icon.svg",
        "public/icons/icon-192.png",
        "public/icons/icon-512.png",
        "TODO.md"
      ],
      "test_record": "风险分级：中；\`npm run lint\` 通过；\`npm run test:unit\` 通过（86/86）；\`npm run test:integration\` 通过（68/68，含既有 \`act(...)\` 警告）；\`npm run test:e2e:fast\` 通过（5/5）；未执行全量 \`npm run test:e2e:full\`（本任务未命中全量门禁）",
      "done_record": "2026-02-18 / 4238c3b",
      "source": {
        "file": "TODO.md",
        "line": 206
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_562a00924641223e94ce",
      "display_id": "TD-UI-075",
      "id_prefix": "UI",
      "module_key": "6.8",
      "module_name": "UI 体验优化",
      "module_label": "6.8 UI 体验优化",
      "order": 153,
      "status": "DONE",
      "title": "修复统计页年度对比图与月度趋势图的轴标签被柱体遮挡问题，并补齐防回归测试",
      "acceptance": "年度对比图与月度趋势图左右轴标签不再被柱体覆盖；两图在不同数据量下无视觉遮挡；新增测试可稳定拦截同类回归",
      "related_files": [
        "src/components/stats/monthly-trend-chart.tsx",
        "src/components/stats/yearly-comparison-chart.tsx",
        "src/components/stats/chart-layout.ts",
        "src/__tests__/unit/chart-layout.unit.test.ts",
        "e2e/specs/stats-insights.spec.ts",
        "TODO.md"
      ],
      "test_record": "风险分级：中；\`npm run lint\` 通过；\`npm run test:unit\` 通过（89/89）；\`npm run test:integration\` 通过（68/68，含既有 \`act(...)\` 警告）；\`npx playwright test e2e/specs/stats-insights.spec.ts --project=chromium --retries=0\` 首次失败（worktree 缺少 \`.env.e2e\`），执行 \`bash /home/ljcwsl/.codex/skills/main-worktree-flow/scripts/worktree-flow.sh fix-e2e-env --branch plan/stats-chart-occlusion-fix --repo /home/ljcwsl/0-code/TraceDiary --worktree /home/ljcwsl/0-code/TraceDiary-wt-plan_stats-chart-occlusion-fix --e2e-cmd \\\\\\"npx playwright test e2e/specs/stats-insights.spec.ts --project=chromium --retries=0\\\\\\"\` 后重跑通过（1/1）",
      "done_record": "2026-02-18 / 12503db",
      "source": {
        "file": "TODO.md",
        "line": 207
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_b07efd2a32134c274334",
      "display_id": "TD-UI-076",
      "id_prefix": "UI",
      "module_key": "6.8",
      "module_name": "UI 体验优化",
      "module_label": "6.8 UI 体验优化",
      "order": 154,
      "status": "DONE",
      "title": "以当前 SVG 为准重生成图标 PNG，并收紧 SVG 四周留白",
      "acceptance": "\`icon-192.png\` 与 \`icon-512.png\` 均由最新 \`icon.svg\` 导出；SVG 视觉留白明显收紧且主图形更贴近画布边缘",
      "related_files": [
        "public/icons/icon.svg",
        "public/icons/icon-192.png",
        "public/icons/icon-512.png",
        "TODO.md"
      ],
      "test_record": "风险分级：中；\`npm run lint\` 通过；\`npm run test:unit\` 通过（179/179）；\`npm run test:integration\` 失败（\`src/__tests__/integration/app.integration.test.tsx\` 2 例失败，属于当前分支既有“演示模式”改动冲突，非本任务图标改动导致）；用户明确授权“不要继续测试，直接提交”，因此未继续修复失败用例，且未执行 \`npm run test:e2e:fast\` / \`npm run test:e2e:full\`",
      "done_record": "2026-02-18 / c89fe86",
      "source": {
        "file": "TODO.md",
        "line": 208
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_e01f57f70da75ebcd3d9",
      "display_id": "TD-UI-077",
      "id_prefix": "UI",
      "module_key": "6.8",
      "module_name": "UI 体验优化",
      "module_label": "6.8 UI 体验优化",
      "order": 155,
      "status": "DONE",
      "title": "修复日记内容清空后仍被判定为“有内容”并在日历继续打点的问题",
      "acceptance": "当某日内容清空（含仅空白字符）后，该日期不应被视为“有内容”，月历不再显示记录点",
      "related_files": [
        "src/pages/diary.tsx",
        "e2e/specs/calendar-history.spec.ts",
        "TODO.md"
      ],
      "test_record": "风险分级：中；\`npm run lint\` 通过；\`npm run test:unit\` 通过（92/92）；\`npm run test:integration\` 通过（71/71，含既有 \`act(...)\` 警告）；\`npx playwright test e2e/specs/calendar-history.spec.ts --project=chromium --retries=0\` 首次失败（缺少 \`.env.e2e\`），补齐后重跑因 \`4173\` 端口被旧 worktree 占用导致访问 \`404\`，释放端口后再次重跑通过（2/2）；未执行全量 \`npm run test:e2e:full\`（本任务未命中全量门禁）",
      "done_record": "2026-02-19 / e0467f6",
      "source": {
        "file": "TODO.md",
        "line": 209
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_bf9db0dca439a00ab2bf",
      "display_id": "TD-IMP-001",
      "id_prefix": "IMP",
      "module_key": "6.9",
      "module_name": "数据导入（v1.1）",
      "module_label": "6.9 数据导入（v1.1）",
      "order": 156,
      "status": "DONE",
      "title": "实现 md/txt 文件名解析器（\`YYYY-MM-DD\` 与 \`YYYY-summary\`）",
      "acceptance": "可正确识别 \`daily\`/\`yearly_summary\` 并产出结构化结果",
      "related_files": [
        "src/services/import.ts",
        "src/types/diary.ts"
      ],
      "test_record": "风险分级：高；\`npm run lint\` 通过；\`npm run test:unit\` 通过（67/67）；\`npm run test:integration\` 通过（64/64）；\`npx playwright test e2e/specs/import.spec.ts --project=chromium --retries=0\` 首次失败（缺少 \`.env.e2e\`）；执行 \`bash /home/ljcwsl/.codex/skills/main-worktree-flow/scripts/worktree-flow.sh fix-e2e-env --branch plan/import-auto-batch-push --repo /home/ljcwsl/0-code/TraceDiary --worktree /home/ljcwsl/0-code/TraceDiary-wt-plan_import-auto-batch-push --e2e-cmd \\\\\\"npx playwright test e2e/specs/import.spec.ts --project=chromium --retries=0\\\\\\"\` 后重跑通过（1/1）",
      "done_record": "2026-02-15 / 8bf65d2",
      "source": {
        "file": "TODO.md",
        "line": 215
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_f21b1a4a99176420fa11",
      "display_id": "TD-IMP-002",
      "id_prefix": "IMP",
      "module_key": "6.9",
      "module_name": "数据导入（v1.1）",
      "module_label": "6.9 数据导入（v1.1）",
      "order": 157,
      "status": "DONE",
      "title": "实现批量导入预检（有效/冲突/无效分类）",
      "acceptance": "导入前能输出三类列表，错误文件可定位",
      "related_files": [
        "src/services/import.ts",
        "src/pages/diary.tsx"
      ],
      "test_record": "风险分级：高；同 \`TD-IMP-001\` 测试集全部通过",
      "done_record": "2026-02-15 / 8bf65d2",
      "source": {
        "file": "TODO.md",
        "line": 216
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_11c40cbd2f271b163416",
      "display_id": "TD-IMP-003",
      "id_prefix": "IMP",
      "module_key": "6.9",
      "module_name": "数据导入（v1.1）",
      "module_label": "6.9 数据导入（v1.1）",
      "order": 158,
      "status": "DONE",
      "title": "实现冲突逐条确认（覆盖/跳过）写入流程",
      "acceptance": "同日期/同年份冲突可逐条决策并正确落库",
      "related_files": [
        "src/components/common/import-conflict-dialog.tsx",
        "src/pages/diary.tsx"
      ],
      "test_record": "风险分级：高；同 \`TD-IMP-001\` 测试集全部通过",
      "done_record": "2026-02-15 / 8bf65d2",
      "source": {
        "file": "TODO.md",
        "line": 217
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_111b1e042d3ed80280f9",
      "display_id": "TD-IMP-004",
      "id_prefix": "IMP",
      "module_key": "6.9",
      "module_name": "数据导入（v1.1）",
      "module_label": "6.9 数据导入（v1.1）",
      "order": 159,
      "status": "DONE",
      "title": "实现导入结果汇总反馈（成功/跳过/失败）",
      "acceptance": "完成后可查看汇总统计与失败明细",
      "related_files": [
        "src/components/common/import-result-dialog.tsx",
        "src/pages/diary.tsx"
      ],
      "test_record": "风险分级：高；同 \`TD-IMP-001\` 测试集全部通过",
      "done_record": "2026-02-15 / 8bf65d2",
      "source": {
        "file": "TODO.md",
        "line": 218
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_6bf6dfa89a6f88e0cd92",
      "display_id": "TD-IMP-005",
      "id_prefix": "IMP",
      "module_key": "6.9",
      "module_name": "数据导入（v1.1）",
      "module_label": "6.9 数据导入（v1.1）",
      "order": 160,
      "status": "DONE",
      "title": "补齐导入单元/集成/E2E 测试",
      "acceptance": "覆盖命名识别、冲突处理、异常跳过、部分失败容错",
      "related_files": [
        "src/services/__tests__/import.test.ts",
        "src/services/__tests__/import-sync.test.ts",
        "src/__tests__/integration/import.integration.test.tsx",
        "e2e/specs/import.spec.ts"
      ],
      "test_record": "风险分级：高；同 \`TD-IMP-001\` 测试集全部通过",
      "done_record": "2026-02-15 / 8bf65d2",
      "source": {
        "file": "TODO.md",
        "line": 219
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_e1fb7a0cf80018cb10e3",
      "display_id": "TD-EXP-001",
      "id_prefix": "EXP",
      "module_key": "6.12",
      "module_name": "数据导出（v1.1）",
      "module_label": "6.12 数据导出（v1.1）",
      "order": 161,
      "status": "DONE",
      "title": "实现设置页明文导出入口与 ZIP 导出流程（含 manifest）并补齐分层测试",
      "acceptance": "设置页可触发明文导出并下载 \`trace-diary-export-YYYYMMDD-HHmmss.zip\`；产物包含 \`diaries/*.md\`、\`summaries/*-summary.md\` 与 \`manifest.json\`；未解锁/无数据/部分失败反馈符合 SPEC 4.8；导出过程不触发 Push/Pull",
      "related_files": [
        "src/pages/settings.tsx",
        "src/components/common/export-data-panel.tsx",
        "src/services/export.ts",
        "src/types/export.ts",
        "src/index.css",
        "src/services/__tests__/export.test.ts",
        "src/__tests__/integration/export.integration.test.tsx",
        "e2e/specs/export-data.spec.ts",
        "package.json",
        "package-lock.json",
        "TODO.md"
      ],
      "test_record": "风险分级：中；\`npm run lint\` 通过；\`npm run test:unit\` 通过（63/63）；\`npm run test:integration\` 通过（65/65）；\`npx playwright test e2e/specs/export-data.spec.ts --project=chromium --retries=0\` 首次失败（worktree 缺少 \`.env.e2e\`）；执行 \`bash /home/ljcwsl/.codex/skills/main-worktree-flow/scripts/worktree-flow.sh fix-e2e-env --branch plan/export-settings-only --repo /home/ljcwsl/0-code/TraceDiary --worktree /home/ljcwsl/0-code/TraceDiary-wt-plan_export-settings-only --e2e-cmd \\\\\\"npx playwright test e2e/specs/export-data.spec.ts --project=chromium --retries=0\\\\\\"\` 后重跑通过（2/2）；未执行全量 \`npm run test:e2e\`（本任务未命中全量门禁，已执行与改动直接相关目标 E2E）",
      "done_record": "2026-02-15 / 961dbee",
      "source": {
        "file": "TODO.md",
        "line": 225
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_897573f518437609c7f0",
      "display_id": "TD-DOC-001",
      "id_prefix": "DOC",
      "module_key": "6.10",
      "module_name": "文档维护",
      "module_label": "6.10 文档维护",
      "order": 162,
      "status": "DONE",
      "title": "补充导入功能规格与 TODO 拆解（md/txt 文件名识别 + 系统自动生成 metadata）",
      "acceptance": "\`SPEC.md\` 明确导入输入格式、识别规则、冲突策略、验收标准；\`TODO.md\` 新增导入任务组",
      "related_files": [
        "SPEC.md",
        "TODO.md"
      ],
      "test_record": "\`npm run test:unit\` 通过（35/35）；\`npm run test:integration\` 通过（28/28）；\`npm run test:e2e\` 通过（冒烟）",
      "done_record": "2026-02-09 / 05c0fb7",
      "source": {
        "file": "TODO.md",
        "line": 231
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_e036432f7c9cccef95c1",
      "display_id": "TD-DOC-002",
      "id_prefix": "DOC",
      "module_key": "6.10",
      "module_name": "文档维护",
      "module_label": "6.10 文档维护",
      "order": 163,
      "status": "DONE",
      "title": "在 AGENTS 增加“大工作量任务默认并行多 agents 执行”规范",
      "acceptance": "\`AGENTS.md\` 明确要求 AI 对重任务主动采用并行多 agents，不依赖用户显式指定",
      "related_files": [
        "AGENTS.md",
        "TODO.md"
      ],
      "test_record": "\`npm run test:unit\` 通过（42/42）；\`npm run test:integration\` 通过（35/35）；\`npm run test:e2e\` 通过（14 passed，3 flaky 重试通过）",
      "done_record": "2026-02-09 / 6c99c2c",
      "source": {
        "file": "TODO.md",
        "line": 232
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_40910f814273d1927097",
      "display_id": "TD-DOC-003",
      "id_prefix": "DOC",
      "module_key": "6.10",
      "module_name": "文档维护",
      "module_label": "6.10 文档维护",
      "order": 164,
      "status": "DONE",
      "title": "在 AGENTS 增加“用户明确授权时可采用必要测试策略”的执行规范",
      "acceptance": "AGENTS 明确必要测试策略的触发条件、最小测试集合、结果披露要求；不影响默认完整测试红线",
      "related_files": [
        "AGENTS.md",
        "TODO.md"
      ],
      "test_record": "仅文档改动，无功能行为变化；未执行单元/集成/E2E",
      "done_record": "2026-02-10 / a72056b",
      "source": {
        "file": "TODO.md",
        "line": 233
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_8167abb44456296de623",
      "display_id": "TD-DOC-004",
      "id_prefix": "DOC",
      "module_key": "6.10",
      "module_name": "文档维护",
      "module_label": "6.10 文档维护",
      "order": 165,
      "status": "DONE",
      "title": "更新 SPEC 同步策略为“仅手动 pull/push”，并移除自动上传相关 E2E 用例",
      "acceptance": "\`SPEC.md\` 明确不再自动上传；仅保留手动 push 与手动/解锁触发 pull 的描述；自动上传专属 E2E 用例已移除",
      "related_files": [
        "SPEC.md",
        "e2e/specs/auto-sync-last-synced.spec.ts",
        "TODO.md"
      ],
      "test_record": "\`npm run lint\` 通过；\`npm run test:unit\` 通过（51/51）；\`npm run test:integration\` 通过（45/45）；\`npx playwright test e2e/specs/manual-sync-success.spec.ts e2e/specs/remote-pull-sync.spec.ts --project=chromium --retries=0\` 通过（2/2）；\`npx playwright test --list --project=chromium\` 显示总计 \`20 tests in 13 files\`（已移除自动上传专属 E2E）",
      "done_record": "2026-02-11 / 5afde94",
      "source": {
        "file": "TODO.md",
        "line": 234
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_23799562c2de99892338",
      "display_id": "TD-DOC-005",
      "id_prefix": "DOC",
      "module_key": "6.10",
      "module_name": "文档维护",
      "module_label": "6.10 文档维护",
      "order": 166,
      "status": "DONE",
      "title": "在 AGENTS 增加“接任务后先重命名 tmux pane”的执行规范",
      "acceptance": "\`AGENTS.md\` 明确要求每次接收任务先查看 pane 编号，再按任务语义重命名 pane，且提供命令示例",
      "related_files": [
        "AGENTS.md",
        "TODO.md"
      ],
      "test_record": "\`npm run lint\` 通过；仅文档改动，无功能行为变化，未执行 \`npm run test:unit\` / \`npm run test:integration\` / E2E",
      "done_record": "2026-02-12 / b5ac147",
      "source": {
        "file": "TODO.md",
        "line": 235
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_4bf50424dd56b8cdf108",
      "display_id": "TD-DOC-006",
      "id_prefix": "DOC",
      "module_key": "6.10",
      "module_name": "文档维护",
      "module_label": "6.10 文档维护",
      "order": 167,
      "status": "DONE",
      "title": "在 AGENTS 补充 pane 定位与复用规范（\`pane_index\`、\`session/window\`、同任务不重复改名）",
      "acceptance": "AGENTS 明确使用 \`pane_index\`（纯数字）而非 \`%pane_id\`；重命名命令必须显式绑定 \`session:window.pane_index\`；同一任务连续微调无需重复改名，仅任务语义切换时改名",
      "related_files": [
        "AGENTS.md",
        "TODO.md"
      ],
      "test_record": "\`npm run lint\` 通过；仅文档改动，无功能行为变化，未执行单元/集成/E2E",
      "done_record": "2026-02-13 / 2700d07",
      "source": {
        "file": "TODO.md",
        "line": 236
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_34aab1ab8be6d206e3c6",
      "display_id": "TD-DOC-007",
      "id_prefix": "DOC",
      "module_key": "6.10",
      "module_name": "文档维护",
      "module_label": "6.10 文档维护",
      "order": 168,
      "status": "DONE",
      "title": "压缩 AGENTS 的 pane 重命名说明并改为基于 \`TMUX_PANE\` 定位当前 Codex pane",
      "acceptance": "AGENTS 第 3 节以最少步骤明确：通过 \`TMUX_PANE\` 反查 \`session:window.pane_index\` 后重命名并回读；禁止用不带 \`-t\` 的 \`#S:#I.#P\` 判定当前 pane",
      "related_files": [
        "AGENTS.md",
        "TODO.md"
      ],
      "test_record": "风险分级：低（仅文档）；\`npm run lint\` 通过；仅文档改动，无功能行为变化，未执行单元/集成/E2E",
      "done_record": "2026-02-14 / 9d87dea",
      "source": {
        "file": "TODO.md",
        "line": 237
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_2fbec8b98f075359963a",
      "display_id": "TD-DOC-008",
      "id_prefix": "DOC",
      "module_key": "6.10",
      "module_name": "文档维护",
      "module_label": "6.10 文档维护",
      "order": 169,
      "status": "DONE",
      "title": "调整 AGENTS 测试策略：仅文档改动可不执行任何测试（含 lint）",
      "acceptance": "AGENTS 明确“仅文档改动且无功能行为变化”时可不执行自动化测试；相关条目无互相冲突描述",
      "related_files": [
        "AGENTS.md",
        "TODO.md"
      ],
      "test_record": "风险分级：低（仅文档）；按用户授权本任务未执行自动化测试（\`lint/unit/integration/E2E\`）",
      "done_record": "2026-02-14 / 4f1280e",
      "source": {
        "file": "TODO.md",
        "line": 238
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_fd31c56326707251234d",
      "display_id": "TD-DOC-009",
      "id_prefix": "DOC",
      "module_key": "6.10",
      "module_name": "文档维护",
      "module_label": "6.10 文档维护",
      "order": 170,
      "status": "DONE",
      "title": "新增“游客模式 + 登录注册 + 免费部署”任务拆分清单",
      "acceptance": "\`TODO.md\` 新增可执行拆分（含游客模式、账号体系、云端配置、测试验收），并明确免费方案边界与验收标准",
      "related_files": [
        "TODO.md"
      ],
      "test_record": "风险分级：低（仅文档）；仅文档改动，无功能行为变化，未执行自动化测试（\`lint/unit/integration/E2E\`）",
      "done_record": "2026-02-18 / 1e57198",
      "source": {
        "file": "TODO.md",
        "line": 239
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_d9e3704fafa9469cc759",
      "display_id": "TD-DOC-010",
      "id_prefix": "DOC",
      "module_key": "6.10",
      "module_name": "文档维护",
      "module_label": "6.10 文档维护",
      "order": 171,
      "status": "DOING",
      "title": "调整 AGENTS 任务流程（移除 tmux pane 强制）并制定并行多 agent 的 TODO 冲突治理规则",
      "acceptance": "\`AGENTS.md\` 不再要求接任务先改 tmux pane；新增并行场景下 TODO 冲突规避与回填流程（主 agent 串行写入、子 agent 仅回传状态）",
      "related_files": [
        "AGENTS.md",
        "TODO.md"
      ],
      "test_record": "",
      "done_record": "",
      "source": {
        "file": "TODO.md",
        "line": 240
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_29654c73267cd8968130",
      "display_id": "TD-DEV-001",
      "id_prefix": "DEV",
      "module_key": "6.11",
      "module_name": "开发效率与工具",
      "module_label": "6.11 开发效率与工具",
      "order": 172,
      "status": "DONE",
      "title": "新增 WezTerm + tmux 四窗格 Codex 启动脚本（默认命名且支持后续手动重命名）",
      "acceptance": "一条命令可创建/附着 \`2x2\` 四窗格并在每个 pane 启动 \`codex\`；初始 pane 名称可见；可通过 \`tmux select-pane -T\` 手动改名",
      "related_files": [
        "scripts/start-codex4.sh",
        "docs/codex-parallel.md",
        "TODO.md"
      ],
      "test_record": "\`bash -n scripts/start-codex4.sh\` 通过；\`npm run lint\` 通过；\`npm run test:unit\` 通过（58/58）；用户明确要求“这个就不用测试了”，未继续执行 \`npm run test:integration\` 与 E2E",
      "done_record": "2026-02-12 / 0fb306a",
      "source": {
        "file": "TODO.md",
        "line": 246
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_1179699f95ef69d3c952",
      "display_id": "TD-AUTH-001",
      "id_prefix": "AUTH",
      "module_key": "6.13",
      "module_name": "游客模式与账号体系（v1.2）",
      "module_label": "6.13 游客模式与账号体系（v1.2）",
      "order": 173,
      "status": "DONE",
      "title": "接入 Supabase 客户端与会话上下文（仅使用 \`anon key\`）",
      "acceptance": "前端可初始化 Supabase client；会话状态可在全局读取；禁止将 \`service_role\` 暴露到前端",
      "related_files": [
        "src/main.tsx",
        "src/hooks/*",
        "src/services/*",
        "README.md"
      ],
      "test_record": "风险分级：高；\`npm run lint\` 通过；\`npm run test:unit\` 通过（86/86）；\`npm run test:integration\` 通过（68/68，含既有 \`act(...)\` 警告）；\`npm run test:e2e:full\` 首次失败（缺少 \`.env.e2e\`），从主工作区复制 \`.env.e2e\` 后重跑通过（28/28，含 2 项 flaky 经 retry 通过）；定向 \`npx playwright test --project=chromium e2e/specs/export-data.spec.ts e2e/specs/upload-encryption.spec.ts --workers=2 --retries=1\` 通过（3/3）",
      "done_record": "2026-02-18 / a302c23",
      "source": {
        "file": "TODO.md",
        "line": 252
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_04aea2b157da4850f26b",
      "display_id": "TD-AUTH-002",
      "id_prefix": "AUTH",
      "module_key": "6.13",
      "module_name": "游客模式与账号体系（v1.2）",
      "module_label": "6.13 游客模式与账号体系（v1.2）",
      "order": 174,
      "status": "DONE",
      "title": "实现邮箱 OTP 登录/注册一体化入口",
      "acceptance": "用户输入邮箱后可接收验证码并登录；未注册邮箱可按配置自动注册；登录失败有可读错误反馈",
      "related_files": [
        "src/App.tsx",
        "src/components/auth/entry-auth-modal.tsx",
        "src/components/common/app-header.tsx",
        "src/pages/diary.tsx",
        "src/pages/yearly-summary.tsx",
        "src/pages/insights.tsx",
        "src/pages/settings.tsx",
        "src/services/supabase.ts",
        "src/__tests__/integration/app.integration.test.tsx"
      ],
      "test_record": "风险分级：高；\`npm run lint\` 通过；\`npm run test:unit\` 通过（92/92）；\`npm run test:integration\` 通过（71/71，含既有 \`act(...)\` 警告）；\`npm run test:e2e:full\` 通过（29 项执行，28 passed + 1 flaky 经 retry 通过）",
      "done_record": "2026-02-19 / 41c3864",
      "source": {
        "file": "TODO.md",
        "line": 253
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_6b1f80b5823877ce4483",
      "display_id": "TD-AUTH-003",
      "id_prefix": "AUTH",
      "module_key": "6.13",
      "module_name": "游客模式与账号体系（v1.2）",
      "module_label": "6.13 游客模式与账号体系（v1.2）",
      "order": 175,
      "status": "DONE",
      "title": "新增默认游客模式入口与“开始使用我的数据”转化路径",
      "acceptance": "首次访问默认进入游客体验；游客态可浏览 Demo 日记但不可写入远端；可一键跳转登录/注册",
      "related_files": [
        "src/App.tsx",
        "src/components/auth/entry-auth-modal.tsx",
        "src/pages/settings.tsx",
        "src/__tests__/integration/app.integration.test.tsx",
        "e2e/fixtures/app.ts",
        "e2e/specs/export-data.spec.ts"
      ],
      "test_record": "风险分级：高；\`npm run lint\` 通过；\`npm run test:unit\` 通过（92/92）；\`npm run test:integration\` 通过（71/71，含既有 \`act(...)\` 警告）；\`npm run test:e2e:full\` 通过（29 项执行，27 passed + 2 flaky 经 retry 通过）",
      "done_record": "2026-02-19 / 6ce2dfd",
      "source": {
        "file": "TODO.md",
        "line": 254
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_1397bded28dcf2ed8210",
      "display_id": "TD-AUTH-004",
      "id_prefix": "AUTH",
      "module_key": "6.13",
      "module_name": "游客模式与账号体系（v1.2）",
      "module_label": "6.13 游客模式与账号体系（v1.2）",
      "order": 176,
      "status": "TODO",
      "title": "重构首次绑定流程：登录后再配置仓库与主密码",
      "acceptance": "登录用户在首次绑定时完成 Repo/Branch/Token + 主密码配置；已绑定用户跳过重复配置并直接进入解锁或使用",
      "related_files": [
        "src/hooks/use-auth.ts",
        "src/pages/settings.tsx",
        "src/components/auth/*"
      ],
      "test_record": "",
      "done_record": "",
      "source": {
        "file": "TODO.md",
        "line": 255
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_8b697daa07d57d655fc1",
      "display_id": "TD-CLOUD-001",
      "id_prefix": "CLOUD",
      "module_key": "6.14",
      "module_name": "云端配置存储与权限（v1.2）",
      "module_label": "6.14 云端配置存储与权限（v1.2）",
      "order": 177,
      "status": "TODO",
      "title": "建立 \`user_sync_configs\` 表与迁移脚本（存密文配置）",
      "acceptance": "表结构可存储 \`encryptedToken/kdfParams/tokenCipherVersion/giteeRepo*\`；迁移脚本可重复执行且幂等",
      "related_files": [
        "supabase/migrations/*",
        "src/types/config.ts",
        "docs/*"
      ],
      "test_record": "",
      "done_record": "",
      "source": {
        "file": "TODO.md",
        "line": 261
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_63bda426cb6c8a95dd9c",
      "display_id": "TD-CLOUD-002",
      "id_prefix": "CLOUD",
      "module_key": "6.14",
      "module_name": "云端配置存储与权限（v1.2）",
      "module_label": "6.14 云端配置存储与权限（v1.2）",
      "order": 178,
      "status": "TODO",
      "title": "配置并验证 RLS 策略（仅本人可读写）",
      "acceptance": "\`select/insert/update\` 均满足 \`auth.uid() = user_id\`；越权访问被拒绝",
      "related_files": [
        "supabase/migrations/*",
        "scripts/*",
        "src/services/*"
      ],
      "test_record": "",
      "done_record": "",
      "source": {
        "file": "TODO.md",
        "line": 262
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_3baf76c8341b5cea1cde",
      "display_id": "TD-CLOUD-003",
      "id_prefix": "CLOUD",
      "module_key": "6.14",
      "module_name": "云端配置存储与权限（v1.2）",
      "module_label": "6.14 云端配置存储与权限（v1.2）",
      "order": 179,
      "status": "TODO",
      "title": "实现云端配置读写服务与新设备恢复链路",
      "acceptance": "登录后可读取云端配置；新设备可恢复 repo/branch/token 密文并进入主密码解锁流程；失败路径可回退本地手动配置",
      "related_files": [
        "src/services/*",
        "src/hooks/use-auth.ts",
        "src/pages/settings.tsx",
        "e2e/specs/*"
      ],
      "test_record": "",
      "done_record": "",
      "source": {
        "file": "TODO.md",
        "line": 263
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_15158622c6b86031aec1",
      "display_id": "TD-DEMO-001",
      "id_prefix": "DEMO",
      "module_key": "6.15",
      "module_name": "演示链路与验收（v1.2）",
      "module_label": "6.15 演示链路与验收（v1.2）",
      "order": 180,
      "status": "TODO",
      "title": "实现 Demo 数据源与只读保护（默认游客体验）",
      "acceptance": "游客可读取 Demo 数据（本地静态或服务端代理）；游客态禁止 push/pull 与配置写入；UI 明确标识“演示模式”",
      "related_files": [
        "src/services/*",
        "src/pages/diary.tsx",
        "src/pages/yearly-summary.tsx",
        "src/components/common/*"
      ],
      "test_record": "",
      "done_record": "",
      "source": {
        "file": "TODO.md",
        "line": 269
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_66bb311f03320834a55d",
      "display_id": "TD-DEMO-002",
      "id_prefix": "DEMO",
      "module_key": "6.15",
      "module_name": "演示链路与验收（v1.2）",
      "module_label": "6.15 演示链路与验收（v1.2）",
      "order": 181,
      "status": "TODO",
      "title": "补齐 Vercel 部署配置与 CSP 放行（Supabase + 可选 Demo API）",
      "acceptance": "\`vercel.json\` 的 \`connect-src\` 放行 Supabase 域名；若使用 \`/api/demo/*\` 代理，服务端 Token 仅存环境变量；部署后游客与登录链路可用",
      "related_files": [
        "vercel.json",
        "api/*",
        "README.md",
        ".env.example"
      ],
      "test_record": "",
      "done_record": "",
      "source": {
        "file": "TODO.md",
        "line": 270
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    },
    {
      "task_uid": "td_cdeb8bbdcaf2c10c5d17",
      "display_id": "TD-TEST-014",
      "id_prefix": "TEST",
      "module_key": "6.15",
      "module_name": "演示链路与验收（v1.2）",
      "module_label": "6.15 演示链路与验收（v1.2）",
      "order": 182,
      "status": "TODO",
      "title": "新增游客/登录/恢复链路分层测试（unit/integration/E2E）",
      "acceptance": "至少覆盖：游客进入与转化、OTP 登录、首次绑定、跨设备恢复、未授权写入拦截；分层测试命令可稳定通过",
      "related_files": [
        "src/services/__tests__/*",
        "src/__tests__/integration/*",
        "e2e/specs/*",
        "TODO.md"
      ],
      "test_record": "",
      "done_record": "",
      "source": {
        "file": "TODO.md",
        "line": 271
      },
      "version": 1,
      "updated_at": "2026-02-21T14:31:06.652Z"
    }
  ]
}
      const allTasks = payload.tasks.slice().sort((a, b) => a.order - b.order)

      const searchInput = document.getElementById('searchInput')
      const statusSelect = document.getElementById('statusSelect')
      const categorySelect = document.getElementById('categorySelect')
      const tableBody = document.getElementById('tableBody')
      const meta = document.getElementById('meta')

      const statTotal = document.getElementById('statTotal')
      const statDone = document.getElementById('statDone')
      const statDoing = document.getElementById('statDoing')
      const statTodo = document.getElementById('statTodo')
      const statBlocked = document.getElementById('statBlocked')

      meta.textContent = '数据来源：TODO.md（一次性迁移快照） | 生成时间：' + payload.generatedAt

      function escapeHtml(raw) {
        return raw
          .replaceAll('&', '&amp;')
          .replaceAll('<', '&lt;')
          .replaceAll('>', '&gt;')
          .replaceAll('"', '&quot;')
          .replaceAll("'", '&#39;')
      }

      function fillFilters() {
        const statuses = ['ALL', 'DONE', 'DOING', 'TODO', 'BLOCKED']
        const categories = ['ALL'].concat(
          Array.from(new Set(allTasks.map((task) => task.module_label))).sort((a, b) => a.localeCompare(b, 'zh-CN'))
        )

        statusSelect.innerHTML = statuses
          .map((status) => '<option value="' + status + '">' + (status === 'ALL' ? '全部状态' : status) + '</option>')
          .join('')
        categorySelect.innerHTML = categories
          .map((category) => '<option value="' + escapeHtml(category) + '">' + (category === 'ALL' ? '全部分类' : escapeHtml(category)) + '</option>')
          .join('')
      }

      function updateStats(tasks) {
        const counts = { DONE: 0, DOING: 0, TODO: 0, BLOCKED: 0 }
        for (const task of tasks) {
          if (counts[task.status] !== undefined) {
            counts[task.status] += 1
          }
        }
        statTotal.textContent = String(tasks.length)
        statDone.textContent = String(counts.DONE)
        statDoing.textContent = String(counts.DOING)
        statTodo.textContent = String(counts.TODO)
        statBlocked.textContent = String(counts.BLOCKED)
      }

      function renderTable(tasks) {
        tableBody.innerHTML = tasks
          .map((task) => {
            const doneRecord = task.done_record || '-'
            return [
              '<tr>',
              '<td class="mono">' + escapeHtml(task.display_id) + '</td>',
              '<td><span class="status status-' + escapeHtml(task.status) + '">' + escapeHtml(task.status) + '</span></td>',
              '<td><div>' + escapeHtml(task.module_label) + '</div><div class="tiny mono">' + escapeHtml(task.id_prefix) + '</div></td>',
              '<td>' + escapeHtml(task.title) + '</td>',
              '<td class="tiny">' + escapeHtml(task.acceptance) + '</td>',
              '<td class="mono">' + escapeHtml(doneRecord) + '</td>',
              '</tr>',
            ].join('')
          })
          .join('')
      }

      function applyFilters() {
        const q = searchInput.value.trim().toLowerCase()
        const selectedStatus = statusSelect.value
        const selectedCategory = categorySelect.value

        const filtered = allTasks.filter((task) => {
          if (selectedStatus !== 'ALL' && task.status !== selectedStatus) {
            return false
          }
          if (selectedCategory !== 'ALL' && task.module_label !== selectedCategory) {
            return false
          }
          if (!q) {
            return true
          }
          const haystack = [
            task.display_id,
            task.title,
            task.status,
            task.module_label,
            task.acceptance,
            task.done_record,
          ]
            .join(' ')
            .toLowerCase()
          return haystack.includes(q)
        })

        updateStats(filtered)
        renderTable(filtered)
      }

      fillFilters()
      applyFilters()

      searchInput.addEventListener('input', applyFilters)
      statusSelect.addEventListener('change', applyFilters)
      categorySelect.addEventListener('change', applyFilters)
    </script>
  </body>
</html>
