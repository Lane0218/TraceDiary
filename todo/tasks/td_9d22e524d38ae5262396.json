{
  "task_uid": "td_9d22e524d38ae5262396",
  "display_id": "TD-SYNC-015",
  "id_prefix": "SYNC",
  "module_key": "6.5",
  "module_name": "同步与冲突解决",
  "module_label": "6.5 同步与冲突解决",
  "order": 39,
  "status": "DONE",
  "title": "修复同步可靠性与加密模型一致性问题（队列保留/冲突解密/CAS方法/主密码派生密钥）",
  "acceptance": "失败后保留并可重放最新排队 payload；冲突展示远端明文且不双重加密；metadata CAS 更新使用 PUT；日记数据密钥改为主密码派生并贯通上传链路",
  "related_files": [
    "src/hooks/use-sync.ts",
    "src/hooks/__tests__/use-sync.test.ts",
    "src/services/sync.ts",
    "src/services/__tests__/sync.test.ts",
    "src/hooks/use-auth.ts",
    "src/hooks/__tests__/use-auth.test.tsx",
    "src/pages/workspace.tsx",
    "src/pages/yearly-summary.tsx"
  ],
  "test_record": "`npm run test:unit` 通过（42/42）；`npm run test:integration` 通过（35/35）；`npm run test:e2e` 通过（7/7）；`npm run lint` 通过",
  "done_record": "2026-02-09 / 1fcf734",
  "source": {
    "file": "TODO.md",
    "line": 78
  },
  "version": 1,
  "updated_at": "2026-02-21T14:31:06.652Z"
}
